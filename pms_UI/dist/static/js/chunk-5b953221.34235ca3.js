(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5b953221"],{"13d5":function(e,t,a){"use strict";var o=a("23e7"),n=a("d58f").left,r=a("a640"),i=a("ae40"),s=a("2d00"),l=a("605d"),u=r("reduce"),c=i("reduce",{1:0}),d=!l&&s>79&&s<83;o({target:"Array",proto:!0,forced:!u||!c||d},{reduce:function(e){return n(this,e,arguments.length,arguments.length>1?arguments[1]:void 0)}})},afe5:function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container",staticStyle:{padding:"2px 0 0 0"}},[a("div",{ref:"btns"},[a("el-row",{staticClass:"mb8",attrs:{gutter:10}},[a("el-col",{attrs:{span:1.5}},[a("el-button",{attrs:{type:"info",icon:"el-icon-back",size:"mini",loading:e.exportLoading},on:{click:e.goBack}},[e._v("返回 ")])],1),a("el-col",{attrs:{span:1.5}},[a("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["bonus:staff:save"],expression:"['bonus:staff:save']"}],attrs:{type:"danger",icon:"el-icon-save",size:"mini",disabled:e.multiple},on:{click:e.handleSave}},[e._v("保存")])],1),a("el-col",{attrs:{span:1.5}},[a("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["bonus:staff:add"],expression:"['bonus:staff:add']"}],attrs:{type:"primary",icon:"el-icon-upload2",size:"mini"},on:{click:e.handleImport}},[e._v("导入Excel")])],1),a("el-col",{attrs:{span:1.5}},[a("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["bonus:staff:exportDetail"],expression:"['bonus:staff:exportDetail']"}],attrs:{type:"warning",icon:"el-icon-upload2",size:"mini",loading:e.exportLoading},on:{click:e.handleExportMes}},[e._v("导出")])],1),a("right-toolbar",{attrs:{showSearch:e.showSearch},on:{"update:showSearch":function(t){e.showSearch=t},"update:show-search":function(t){e.showSearch=t},queryTable:e.getList}})],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",attrs:{border:"",stripe:"",data:e.EvaluateDataList,height:"calc(100vh - 180px)","row-style":e.rowStyle,"row-class-name":e.rowClassName,"show-summary":!0,"summary-method":e.getSummaries},on:{"selection-change":e.handleSelectionChange,"row-click":e.rowClick}},[a("el-table-column",{attrs:{type:"selection",width:"55",align:"center"}}),a("el-table-column",{attrs:{sortable:"",label:"奖金日期",align:"center",prop:"actDate"}}),a("el-table-column",{attrs:{sortable:"",label:"科室名称",align:"center",prop:"deptName"}}),a("el-table-column",{attrs:{sortable:"",label:"员工编码",align:"center",prop:"staffCode"}}),a("el-table-column",{attrs:{sortable:"",label:"员工姓名",align:"center",prop:"staffName"}}),a("el-table-column",{attrs:{sortable:"",label:"奖金金额",align:"right",prop:"bonusAmount"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input-number",{model:{value:t.row.bonusAmount,callback:function(a){e.$set(t.row,"bonusAmount",a)},expression:"scope.row.bonusAmount"}})]}}])})],1),a("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total>0"}],attrs:{total:e.total,page:e.queryParams.pageNum,limit:e.queryParams.pageSize},on:{"update:page":function(t){return e.$set(e.queryParams,"pageNum",t)},"update:limit":function(t){return e.$set(e.queryParams,"pageSize",t)},pagination:e.getList}}),a("el-dialog",{attrs:{title:e.upload.title,visible:e.upload.open,width:"400px","custom-class":"el-button--primary","close-on-click-modal":!1},on:{"update:visible":function(t){return e.$set(e.upload,"open",t)}}},[a("el-upload",{ref:"upload",attrs:{limit:1,data:e.uploadDate,accept:".xlsx, .xls",headers:e.upload.headers,action:e.upload.url,disabled:e.upload.isUploading,"on-progress":e.handleFileUploadProgress,"on-success":e.handleFileSuccess,"on-error":e.handleFileError,"auto-upload":!1,drag:""}},[a("i",{staticClass:"el-icon-upload"}),a("div",{staticClass:"el-upload__text"},[e._v(" 将文件拖到此处，或 "),a("em",[e._v("点击上传")])]),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v(" 注意：生成数据需要大约俩分钟时间，在此期间请不要关闭您的浏览器或刷新界面。 ")]),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[a("el-link",{staticStyle:{"font-size":"12px"},attrs:{type:"info"},on:{click:e.handleExport}},[e._v("下载模板")])],1),a("div",{staticClass:"el-upload__tip",staticStyle:{color:"#cb6c6c"},attrs:{slot:"tip"},slot:"tip"},[e._v("提示：仅允许导入“xls”或“xlsx”格式文件！")])]),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:e.submitFileForm}},[e._v("确 定")]),a("el-button",{on:{click:function(t){e.upload.open=!1}}},[e._v("取 消")])],1)],1)],1)},n=[],r=(a("d81d"),a("7db0"),a("d3b7"),a("159b"),a("a9e3"),a("13d5"),a("b680"),a("c466")),i=a("b775");function s(e){return Object(i["a"])({url:"/bonus/staff/listBonusStaff",method:"get",params:e})}function l(e){return Object(i["a"])({url:"/bonus/staff/export",method:"get",params:e})}function u(e){return Object(i["a"])({url:"/bonus/staff/exportDetail",method:"get",params:e})}function c(e){return Object(i["a"])({url:"/bonus/staff/save",method:"post",data:e})}var d=a("0e67"),p=a("986b"),h=a("f2d9"),f=a("2b0e"),m=a("d623"),g=a("5f87");f["default"].component("downloadExcel",h["a"]);var b={name:"EvaluateData",deptCode:{type:[String,String],default:""},components:{formItem:d["default"],btns:p["default"],selectList:m["default"]},filters:{transToValue:function(e,t){return e[t]}},computed:{sumDataList:function(){return this.sumDataList_.push({}),this.sumDataList_.push(this.bottomTotal),this.sumDataList_},excelName:function(){return"人员奖金"+Object(r["c"])()+".xls"}},mounted:function(){},watch:{},data:function(){return{processOpen:!1,height:"500px;",src:"",showAudit:!1,id:"",showDialog:!1,userOptions:[],auditState:"",saveLoading:!1,loading:!1,exportLoading:!1,ids:[],single:!0,multiple:!0,showSearch:!0,total:0,EvaluateDataList:[],sumDataList_:[],selectionRow:[],title:"",open:!1,queryParams:{pageNum:1,pageSize:30,compCode:null,deptCode:null,deptName:null,accountCode:null,guideCode:null,guideValue:null,delFlag:null,actDate:Object(r["c"])()+"-01",createBy:null,createTime:null,updateBy:null,updateTime:null,remark:null,deptType:null},form:{procedureId:null,assignee:null},nextAssignee:[],btn1:!1,btn2:!1,btn3:!1,btn4:!1,btn5:!1,comment:"",proclnsIds:"",datas:{},openSelect:!1,doctorOpen:!1,docParams:{pageNum:1,pageSize:20},doctorList:[],docTotal:0,tableTitle:"人员奖金数据",jsonFields:{"科室名称":"deptName","人员姓名":"staffName"},bottomTotal:{deptName:"合计",staffName:"",total:0},uploadDate:{deptCode:null,actDate:null},upload:{open:!1,title:"",isUploading:!1,updateSupport:0,headers:{Authorization:"Bearer "+Object(g["a"])()},url:"/pms/bonus/staff/importData"}}},created:function(){this.getList()},methods:{handleExportMes:function(){var e=this,t=this.queryParams;this.$confirm("是否确认导出所有员工数据项?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){return e.exportLoading=!0,u(t)})).then((function(t){e.download(t.msg),e.exportLoading=!1})).catch((function(){}))},handleImport:function(){this.upload.title="员工奖金导入",this.upload.open=!0},handleSave:function(e){var t=this;c(this.selectionRow).then((function(e){200==e.code?(t.msgSuccess(e.msg),t.getList()):t.msgError(res.msg)}))},submitFileForm:function(){this.uploadDate.deptCode=this.$route.params.deptCode,this.uploadDate.actDate=this.$route.params.actDate,this.$refs.upload.submit()},handleFileUploadProgress:function(e,t,a){this.upload.isUploading=!0},handleFileSuccess:function(e,t,a){this.upload.open=!1,this.upload.isUploading=!1,this.$refs.upload.clearFiles(),this.$alert(e.msg,"导入结果",{dangerouslyUseHTMLString:!0}),this.getList()},handleFileError:function(e,t,a){this.upload.isUploading=!1,this.msgError("上传失败！")},getList:function(){var e=this;this.loading=!0,this.queryParams.deptCode=this.$route.params.deptCode,this.queryParams.actDate=this.$route.params.actDate,s(this.queryParams).then((function(t){e.EvaluateDataList=t.data,e.tableDoLayout(),e.loading=!1}))},cancel:function(){this.open=!1},successSubmit:function(e){this.open=e,this.getList()},cancelSelect:function(){this.openSelect=!1},reset:function(){this.form={id:null,compCode:null,deptName:null,accountCode:null,guideCode:null,guideValue:null,delFlag:null,actDate:null,createBy:null,createTime:null,updateBy:null,updateTime:null,remark:null},this.resetForm("form")},handleQuery:function(){this.queryParams.pageNum=1,this.getList()},resetQuery:function(){this.resetForm("queryForm"),this.handleQuery()},handleSelectionChange:function(e){this.ids=e.map((function(e){return e.id})),this.single=1!==e.length,this.multiple=!e.length,this.selectionRow=e},rowClick:function(e,t,a){var o=this.$refs.multipleTable,n=this.selectionRow.find((function(t){return t.rowIndex==e.rowIndex}));n&&1==this.selectionRow.length?o.toggleRowSelection(e,!1):(o.clearSelection(),o.toggleRowSelection(e))},rowStyle:function(e){var t=e.row,a=e.rowIndex;Object.defineProperty(t,"rowIndex",{value:a,writable:!0,enumerable:!1})},rowClassName:function(e){var t=e.row,a=(e.rowIndex,""),o=this.selectionRow.find((function(e){return e.rowIndex===t.rowIndex}));return o&&(a="current-row "),a},tableRowClassName:function(e){var t=e.row,a=e.rowIndex;t.row_index=a},singleTable:function(e){var t=this.$refs.itsmDataTable;t.clearSelection(),this.currentRowIndex==e.row_index?(t.toggleRowSelection(e,!1),this.currentRowIndex=null,this.docSelectData=null):(t.toggleRowSelection(e),this.currentRowIndex=e.row_index,this.docSelectData=e)},handleExport:function(){var e=this,t=this.queryParams;this.exportLoading=!0,l(t).then((function(t){e.download(t.msg),e.exportLoading=!1})).catch((function(){}))},goBack:function(){this.$store.dispatch("tagsView/delView",this.$route),this.$router.go(-1)},getSummaries:function(e){var t=this,a=e.columns,o=e.data,n=[];return a.forEach((function(e,a){if(0!==a){if(5===a){var r=o.map((function(t){return Number(t[e.property])}));r.every((function(e){return isNaN(e)}))?n[a]="":(n[a]=r.reduce((function(e,t){var a=Number(t);return isNaN(a)?e:e+t}),0),"deptName"!=e.property&&(t.bottomTotal[e.property]=parseFloat(n[a])),n[a]=n[a].toFixed(2))}}else n[a]="合计"})),n},tableDoLayout:function(){var e=this;this.$refs.multipleTable&&this.$nextTick((function(){e.$refs.multipleTable.doLayout()}))}}},w=b,y=a("2877"),v=Object(y["a"])(w,o,n,!1,null,null,null);t["default"]=v.exports},d58f:function(e,t,a){var o=a("1c0b"),n=a("7b0b"),r=a("44ad"),i=a("50c4"),s=function(e){return function(t,a,s,l){o(a);var u=n(t),c=r(u),d=i(u.length),p=e?d-1:0,h=e?-1:1;if(s<2)while(1){if(p in c){l=c[p],p+=h;break}if(p+=h,e?p<0:d<=p)throw TypeError("Reduce of empty array with no initial value")}for(;e?p>=0:d>p;p+=h)p in c&&(l=a(l,c[p],p,u));return l}};e.exports={left:s(!1),right:s(!0)}},f2d9:function(e,t,a){"use strict";(function(e){"undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof e||"undefined"!==typeof self&&self;function a(e,t){return t={exports:{}},e(t,t.exports),t.exports}var o=a((function(e,t){(function(t,a){e.exports=a()})(0,(function(){return function e(t,a,o){var n,r,i=window,s="application/octet-stream",l=o||s,u=t,c=!a&&!o&&u,d=document.createElement("a"),p=function(e){return String(e)},h=i.Blob||i.MozBlob||i.WebKitBlob||p,f=a||"download";if(h=h.call?h.bind(i):Blob,"true"===String(this)&&(u=[u,l],l=u[0],u=u[1]),c&&c.length<2048&&(f=c.split("/").pop().split("?")[0],d.href=c,-1!==d.href.indexOf(c))){var m=new XMLHttpRequest;return m.open("GET",c,!0),m.responseType="blob",m.onload=function(t){e(t.target.response,f,s)},setTimeout((function(){m.send()}),0),m}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(u)){if(!(u.length>2096103.424&&h!==p))return navigator.msSaveBlob?navigator.msSaveBlob(y(u),f):v(u);u=y(u),l=u.type||s}else if(/([\x80-\xff])/.test(u)){var g=0,b=new Uint8Array(u.length),w=b.length;for(g;g<w;++g)b[g]=u.charCodeAt(g);u=new h([b],{type:l})}function y(e){var t=e.split(/[:;,]/),a=t[1],o="base64"==t[2]?atob:decodeURIComponent,n=o(t.pop()),r=n.length,i=0,s=new Uint8Array(r);for(i;i<r;++i)s[i]=n.charCodeAt(i);return new h([s],{type:a})}function v(e,t){if("download"in d)return d.href=e,d.setAttribute("download",f),d.className="download-js-link",d.innerHTML="downloading...",d.style.display="none",document.body.appendChild(d),setTimeout((function(){d.click(),document.body.removeChild(d),!0===t&&setTimeout((function(){i.URL.revokeObjectURL(d.href)}),250)}),66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(e)&&(e="data:"+e.replace(/^data:([\w\/\-\+]+)/,s)),window.open(e)||confirm("Displaying New Document\n\nUse Save As... to download, then click back to return to this page.")&&(location.href=e),!0;var a=document.createElement("iframe");document.body.appendChild(a),!t&&/^data:/.test(e)&&(e="data:"+e.replace(/^data:([\w\/\-\+]+)/,s)),a.src=e,setTimeout((function(){document.body.removeChild(a)}),333)}if(n=u instanceof h?u:new h([u],{type:l}),navigator.msSaveBlob)return navigator.msSaveBlob(n,f);if(i.URL)v(i.URL.createObjectURL(n),!0);else{if("string"===typeof n||n.constructor===p)try{return v("data:"+l+";base64,"+i.btoa(n))}catch(x){return v("data:"+l+","+encodeURIComponent(n))}r=new FileReader,r.onload=function(e){v(this.result)},r.readAsDataURL(n)}return!0}}))})),n={props:{type:{type:String,default:"xls"},data:{type:Array,required:!1,default:null},fields:{type:Object,default:()=>null},exportFields:{type:Object,default:()=>null},defaultValue:{type:String,required:!1,default:""},header:{default:null},footer:{default:null},name:{type:String,default:"data.xls"},fetch:{type:Function},meta:{type:Array,default:()=>[]},worksheet:{type:String,default:"Sheet1"},beforeGenerate:{type:Function},beforeFinish:{type:Function},escapeCsv:{type:Boolean,default:!0},stringifyLongNum:{type:Boolean,default:!1}},computed:{idName(){var e=(new Date).getTime();return"export_"+e},downloadFields(){return this.fields?this.fields:this.exportFields?this.exportFields:void 0}},methods:{async generate(){"function"===typeof this.beforeGenerate&&await this.beforeGenerate();let e=this.data;if("function"!==typeof this.fetch&&e||(e=await this.fetch()),!e||!e.length)return;let t=this.getProcessedJson(e,this.downloadFields);return"html"===this.type?this.export(this.jsonToXLS(t),this.name.replace(".xls",".html"),"text/html"):"csv"===this.type?this.export(this.jsonToCSV(t),this.name.replace(".xls",".csv"),"application/csv"):this.export(this.jsonToXLS(t),this.name,"application/vnd.ms-excel")},export:async function(e,t,a){let n=this.base64ToBlob(e,a);"function"===typeof this.beforeFinish&&await this.beforeFinish(),o(n,t,a)},jsonToXLS(e){let t='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><meta name=ProgId content=Excel.Sheet> <meta name=Generator content="Microsoft Excel 11"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">\x3c!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>${worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--\x3e<style>br {mso-data-placement: same-cell;}</style></head><body><table>${table}</table></body></html>',a="<thead>";const o=Object.keys(e[0]).length;let n=this;const r=this.header||this.$attrs.title;r&&(a+=this.parseExtraData(r,'<tr><th colspan="'+o+'">${data}</th></tr>')),a+="<tr>";for(let i in e[0])a+="<th>"+i+"</th>";return a+="</tr>",a+="</thead>",a+="<tbody>",e.map((function(e,t){a+="<tr>";for(let o in e)a+="<td>"+n.preprocessLongNum(n.valueReformattedForMultilines(e[o]))+"</td>";a+="</tr>"})),a+="</tbody>",null!=this.footer&&(a+="<tfoot>",a+=this.parseExtraData(this.footer,'<tr><td colspan="'+o+'">${data}</td></tr>'),a+="</tfoot>"),t.replace("${table}",a).replace("${worksheet}",this.worksheet)},jsonToCSV(e){let t=this;var a=[];const o=this.header||this.$attrs.title;o&&a.push(this.parseExtraData(o,"${data}\r\n"));for(let n in e[0])a.push(n),a.push(",");return a.pop(),a.push("\r\n"),e.map((function(e){for(let o in e){let n=e[o]+"";t.escapeCsv&&(n='="'+n+'"',n.match(/[,"\n]/)&&(n='"'+n.replace(/\"/g,'""')+'"')),a.push(n),a.push(",")}a.pop(),a.push("\r\n")})),null!=this.footer&&a.push(this.parseExtraData(this.footer,"${data}\r\n")),a.join("")},getProcessedJson(e,t){let a=this.getKeys(e,t),o=[],n=this;return e.map((function(e,t){let r={};for(let o in a){let t=a[o];r[o]=n.getValue(t,e)}o.push(r)})),o},getKeys(e,t){if(t)return t;let a={};for(let o in e[0])a[o]=o;return a},parseExtraData(e,t){let a="";if(Array.isArray(e))for(var o=0;o<e.length;o++)e[o]&&(a+=t.replace("${data}",e[o]));else a+=t.replace("${data}",e);return a},getValue(e,t){const a="object"!==typeof e?e:e.field;let o="string"!==typeof a?[]:a.split("."),n=this.defaultValue;return n=a?o.length>1?this.getValueFromNestedItem(t,o):this.parseValue(t[a]):t,e.hasOwnProperty("callback")&&(n=this.getValueFromCallback(n,e.callback)),n},valueReformattedForMultilines(e){return"string"==typeof e?e.replace(/\n/gi,"<br/>"):e},preprocessLongNum(e){if(this.stringifyLongNum){if(String(e).startsWith("0x"))return e;if(!isNaN(e)&&""!=e&&(e>99999999999||e<1e-13))return'="'+e+'"'}return e},getValueFromNestedItem(e,t){let a=e;for(let o of t)a&&(a=a[o]);return this.parseValue(a)},getValueFromCallback(e,t){if("function"!==typeof t)return this.defaultValue;const a=t(e);return this.parseValue(a)},parseValue(e){return e||0===e||"boolean"===typeof e?e:this.defaultValue},base64ToBlob(e,t){let a=window.btoa(window.unescape(encodeURIComponent(e))),o=atob(a),n=o.length,r=new Uint8ClampedArray(n);while(n--)r[n]=o.charCodeAt(n);return new Blob([r],{type:t})}}};function r(e,t,a,o,n,r,i,s,l,u){"boolean"!==typeof i&&(l=s,s=i,i=!1);var c,d="function"===typeof a?a.options:a;if(e&&e.render&&(d.render=e.render,d.staticRenderFns=e.staticRenderFns,d._compiled=!0,n&&(d.functional=!0)),o&&(d._scopeId=o),r?(c=function(e){e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,e||"undefined"===typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),t&&t.call(this,l(e)),e&&e._registeredComponents&&e._registeredComponents.add(r)},d._ssrRegister=c):t&&(c=i?function(){t.call(this,u(this.$root.$options.shadowRoot))}:function(e){t.call(this,s(e))}),c)if(d.functional){var p=d.render;d.render=function(e,t){return c.call(t),p(e,t)}}else{var h=d.beforeCreate;d.beforeCreate=h?[].concat(h,c):[c]}return a}var i=r;const s=n;var l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:e.idName},on:{click:e.generate}},[e._t("default",[e._v(" Download "+e._s(e.name)+" ")])],2)},u=[];l._withStripped=!0;const c=void 0,d=void 0,p=void 0,h=!1;var f=i({render:l,staticRenderFns:u},c,s,d,h,p,void 0,void 0);t["a"]=f}).call(this,a("c8ba"))}}]);