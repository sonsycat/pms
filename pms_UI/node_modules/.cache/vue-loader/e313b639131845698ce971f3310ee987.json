{"remainingRequest":"F:\\pms_UI\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\pms_UI\\src\\views\\quality\\quality\\index.vue?vue&type=style&index=0&id=fd0bdff0&lang=scss&scoped=true&","dependencies":[{"path":"F:\\pms_UI\\src\\views\\quality\\quality\\index.vue","mtime":1693362205793},{"path":"F:\\pms_UI\\node_modules\\css-loader\\dist\\cjs.js","mtime":1693361949271},{"path":"F:\\pms_UI\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1693362179282},{"path":"F:\\pms_UI\\node_modules\\postcss-loader\\src\\index.js","mtime":1693362110683},{"path":"F:\\pms_UI\\node_modules\\sass-loader\\dist\\cjs.js","mtime":1693362152666},{"path":"F:\\pms_UI\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1693361924439},{"path":"F:\\pms_UI\\node_modules\\vue-loader\\lib\\index.js","mtime":1693362179279}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgouYWRkX2Zvcm17CiAgOjp2LWRlZXB7CiAgICAuZWwtZm9ybS1pdGVtX19jb250ZW50ewogICAgICBtYXJnaW4tbGVmdDogMCAhaW1wb3J0YW50OwogICAgfQogIH0KfQo="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmXA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/quality/quality","sourcesContent":["<template>\n  <div class=\"app-container\">\n  <div ref=\"search\">\n    <el-form :model=\"queryParams\" ref=\"queryForm\" :inline=\"true\" v-show=\"showSearch\">\n      <el-form-item label=\"科室\" prop=\"deptCode\">\n        <el-select class=\"search_w220\" v-model=\"queryParams.deptCode\" clearable filterable placeholder=\"请选择科室分类\">\n            <el-option\n              v-for=\"item in deptList\"\n              :key=\"item.deptRoomId\"\n              :label=\"item.deptRoomName\"\n              :value=\"item.deptRoomId\">\n            </el-option>\n          </el-select>\n      </el-form-item>\n      <el-form-item label=\"年月\" prop=\"qDate\">\n        <el-date-picker :clearable=\"false\"\n            v-model=\"queryParams.qDate\"\n            type=\"month\"\n            value-format=\"yyyy-MM\"\n            placeholder=\"选择年月\"\n            >\n        </el-date-picker>\n      </el-form-item>\n      <el-form-item>\n        <el-button type=\"primary\" icon=\"el-icon-search\" size=\"mini\" @click=\"handleQuery\">搜索</el-button>\n        <el-button icon=\"el-icon-refresh\" size=\"mini\" @click=\"resetQuery\">重置</el-button>\n      </el-form-item>\n    </el-form>\n\t</div>\n\t<div ref=\"btns\">\n    <el-row :gutter=\"10\" class=\"mb8\">\n      <el-col :span=\"1.5\">\n        <el-button\n          type=\"primary\"\n          icon=\"el-icon-plus\"\n          size=\"mini\"\n          @click=\"handleAdd\"\n          v-hasPermi=\"['quality:quality:add']\"\n        >生成质量数据</el-button>\n      </el-col>\n      <el-col :span=\"1.5\">\n        <el-button\n          type=\"success\"\n          icon=\"el-icon-search\"\n          size=\"mini\"\n          :disabled=\"single\"\n          @click=\"handleDetail\"\n          v-hasPermi=\"['quality:quality:edit']\"\n        >查看详情</el-button>\n      </el-col>\n      <right-toolbar :showSearch.sync=\"showSearch\" @queryTable=\"getList\"></right-toolbar>\n    </el-row>\n\t</div>\n\n    <el-table border stripe v-loading=\"loading\" :height=\"tableHeight\" :data=\"qualityList\" @selection-change=\"handleSelectionChange\" ref=\"multipleTable\" @row-click=\"rowClick\" :row-style=\"rowStyle\" :row-class-name=\"rowClassName\">\n      <el-table-column type=\"selection\" width=\"55\" align=\"center\" />\n      <el-table-column sortable label=\"年月\" align=\"center\" prop=\"occTime\" width=\"180\">\n        <template slot-scope=\"scope\">\n           <el-link type=\"primary\" :underline=\"false\" v-html=\"scope.row.occTime\" @click.stop=\"handleClickTableName(scope.row)\" class=\"displayBlock text-ellipsis \"></el-link>\n        </template>\n      </el-table-column>\n      <el-table-column sortable label=\"科室名称\" align=\"center\" prop=\"deptName\" />\n      <el-table-column sortable label=\"公共质量得分\" align=\"center\" prop=\"actualScore\" />\n    </el-table>\n\n    <pagination\n      v-show=\"total>0\"\n      :total=\"total\"\n      :page.sync=\"queryParams.pageNum\"\n      :limit.sync=\"queryParams.pageSize\"\n      @pagination=\"getList\"\n    />\n  <!-- 详情 -->\n\t<detailEdit v-if=\"detailOpen\" :open=\"detailOpen\" :datas=\"selectionRow[0]\" @cancel=\"detailCancel\" @success=\"successSubmit\"></detailEdit>\n  <!-- 新增 -->\n\t\t<el-dialog :title=\"title\" :close-on-click-modal=\"false\" custom-class=\"el-button--primary\" :visible.sync=\"open\" width=\"26%\" append-to-body @close=\"cancel\">\n      <el-form class=\"add_form\" :model=\"form\" :rules=\"rules\" ref=\"form\" :inline=\"true\" >\n        <el-row>\n          <el-col :span=\"24\">\n            <el-form-item label=\"年月:\" prop=\"occureTime\">\n              <el-date-picker\n                v-model=\"form.occureTime \"\n                value-format=\"yyyy-MM-dd\"\n                type=\"month\"\n                placeholder=\"年/月\"\n              ></el-date-picker>\n            </el-form-item>\n          </el-col>\n        </el-row>\n      </el-form>\n      <div slot=\"footer\" class=\"dialog-footer\">\n        <el-button type=\"primary\" @click=\"submitForm\" :loading=\"subLoading\">确 认</el-button>\n        <el-button @click=\"cancel\">取 消</el-button>\n      </div>\n\t\t</el-dialog>\n  </div>\n</template>\n\n<script>\nimport { listQuality, delQuality, addQuality, updateQuality, exportQuality, checkQuality} from \"@/api/quality/quality\";\nimport detailEdit from \"./detailEdit\";\nimport { treeRoom } from \"@/api/until\";\n\nexport default {\n  name: \"Quality\",\n  components: {\n  detailEdit\n  },\n  data() {\n    return {\n      tableHeight: \"auto\",\n      // 遮罩层\n      loading: false,\n      // 导出遮罩层\n      exportLoading: false,\n      subLoading:false,\n      // 选中数组\n      ids: [],\n      addEditId:null,\n      // 非单个禁用\n      single: true,\n      // 非多个禁用\n      multiple: true,\n      // 显示搜索条件\n      showSearch: true,\n      // 总条数\n      total: 0,\n      // 质量数据生成表格数据\n      qualityList: [],\n      selectionRow: [],\n      // 弹出层标题\n      title: \"生成质量数据\",\n      // 是否显示弹出层\n      open: false,\n      //详情弹出框\n      detailOpen:false,\n      // 查询参数\n      queryParams: {\n        pageNum: 1,\n        pageSize: 30,\n        compCode: this.$store.state.user.userInfo.deptId,\n        accountCode: null,\n        deptCode: null,\n        indexCode: null,\n        tempCode: null,\n        indexScore: null,\n        occureTime: null,\n        actualScore: null,\n        nowDate:null,\n        qDate:null\n      },\n      // 表单参数\n      form: {\n\n      },\n      // 表单校验\n      rules: {\n        occureTime:[{ required: true, message: \"请选择年月\", trigger: [\"blur\",\"change\"] }]\n      },\n      deptList:[],\n    };\n  },\n  created() {\n    this.getList();\n    this.getTreeDept();\n    this.$nextTick(() => {\n      this.resizeHandler();\n      window.addEventListener(\"resize\", this.resizeHandler);\n    });\n\n  },\n  computed: {\n    listData() {\n      return this.$store.state.app.sidebar.opened;\n    }\n  },\n  watch: {\n    listData(val) {\n      var that = this;\n      setTimeout(function() {\n        that.resizeHandler();\n      }, 300);\n    }\n  },\n  methods: {\n    //获取科室列表\n    getTreeDept(deptId) {\n      let data = {\n        deptId: deptId\n      };\n      treeRoom(data).then(response => {\n        if (response.code == 200) {\n          this.deptList = response.rows;\n        } else {\n          this.msgError(response.msg);\n        }\n      });\n    },\n    handleClickTableName(data){\n      // 选中当前行\n        this.rowClick(data, false);\n        this.handleDetail(data);\n    },\n    resizeHandler() {\n      let a = this.$refs.search.offsetHeight;\n      let b = this.$refs.btns.offsetHeight;\n      let h = a + b + 18 + 45 + 84 + 40 + 20;\n      h = h + \"px\";\n      this.tableHeight = `calc(100vh - ${h})`;\n    },\n    /** 查询质量数据生成列表 */\n    getList() {\n      this.loading = true;\n      // this.queryParams.params = {};\n      listQuality(this.queryParams).then(response => {\n        this.qualityList = response.rows;\n        this.total = response.total;\n        this.loading = false;\n      });\n    },\n\tsuccessSubmit(flag) {\n      this.open = flag;\n      this.getList();\n    },\n    // 取消按钮\n    cancel() {\n      this.open = false;\n      this.reset();\n    },\n    // 表单重置\n    reset() {\n      this.form = {\n        id: null,\n        compCode:this.$store.state.user.userInfo.deptId,\n        accountCode: null,\n        deptCode: null,\n        indexCode: null,\n        tempCode: null,\n        indexScore: null,\n        occureTime: null,\n        actualScore: null,\n        delFlag: null,\n        createBy: null,\n        createTime: null,\n        updateBy: null,\n        updateTime: null,\n        remark: null\n      };\n      this.resetForm(\"form\");\n    },\n    /** 搜索按钮操作 */\n    handleQuery() {\n      this.queryParams.pageNum = 1;\n      this.getList();\n    },\n    /** 重置按钮操作 */\n    resetQuery() {\n      this.daterangeOccureTime = [];\n      this.resetForm(\"queryForm\");\n      this.handleQuery();\n    },\n    // 多选框选中数据\n    handleSelectionChange(selection) {\n      this.ids = selection.map(item => item.id)\n      this.single = selection.length!==1\n      this.multiple = !selection.length\n      this.selectionRow=selection\n    },\n    rowClick(row, column, event) {\n      let refsElTable = this.$refs.multipleTable;\n      let findRow = this.selectionRow.find(c => c.rowIndex == row.rowIndex);\n      // if (findRow && this.selectionRow.length == 1) {\n      //   refsElTable.toggleRowSelection(row, false);\n      //   return;\n      // }\n      refsElTable.clearSelection();\n      refsElTable.toggleRowSelection(row);\n    },\n    rowStyle({\n      row,\n      rowIndex\n    }) {\n      Object.defineProperty(row, 'rowIndex', {\n        value: rowIndex,\n        writable: true,\n        enumerable: false\n      })\n    },\n    rowClassName({\n      row,\n      rowIndex\n    }) {\n      let rowName = \"\",\n        findRow = this.selectionRow.find(c => c.rowIndex === row.rowIndex);\n      if (findRow) {\n        rowName = \"current-row \";\n      }\n      return rowName;\n    },\n    /** 新增按钮操作\n    handleAdd() {\n      this.reset();\n      this.open = true;\n      this.title = \"添加质量数据生成\";\n    },\n     */\n    /** 新增按钮操作 */\n    handleAdd() {\n      this.open = true; // 弹框点开\n      // this.addEditId = \"\"; // addEditId 是新增  去子组件方便区分新增编辑\n\n    },\n    //详情按钮操作\n    handleDetail(){\n      this.detailOpen=true;\n    },\n    detailCancel(){\n      this.detailOpen=false;\n    },\n    checkQuality(data){\n      checkQuality(data).then(res=>{\n        if(res.code==200){\n          this.checkedAllow = res.data\n        }\n      })\n    },\n    addQualityFun(data){\n      let saveLoading=this.saveLoading()\n        addQuality(data).then(response => {\n          if(response.code==200){\n             this.msgSuccess(\"新增成功\");\n            this.open = false;\n            this.getList();\n            saveLoading.close();\n          }\n\n        });\n    },\n    /** 提交按钮 */\n    submitForm() {\n      this.$refs[\"form\"].validate(valid => {\n        if (valid) {\n          let params={\n            occureTime:this.form.occureTime,\n            compCode:this.$store.state.user.userInfo.deptId,\n          }\n          checkQuality(params).then(res=>{\n            if(res.code==200){\n              if(!res.data){\n                this.$confirm('当月已有数据，是否确认覆盖原有数据?', \"警告\", {\n                  confirmButtonText: \"确定\",\n                  cancelButtonText: \"取消\",\n                  type: \"warning\"\n                }).then(()=> {\n                  return this.addQualityFun(params);\n                }).catch(() => {\n                  this.open = false;\n                  this.getList();\n                });\n              }else{\n                this.addQualityFun(params);\n              }\n            }\n          })\n        }\n      });\n    },\n  }\n};\n</script>\n<style lang=\"scss\" scoped>\n.add_form{\n  ::v-deep{\n    .el-form-item__content{\n      margin-left: 0 !important;\n    }\n  }\n}\n</style>\n\n"]}]}