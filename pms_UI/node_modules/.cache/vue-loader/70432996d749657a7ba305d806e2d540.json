{"remainingRequest":"F:\\pms_UI\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\pms_UI\\src\\views\\apportionment\\project\\addEdit.vue?vue&type=script&lang=js&","dependencies":[{"path":"F:\\pms_UI\\src\\views\\apportionment\\project\\addEdit.vue","mtime":1693362204148},{"path":"F:\\pms_UI\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1693361924439},{"path":"F:\\pms_UI\\node_modules\\babel-loader\\lib\\index.js","mtime":1693361909992},{"path":"F:\\pms_UI\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1693361924439},{"path":"F:\\pms_UI\\node_modules\\vue-loader\\lib\\index.js","mtime":1693362179279}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IHZhbGlkRW1haWwgfSBmcm9tJ0AvdXRpbHMvdmFsaWRhdGUnCmltcG9ydCB7IGxpc3RQcm9qZWN0LCBnZXRQcm9qZWN0LCBkZWxQcm9qZWN0LCBhZGRQcm9qZWN0LCB1cGRhdGVQcm9qZWN0LCBleHBvcnRQcm9qZWN0IH0gZnJvbSAiQC9hcGkvYXBwb3J0aW9ubWVudC9wcm9qZWN0IjsKaW1wb3J0IHBpbnlpbiBmcm9tICJqcy1waW55aW4iOwppbXBvcnQge2dldFllYXJ9IGZyb20gIkAvdXRpbHMvZGF0ZSI7CmltcG9ydCB7IGdldENvc3RBcHBvcnQgfSBmcm9tICJAL2FwaS9zeXN0ZW0vZGljdC9kYXRhIgoKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJhZGRFZGl0IiwKICBwcm9wczogewogICAgb3BlbjogewogICAgICB0eXBlOiBCb29sZWFuLAogICAgICBkZWZhdWx0OiBmYWxzZQogICAgfSwKICAgIGlkOiB7CiAgICAgIHR5cGU6IFtTdHJpbmcsIE51bWJlcl0sCiAgICAgIGRlZmF1bHQ6ICIiCiAgICB9CiAgfSwKICB3YXRjaDogewogICAgaWQ6IHsKICAgICAgaGFuZGxlcih2YWwpIHsKICAgICAgICB0aGlzLnJlc2V0KCk7CiAgICAgICAgaWYgKHZhbCkgewogICAgICAgICAgdGhpcy5pZCA9IHZhbDsKICAgICAgICAgIHRoaXMudGl0bGUgPSAi5YiG5pGK5pa55qGI566h55CGLee8lui+kSI7CiAgICAgICAgICB0aGlzLmdldERldGFpbEluZm8oKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5pZCA9ICIiOwogICAgICAgICAgdGhpcy5weW0gPSAi6Ieq5Yqo55Sf5oiQIjsKICAgICAgICAgIHRoaXMuZm9ybS5wcm9qZWN0VHlwZSA9JzInOwogICAgICAgICAgdGhpcy50aXRsZSA9ICLliIbmkYrmlrnmoYjnrqHnkIYt5paw5aKeIjsKICAgICAgICAgIHRoaXMuZ2V0Q29zdEFwcG9ydCgpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgZGVlcDogdHJ1ZSwKICAgICAgaW1tZWRpYXRlOiB0cnVlCiAgICB9LAogICAgb3BlbjogewogICAgICBoYW5kbGVyKHZhbCkgewogICAgICAgIHRoaXMub3BlbkRpYWxvZyA9IHZhbDsKICAgICAgfSwKICAgICAgZGVlcDogdHJ1ZQogICAgfQogIH0sCiAgY29tcG9uZW50czogewogICAgZ2V0Q29zdEFwcG9ydAogIH0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIHRpdGxlOiAi5YiG5pGK5pa55qGI566h55CGLeaWsOWiniIsCiAgICAgIG9wZW5EaWFsb2c6IHRoaXMub3BlbiwKICAgICAgcHltOiAiIiwKICAgICAgLy8g6KGo5Y2V5Y+C5pWwCiAgICAgIGZvcm06IHt9LAogICAgICBwcm9qZWN0VHlwZU9wdGlvbnM6IFtdLAogICAgICAvLyDooajljZXmoKHpqowKICAgICAgcnVsZXM6IHsKICAgICAgICBwcm9qZWN0Q29kZTogWwogICAgICAgICAgeyByZXF1aXJlZDogdHJ1ZSwgbWVzc2FnZTogIuaWueahiOe8lueggeS4jeiDveS4uuepuiIsIHRyaWdnZXI6ICJibHVyIiB9CiAgICAgICAgXSwKICAgICAgICBwcm9qZWN0TmFtZTogWwogICAgICAgICAgeyByZXF1aXJlZDogdHJ1ZSwgbWVzc2FnZTogIuaWueahiOWQjeensOS4jeiDveS4uuepuiIsIHRyaWdnZXI6ICJibHVyIiB9CiAgICAgICAgXSwKICAgICAgICBub3dEYXRlOiBbCiAgICAgICAgICB7IHJlcXVpcmVkOiB0cnVlLCBtZXNzYWdlOiAi5b2T5YmN5bm05pyI5LiN6IO95Li656m6IiwgdHJpZ2dlcjogImJsdXIiIH0KICAgICAgICBdLAogICAgICAgIHByb2plY3RUeXBlOlsKICAgICAgICAgIHsgcmVxdWlyZWQ6IHRydWUsIG1lc3NhZ2U6ICLmlrnmoYjnsbvlnovkuI3og73kuLrnqboiLCB0cmlnZ2VyOiAiYmx1ciIgfQogICAgICAgIF0sCiAgICAgIH0KICAgIH07CiAgfSwKICBjcmVhdGVkKCkgewogICAgdGhpcy5nZXRMaXN0KCk7CiAgICB0aGlzLmdldERpY3RzKCJjb3N0X2ZhX3R5cGUiKS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgdGhpcy5wcm9qZWN0VHlwZU9wdGlvbnMgPSByZXNwb25zZS5kYXRhOwogICAgfSk7CiAgfSwKICBtZXRob2RzOiB7CiAgICBnZXREZXRhaWxJbmZvKCkgewogICAgICBnZXRQcm9qZWN0KHRoaXMuaWQpLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTsKICAgICAgICB0aGlzLmZvcm0gPSByZXNwb25zZS5kYXRhOwogICAgICB9KTsKICAgIH0sCiAgICBnZXRDb3N0QXBwb3J0KCkgewogICAgICBnZXRDb3N0QXBwb3J0KHRoaXMuJHN0b3JlLnN0YXRlLnVzZXIuYWNjb3VudEluZm8uZGVwdElkKS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSkgewogICAgICAgICAgdGhpcy5mb3JtLm5vd0RhdGUgPSByZXNwb25zZS5kYXRhOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLmZvcm0ubm93RGF0ZSA9IGdldFllYXIoKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIC8vIOiOt+WPluaLvOmfs+eggQogICAgZ2V0UHltKCkgewogICAgICAvLyDlhajmmK/lrZfmr43nmoTmg4XlhrXkuIss5ou86Z+z56CB562J5LqO5omA5pyJ5a2X5q+NCiAgICAgIGlmICgvXlthLXpBLVpdKiQvLnRlc3QodGhpcy5mb3JtLnByb2plY3ROYW1lKSkgewogICAgICAgIHRoaXMuZm9ybS5zcGVsbCA9IHRoaXMuZm9ybS5wcm9qZWN0TmFtZTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgLy8g5pyJ5rGJ5a2X55qE5oOF5Ya15LiLLOi9rOS4uummluWtl+avjQogICAgICBsZXQgZnVsbE5hbWUgPSBwaW55aW4uZ2V0Q2FtZWxDaGFycyh0aGlzLmZvcm0ucHJvamVjdE5hbWUpLnRvVXBwZXJDYXNlKCk7CiAgICAgIGxldCBweW0gPSAiIjsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBmdWxsTmFtZS5sZW5ndGg7IGkrKykgewogICAgICAgIHZhciBjID0gZnVsbE5hbWUuY2hhckF0KGkpOwogICAgICAgIGlmICgvXltBLVpdKyQvLnRlc3QoYykpIHsKICAgICAgICAgIHB5bSArPSBjOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLmZvcm0uc3BlbGwgPSBweW07CiAgICB9LAogICAgLyoqIOafpeivouWIhuaRiuaWueahiOeuoeeQhuWIl+ihqCAqLwogICAgZ2V0TGlzdCgpIHsKICAgICAgdGhpcy5sb2FkaW5nID0gdHJ1ZTsKICAgICAgbGlzdFByb2plY3QodGhpcy5xdWVyeVBhcmFtcykudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgdGhpcy5wcm9qZWN0TGlzdCA9IHJlc3BvbnNlLnJvd3M7CiAgICAgICAgdGhpcy50b3RhbCA9IHJlc3BvbnNlLnRvdGFsOwogICAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlOwogICAgICB9KTsKICAgIH0sCiAgICAvLyDmlrnmoYjnsbvlnovlrZflhbjnv7vor5EKICAgIHByb2plY3RUeXBlRm9ybWF0KHJvdywgY29sdW1uKSB7CiAgICAgIHJldHVybiB0aGlzLnNlbGVjdERpY3RMYWJlbCh0aGlzLnByb2plY3RUeXBlT3B0aW9ucywgcm93LnByb2plY3RUeXBlKTsKICAgIH0sCiAgICAvLyDlvLnmoYblhbPpl60KICAgIGhhbmRsZURpYWxvZ0Nsb3NlKCkgewogICAgICB0aGlzLiRlbWl0KCJjYW5jZWwiLCBmYWxzZSk7CiAgICB9LAogICAgLy8g5Y+W5raICiAgICBjYW5jZWwoKSB7CiAgICAgIHRoaXMuJGVtaXQoImNhbmNlbCIsIGZhbHNlKTsKICAgIH0sCiAgICAvLyDooajljZXph43nva4KICAgIHJlc2V0KCkgewogICAgICB0aGlzLmZvcm0gPSB7CiAgICAgICAgaWQ6IG51bGwsCiAgICAgICAgY29tcENvZGU6IHRoaXMuJHN0b3JlLnN0YXRlLnVzZXIuYWNjb3VudEluZm8uZGVwdElkLAogICAgICAgIGFjY291bnRDb2RlOiBudWxsLAogICAgICAgIHByb2plY3RDb2RlOiBudWxsLAogICAgICAgIHByb2plY3ROYW1lOiBudWxsLAogICAgICAgIG5vd0RhdGU6IG51bGwsCiAgICAgICAgc3BlbGw6IG51bGwsCiAgICAgICAgcHJvamVjdFR5cGU6IG51bGwKICAgICAgfTsKICAgICAgdGhpcy5yZXNldEZvcm0oImZvcm0iKTsKICAgIH0sCiAgICAvKiog5o+Q5Lqk5oyJ6ZKuICovCiAgICBzdWJtaXRGb3JtKHR5cGUpIHsKICAgICAgdGhpcy4kcmVmc1siZm9ybSJdLnZhbGlkYXRlKHZhbGlkID0+IHsKICAgICAgICBpZiAodmFsaWQpIHsKICAgICAgICAgIGxldCBzYXZlTG9hZGluZyA9IHRoaXMuc2F2ZUxvYWRpbmcoKTsKICAgICAgICAgIGlmICh0aGlzLmZvcm0uaWQgIT0gbnVsbCkgewogICAgICAgICAgICB1cGRhdGVQcm9qZWN0KHRoaXMuZm9ybSkudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgICAgICAgdGhpcy5tc2dTdWNjZXNzKCLkv67mlLnmiJDlip8iKTsKICAgICAgICAgICAgICB0aGlzLiRlbWl0KCJzdWNjZXNzIiwgZmFsc2UpOwogICAgICAgICAgICAgIHNhdmVMb2FkaW5nLmNsb3NlKCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYWRkUHJvamVjdCh0aGlzLmZvcm0pLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgICAgICAgIGlmKHR5cGUpewogICAgICAgICAgICAgICAgdGhpcy5tc2dTdWNjZXNzKCLkv53lrZjmiJDlip8iKTsKICAgICAgICAgICAgICAgIHRoaXMucmVzZXQoKQogICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgdGhpcy5tc2dTdWNjZXNzKCLmlrDlop7miJDlip8iKTsKICAgICAgICAgICAgICAgIHRoaXMuJGVtaXQoInN1Y2Nlc3MiLCBmYWxzZSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHNhdmVMb2FkaW5nLmNsb3NlKCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogIH19Owo="},{"version":3,"sources":["addEdit.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0CA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"addEdit.vue","sourceRoot":"src/views/apportionment/project","sourcesContent":["<template>\n  <el-dialog :title=\"title\" :visible.sync=\"openDialog\" width=\"30%\"  custom-class=\"el-button--primary\" append-to-body :close-on-click-modal=\"false\" @close=\"handleDialogClose\">\n    <el-form ref=\"form\" :model=\"form\" :rules=\"rules\" label-width=\"80px\">\n      <el-row>\n        <el-form-item label=\"方案编码\" prop=\"projectCode\">\n          <el-input v-model=\"form.projectCode\" placeholder=\"请输入方案编码\"  maxlength=\"50\" show-word-limit  />\n        </el-form-item>\n        <el-form-item label=\"方案名称\" prop=\"projectName\">\n          <el-input v-model=\"form.projectName\" placeholder=\"请输入方案名称\"  maxlength=\"50\" show-word-limit @blur=\"getPym\"  />\n        </el-form-item>\n        <el-form-item label=\"当前年月\" prop=\"nowDate\" >\n          <el-date-picker clearable size=\"small\" class=\"w100\" disabled\n                          v-model=\"form.nowDate\"\n                          type=\"month\"\n                          value-format=\"yyyy-MM\"\n                          placeholder=\"选择当前年月\">\n          </el-date-picker>\n        </el-form-item>\n        <el-form-item label=\"拼音码\" prop=\"spell\" >\n          <el-input v-model=\"form.spell\"  disabled maxlength=\"50\" show-word-limit  :placeholder=\"pym\" />\n        </el-form-item>\n        <el-form-item label=\"方案类型\" prop=\"projectType\" >\n          <el-select v-model=\"form.projectType\" class=\"w100\" placeholder=\"请选择方案类型\" disabled>\n            <el-option\n              v-for=\"dict in projectTypeOptions\"\n              :key=\"dict.dictValue\"\n              :label=\"dict.dictLabel\"\n              :value=\"dict.dictValue\"\n            ></el-option>\n          </el-select>\n        </el-form-item>\n      </el-row>\n    </el-form>\n    <div slot=\"footer\" class=\"dialog-footer\">\n      <el-button type=\"primary\" @click=\"submitForm(true)\" v-show=\"!id\" >保存并继续添加</el-button>\n      <el-button type=\"primary\" @click=\"submitForm(false)\" >确 定</el-button>\n      <el-button @click=\"cancel\">取 消</el-button>\n    </div>\n  </el-dialog>\n</template>\n\n<script>\n  import { validEmail } from'@/utils/validate'\n  import { listProject, getProject, delProject, addProject, updateProject, exportProject } from \"@/api/apportionment/project\";\n  import pinyin from \"js-pinyin\";\n  import {getYear} from \"@/utils/date\";\n  import { getCostApport } from \"@/api/system/dict/data\"\n\n  export default {\n    name: \"addEdit\",\n    props: {\n      open: {\n        type: Boolean,\n        default: false\n      },\n      id: {\n        type: [String, Number],\n        default: \"\"\n      }\n    },\n    watch: {\n      id: {\n        handler(val) {\n          this.reset();\n          if (val) {\n            this.id = val;\n            this.title = \"分摊方案管理-编辑\";\n            this.getDetailInfo();\n          } else {\n            this.id = \"\";\n            this.pym = \"自动生成\";\n            this.form.projectType ='2';\n            this.title = \"分摊方案管理-新增\";\n            this.getCostApport();\n          }\n        },\n        deep: true,\n        immediate: true\n      },\n      open: {\n        handler(val) {\n          this.openDialog = val;\n        },\n        deep: true\n      }\n    },\n    components: {\n      getCostApport\n    },\n    data() {\n      return {\n        title: \"分摊方案管理-新增\",\n        openDialog: this.open,\n        pym: \"\",\n        // 表单参数\n        form: {},\n        projectTypeOptions: [],\n        // 表单校验\n        rules: {\n          projectCode: [\n            { required: true, message: \"方案编码不能为空\", trigger: \"blur\" }\n          ],\n          projectName: [\n            { required: true, message: \"方案名称不能为空\", trigger: \"blur\" }\n          ],\n          nowDate: [\n            { required: true, message: \"当前年月不能为空\", trigger: \"blur\" }\n          ],\n          projectType:[\n            { required: true, message: \"方案类型不能为空\", trigger: \"blur\" }\n          ],\n        }\n      };\n    },\n    created() {\n      this.getList();\n      this.getDicts(\"cost_fa_type\").then(response => {\n        this.projectTypeOptions = response.data;\n      });\n    },\n    methods: {\n      getDetailInfo() {\n        getProject(this.id).then(response => {\n          console.log(response);\n          this.form = response.data;\n        });\n      },\n      getCostApport() {\n        getCostApport(this.$store.state.user.accountInfo.deptId).then(response => {\n          if (response.data) {\n            this.form.nowDate = response.data;\n          } else {\n            this.form.nowDate = getYear();\n          }\n        });\n      },\n      // 获取拼音码\n      getPym() {\n        // 全是字母的情况下,拼音码等于所有字母\n        if (/^[a-zA-Z]*$/.test(this.form.projectName)) {\n          this.form.spell = this.form.projectName;\n          return;\n        }\n        // 有汉字的情况下,转为首字母\n        let fullName = pinyin.getCamelChars(this.form.projectName).toUpperCase();\n        let pym = \"\";\n        for (var i = 0; i < fullName.length; i++) {\n          var c = fullName.charAt(i);\n          if (/^[A-Z]+$/.test(c)) {\n            pym += c;\n          }\n        }\n        this.form.spell = pym;\n      },\n      /** 查询分摊方案管理列表 */\n      getList() {\n        this.loading = true;\n        listProject(this.queryParams).then(response => {\n          this.projectList = response.rows;\n          this.total = response.total;\n          this.loading = false;\n        });\n      },\n      // 方案类型字典翻译\n      projectTypeFormat(row, column) {\n        return this.selectDictLabel(this.projectTypeOptions, row.projectType);\n      },\n      // 弹框关闭\n      handleDialogClose() {\n        this.$emit(\"cancel\", false);\n      },\n      // 取消\n      cancel() {\n        this.$emit(\"cancel\", false);\n      },\n      // 表单重置\n      reset() {\n        this.form = {\n          id: null,\n          compCode: this.$store.state.user.accountInfo.deptId,\n          accountCode: null,\n          projectCode: null,\n          projectName: null,\n          nowDate: null,\n          spell: null,\n          projectType: null\n        };\n        this.resetForm(\"form\");\n      },\n      /** 提交按钮 */\n      submitForm(type) {\n        this.$refs[\"form\"].validate(valid => {\n          if (valid) {\n            let saveLoading = this.saveLoading();\n            if (this.form.id != null) {\n              updateProject(this.form).then(response => {\n                this.msgSuccess(\"修改成功\");\n                this.$emit(\"success\", false);\n                saveLoading.close();\n              });\n            } else {\n              addProject(this.form).then(response => {\n                if(type){\n                  this.msgSuccess(\"保存成功\");\n                  this.reset()\n                }else{\n                  this.msgSuccess(\"新增成功\");\n                  this.$emit(\"success\", false);\n                }\n                saveLoading.close();\n              });\n            }\n          }\n        });\n      },\n    }};\n</script>\n<style lang=\"scss\" scoped>\n  ::v-deep .el-dialog {\n    overflow: hidden;\n    min-height:20%;\n    .el-dialog__body {\n      height: calc(100% - 100px);\n      overflow: auto;\n    }\n  }\n</style>\n"]}]}