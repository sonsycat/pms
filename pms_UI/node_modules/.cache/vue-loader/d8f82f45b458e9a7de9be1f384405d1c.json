{"remainingRequest":"F:\\pms_UI\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\pms_UI\\src\\views\\revenue\\revenuenum\\addEdit.vue?vue&type=style&index=0&id=f28ed5da&lang=scss&scoped=true&","dependencies":[{"path":"F:\\pms_UI\\src\\views\\revenue\\revenuenum\\addEdit.vue","mtime":1693362205911},{"path":"F:\\pms_UI\\node_modules\\css-loader\\dist\\cjs.js","mtime":1693361949271},{"path":"F:\\pms_UI\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1693362179282},{"path":"F:\\pms_UI\\node_modules\\postcss-loader\\src\\index.js","mtime":1693362110683},{"path":"F:\\pms_UI\\node_modules\\sass-loader\\dist\\cjs.js","mtime":1693362152666},{"path":"F:\\pms_UI\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1693361924439},{"path":"F:\\pms_UI\\node_modules\\vue-loader\\lib\\index.js","mtime":1693362179279}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCjo6di1kZWVwIC5lbC1kaWFsb2cgewogIG1pbi1oZWlnaHQ6IDIwJTsKICBvdmVyZmxvdzogaGlkZGVuOwogIC5lbC1kaWFsb2dfX2JvZHkgewogICAgaGVpZ2h0OiBjYWxjKDEwMCUgLSAxMDBweCk7CiAgICBvdmVyZmxvdzogYXV0bzsKICAgIC5lbC1pbnB1dC0tbWluaSwuZWwtaW5wdXQtbnVtYmVyLS1taW5pLC5lbC1zZWxlY3QtLW1pbml7CiAgICAgIHdpZHRoOiAxMDAlOwogICAgfQogIH0KfQo="},{"version":3,"sources":["addEdit.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsZA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"addEdit.vue","sourceRoot":"src/views/revenue/revenuenum","sourcesContent":["<template>\n    <el-dialog :title=\"title\"  :visible.sync=\"openDialog\" width=\"40%\" custom-class=\"el-button--primary\" append-to-body :close-on-click-modal=\"false\" @close=\"handleDialogClose\">\n      <el-form ref=\"form\" v-loading=\"loading\" :model=\"form\" :rules=\"rules\" label-width=\"100px\">\n        <el-row >\n          <el-col :span=\"12\">\n            <el-form-item label=\"收入项目:\" prop=\"revenueCode\"   >\n              <el-select v-model=\"form.revenueCode\" filterable clearable placeholder=\"请选择收入项目\" @change=\"changeProject\">\n                <el-option\n                  v-for=\"dict in projectList\"\n                  :key=\"dict.revenueCode\"\n                  :label=\"dict.revenueName\"\n                  :value=\"dict.revenueCode\"\n                ></el-option>\n              </el-select>\n            </el-form-item>\n          </el-col>\n          <el-col :span=\"12\">\n            <el-form-item label=\"应收金额:\" prop=\"receiveNum\">\n              <el-input-number controls-position=\"right\" :min=\"0\" :precision=\"2\" v-model=\"form.receiveNum\"  placeholder=\"请输入应收金额\"/>\n            </el-form-item>\n          </el-col>\n          <el-col :span=\"12\">\n            <el-form-item label=\"实际金额:\" prop=\"actualNum\">\n              <el-input-number controls-position=\"right\" :min=\"0\" :precision=\"2\" v-model=\"form.actualNum\"  placeholder=\"请输入实际金额\"/>\n            </el-form-item>\n          </el-col>\n          <el-col :span=\"12\">\n            <el-form-item label=\"开单科室:\" prop=\"billDept\">\n              <el-select v-model=\"form.billDept\" filterable placeholder=\"请选择开单科室\" clearable>\n                <el-option\n                  v-for=\"dict in billDeptList\"\n                  :key=\"dict.deptRoomId\"\n                  :label=\"dict.deptRoomName\"\n                  :value=\"dict.deptRoomId\"\n                />\n              </el-select>\n            </el-form-item>\n          </el-col>\n          <el-col :span=\"12\">\n            <el-form-item label=\"执行科室:\" prop=\"execDept\">\n              <el-select v-model=\"form.execDept\" placeholder=\"请选择执行科室\" filterable clearable>\n                <el-option\n                  v-for=\"dict in execDeptList\"\n                  :key=\"dict.deptRoomId\"\n                  :label=\"dict.deptRoomName\"\n                  :value=\"dict.deptRoomId\"\n                />\n              </el-select>\n            </el-form-item>\n          </el-col>\n          <el-col :span=\"12\">\n            <el-form-item label=\"护理单元:\" prop=\"careDept\">\n              <el-select v-model=\"form.careDept\" placeholder=\"请选择护理单元\" filterable clearable :disabled=\"disableCare\">\n                <el-option\n                  v-for=\"dict in careDeptList\"\n                  :key=\"dict.deptRoomId\"\n                  :label=\"dict.deptRoomName\"\n                  :value=\"dict.deptRoomId\"\n                />\n                </el-select>\n            </el-form-item>\n          </el-col>\n          <el-col :span=\"12\">\n            <el-form-item label=\"开单医生:\" prop=\"billDoc\">\n              <el-input v-model=\"form.billDoc\" placeholder=\"请输入开单医生\"  maxlength=\"20\" show-word-limit  />\n            </el-form-item>\n          </el-col>\n          <el-col :span=\"12\">\n            <el-form-item label=\"收入类别:\" prop=\"revenueType\">\n              <el-select v-model=\"form.revenueType\" clearable placeholder=\"请输入收入类别\" @change=\"changeRevenueType\">\n              <el-option\n                v-for=\"dict in revenueTypeOptions\"\n                :key=\"dict.dictValue\"\n                :label=\"dict.dictLabel\"\n                :value=\"dict.dictValue\"\n              ></el-option>\n              </el-select>\n            </el-form-item>\n          </el-col>\n          <el-col :span=\"12\">\n            <el-form-item label=\"结算标识:\" prop=\"settleMark\">\n            <el-select v-model=\"form.settleMark\" clearable placeholder=\"请选择结算标识\">\n              <el-option\n                v-for=\"dict in settleMarkOptions\"\n                :key=\"dict.dictValue\"\n                :label=\"dict.dictLabel\"\n                :value=\"dict.dictValue\"\n              ></el-option>\n              </el-select>\n            </el-form-item>\n          </el-col>\n          <el-col :span=\"12\">\n            <el-form-item label=\"发生时间:\" prop=\"occureTime\">\n              <el-date-picker clearable\n                v-model=\"form.occureTime\"\n                type=\"date\"\n                value-format=\"yyyy-MM-dd\"\n                placeholder=\"选择发生时间\">\n              </el-date-picker>\n            </el-form-item>\n          </el-col>\n          <el-col :span=\"24\">\n            <el-form-item label=\"备注:\" prop=\"remark\">\n              <el-input v-model=\"form.remark\" type=\"textarea\" maxlength=\"100\" show-word-limit rows=\"4\" placeholder=\"请输入内容\" resize=\"none\" />\n            </el-form-item>\n          </el-col>\n        </el-row>\n      </el-form>\n      <div slot=\"footer\" class=\"dialog-footer\">\n        <el-button type=\"primary\" @click=\"submitForm\" >确 定</el-button>\n        <el-button @click=\"cancel\">取 消</el-button>\n      </div>\n    </el-dialog>\n</template>\n\n<script>\nimport { validEmail } from'@/utils/validate'\nimport { listRevenuenum, getRevenuenum, delRevenuenum, addRevenuenum, updateRevenuenum, exportRevenuenum } from \"@/api/revenue/revenuenum\";\nimport {listRevenue} from \"@/api/revenue/revenue\";\nimport {treeRoom} from '@/api/until';\nimport revenuePop from \"@/views/components/revenuePop\";\nexport default {\n  name: \"addEdit\",\n  props: {\n    open: {\n      type: Boolean,\n      default: false\n    },\n    id: {\n      type: [String, Number],\n      default: \"\"\n    },\n    queryParams:{\n      type:Object,\n      default:null\n    }\n  },\n  watch: {\n    id: {\n      handler(val) {\n        this.reset();\n        if (val) {\n          this.id = val;\n          this.title = \"收入录入管理-编辑\";\n          this.getDetailInfo();\n        } else {\n          this.id = \"\";\n          this.title = \"收入录入管理-新增\";\n        }\n      },\n      deep: true,\n      immediate: true\n    },\n    open: {\n      handler(val) {\n        this.openDialog = val;\n      },\n      deep: true\n    }\n  },\n  components: {\n    revenuePop\n  },\n  data() {\n    return {\n      disableCare: false,\n      title: \"收入录入管理-新增\",\n      openDialog: this.open,\n      loading:false,\n      // 表单参数\n      form: {},\n      revenueTypeOptions: [],\n      settleMarkOptions: [],\n      projectList:[],\n      billDeptList:[],//开单科室\n      execDeptList:[],//执行科室\n      careDeptList:[],//护理单元\n\t    // 表单校验\n      rules: {\n        revenueCode: [\n          { required: true, message: \"收入项目不能为空\", trigger: \"blur\" }\n        ],\n        revenueName: [\n          { required: true, message: \"收入项目不能为空\", trigger: \"blur\" }\n        ],\n        receiveNum: [\n          { required: true, message: \"应收金额不能为空\", trigger: \"blur\" }\n        ],\n        actualNum: [\n          { required: true, message: \"实际金额不能为空\", trigger: \"blur\" }\n        ],\n        billDept: [\n          { required: true, message: \"开单科室不能为空\", trigger: \"blur\" }\n        ],\n        execDept: [\n          { required: true, message: \"执行科室不能为空\", trigger: \"blur\" }\n        ],\n        careDept: [\n          { required: true, message: \"护理单元不能为空\", trigger: \"blur\" }\n        ],\n        billDoc: [\n          { required: true, message: \"开单医生不能为空\", trigger: \"blur\" }\n        ],\n        revenueType: [\n          { required: true, message: \"请选择收入类别\", trigger: [\"blur\",\"change\"] }\n        ],\n        settleMark: [\n          { required: true, message: \"请选择结算标识\", trigger: [\"blur\",\"change\"] }\n        ],\n        occureTime: [\n          { required: true, message: \"请选择发生日期\", trigger: [\"blur\",\"change\"] }\n        ],\n      }\n    };\n  },\n  created() {\n    this.getList();\n    this.getDicts(\"pms_srlb_type\").then(response => {\n      this.revenueTypeOptions = response.data;\n    });\n    this.getDicts(\"pms_jsbs_type\").then(response => {\n      this.settleMarkOptions = response.data;\n    });\n    this.getRevenueList();\n    this.getDeptList(this.$store.state.user.userInfo.deptId);\n  },\n  methods: {\n    changeProject(projectCode) {\n      let flag = false;\n      for (let i in this.projectList) {\n        if (this.projectList[i].revenueCode == projectCode) {\n          if (this.form.revenueType == '2') {\n            if (this.projectList[i].inpCare == '0') {\n              this.form.careDept = null;\n              this.disableCare = true;\n              flag = true;\n            }\n          } else {\n            if (this.projectList[i].outpCare == '0') {\n              this.form.careDept = null;\n              this.disableCare = true;\n              flag = true;\n            }\n          }\n        }\n      }\n      if (flag == false) {\n        this.disableCare = false;\n        this.rules.careDept =  [\n          { required: true, message: \"护理单元不能为空\", trigger: \"blur\" }\n        ];\n      } else {\n        this.rules.careDept =  [\n        ];\n      }\n    },\n    changeRevenueType() {\n      this.changeProject(this.form.revenueCode);\n    },\n  \tgetDetailInfo() {\n      this.loading=true\n      getRevenuenum(this.id).then(response => {\n        console.log(response);\n        this.loading=false\n        this.form = response.data;\n        this.disableCare = false;\n        let flag = false;\n        this.getRevenueList();\n        listRevenue(this.queryParams).then(response=>{\n          this.projectList=response.rows\n          for (let i in this.projectList) {\n            if (this.projectList[i].revenueCode == this.form.revenueCode) {\n              if (this.form.revenueType == '2') {\n                if (this.projectList[i].inpCare == '0') {\n                  this.form.careDept = null;\n                  this.disableCare = true;\n                  flag = true;\n                }\n              } else {\n                if (this.projectList[i].outpCare == '0') {\n                  this.form.careDept = null;\n                  this.disableCare = true;\n                  flag = true;\n                }\n              }\n            }\n          }\n          if (flag == false) {\n            this.disableCare = false;\n            this.rules.careDept =  [\n              { required: true, message: \"护理单元不能为空\", trigger: \"blur\" }\n            ];\n          } else {\n            this.rules.careDept =  [\n            ];\n          }\n        })\n      });\n    },\n    /** 查询收入录入列表 */\n    getList() {\n      this.loading = true;\n      this.queryParams.params = {};\n      if (null != this.daterangeOccureTime && '' != this.daterangeOccureTime) {\n        this.queryParams.params[\"beginOccureTime\"] = this.daterangeOccureTime[0];\n        this.queryParams.params[\"endOccureTime\"] = this.daterangeOccureTime[1];\n      }\n      listRevenuenum(this.queryParams).then(response => {\n        this.revenuenumList = response.rows;\n        this.total = response.total;\n        this.loading = false;\n      });\n    },\n    //获取开单科室\n    getDeptList(deptId){\n      let data={deptId:deptId}\n      treeRoom(data).then(response=>{\n        if(response.code==200){\n          this.billDeptList=JSON.parse(JSON.stringify(response.rows))\n          this.execDeptList=JSON.parse(JSON.stringify(response.rows))\n          this.careDeptList=JSON.parse(JSON.stringify(response.rows))\n        }\n      })\n    },\n    //获取收入核算收入项目列表\n    getRevenueList(){\n      listRevenue(this.queryParams).then(response=>{\n        this.projectList=response.rows\n      })\n    },\n    // 收入类别(1门诊，2住院)字典翻译\n    revenueTypeFormat(row, column) {\n      return this.selectDictLabel(this.revenueTypeOptions, row.revenueType);\n    },\n    // 结算标识(1收付实现，2责权发生)字典翻译\n    settleMarkFormat(row, column) {\n      return this.selectDictLabel(this.settleMarkOptions, row.settleMark);\n    },\n    // 弹框关闭\n    handleDialogClose() {\n      this.$emit(\"cancel\", false);\n    },\n    // 取消\n    cancel() {\n      this.$emit(\"cancel\", false);\n    },\n    // 表单重置\n    reset() {\n      this.form = {\n        id: null,\n        compCode: this.$store.state.user.userInfo.deptId,\n        accountCode: null,\n        revenueCode: null,\n        revenueName:null,\n        receiveNum: null,\n        actualNum: null,\n        billDept: null,\n        execDept: null,\n        careDept: null,\n        billDoc: null,\n        execDeptName: null,\n        careDeptName: null,\n        billDocName: null,\n        occureTime: null,\n        revenueType: '1',\n        settleMark: null,\n        revenueKind: null,\n        delFlag: null,\n        createBy: null,\n        createTime: null,\n        updateBy: null,\n        updateTime: null,\n        remark: null\n      };\n      this.resetForm(\"form\");\n    },\n    handleClickOrgPop(idx,row,datas){\n      let data = [\"revenueCode\",\"revenueName\",\"revenueType\",\"money\"];\n      data.forEach(key => {\n        this.$set(row, key, datas[key]);\n      })\n    },\n    /** 提交按钮 */\n    submitForm() {\n      this.$refs[\"form\"].validate(valid => {\n        if (valid) {\n        let saveLoading=this.saveLoading();\n          if (this.form.id != null) {\n            updateRevenuenum(this.form).then(response => {\n              this.msgSuccess(\"修改成功\");\n              this.$emit(\"success\", false);\n              saveLoading.close()\n            });\n          } else {\n            addRevenuenum(this.form).then(response => {\n              this.msgSuccess(\"新增成功\");\n              this.$emit(\"success\", false);\n              saveLoading.close()\n            });\n          }\n        }\n      });\n    },\n}};\n</script>\n<style lang=\"scss\" scoped>\n  ::v-deep .el-dialog {\n    min-height: 20%;\n    overflow: hidden;\n    .el-dialog__body {\n      height: calc(100% - 100px);\n      overflow: auto;\n      .el-input--mini,.el-input-number--mini,.el-select--mini{\n        width: 100%;\n      }\n    }\n  }\n</style>\n"]}]}