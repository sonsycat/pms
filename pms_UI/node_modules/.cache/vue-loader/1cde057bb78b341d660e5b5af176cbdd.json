{"remainingRequest":"E:\\HRP_JAVA_pms\\pms_UI\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\HRP_JAVA_pms\\pms_UI\\src\\views\\components\\extractForm\\index.vue?vue&type=style&index=0&id=b2e32bee&lang=scss&scoped=true&","dependencies":[{"path":"E:\\HRP_JAVA_pms\\pms_UI\\src\\views\\components\\extractForm\\index.vue","mtime":1693362205048},{"path":"E:\\HRP_JAVA_pms\\pms_UI\\node_modules\\css-loader\\dist\\cjs.js","mtime":1693361949271},{"path":"E:\\HRP_JAVA_pms\\pms_UI\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1693362179282},{"path":"E:\\HRP_JAVA_pms\\pms_UI\\node_modules\\postcss-loader\\src\\index.js","mtime":1693362110683},{"path":"E:\\HRP_JAVA_pms\\pms_UI\\node_modules\\sass-loader\\dist\\cjs.js","mtime":1693362152666},{"path":"E:\\HRP_JAVA_pms\\pms_UI\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1693361924439},{"path":"E:\\HRP_JAVA_pms\\pms_UI\\node_modules\\vue-loader\\lib\\index.js","mtime":1693362179279}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCjo6di1kZWVwIC5lbC1kaWFsb2cgewogIG1pbi1oZWlnaHQ6IDIwJTsKICBvdmVyZmxvdzogaGlkZGVuOwogIC5lbC1kaWFsb2dfX2JvZHkgewogICAgaGVpZ2h0OiBjYWxjKDEwMCUgLSAxMDBweCk7CiAgICBvdmVyZmxvdzogYXV0bzsKICB9CiAgLmVsLWlucHV0LS1taW5pewogICAgICB3aWR0aDozMDBweAogIH0KfQo="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/components/extractForm","sourcesContent":["<template>\n     <el-dialog :title=\"title\" :visible.sync=\"openExtract\" width=\"50%\" custom-class=\"el-button--primary\" append-to-body :close-on-click-modal=\"false\" @close=\"handleDialogClose\">\n     <el-form ref=\"form\" :model=\"form\" :rules=\"rules\" label-width=\"80px\">\n         <el-col :span=\"12\">\n          <el-form-item label=\"SQL类型:\" prop=\"sqlType\">\n            <el-select v-model=\"form.sqlType\" :remote=\"isRemote\" @change=\"changeSqlType\" @click=\"changeSqlType\" placeholder=\"请选择SQL类型\">\n              <el-option\n                v-for=\"dict in statusOptions\"\n                :key=\"dict.dictValue\"\n                :label=\"dict.dictLabel\"\n                :value=\"dict.dictValue\"\n              >\n              </el-option>\n            </el-select>\n          </el-form-item>\n        </el-col>\n        <el-col :span=\"12\">\n          <el-form-item label=\"数据源:\"  prop=\"coonectCode\" >\n          <el-select v-model=\"form.coonectCode\" placeholder=\"请选择数据源\" >\n            <el-option\n                v-for=\"dict in coonectOptions\"\n                :key=\"dict.code\"\n                :label=\"dict.name\"\n                :value=\"dict.code\"\n              ></el-option>\n          </el-select>\n        </el-form-item>\n        </el-col>\n        <el-col :span=\"12\">\n          <el-form-item label=\"年月:\" prop=\"nowDate\">\n                <el-date-picker :clearable=\"false\"\n                    v-model=\"form.nowDate\"\n                    type=\"month\"\n                    value-format=\"yyyy-MM\"\n                    placeholder=\"选择年月\"\n                    >\n                </el-date-picker>\n            </el-form-item>\n        </el-col>\n        <el-col :span=\"24\">\n          <el-form-item label=\"分摊SQL:\" prop=\"numSql\">\n                <el-input :style=\"{width:'94%'}\" v-model=\"form.numSql\" @change=\"changeNumSql\" @input=\"changeNumSql\" type=\"textarea\" rows=\"10\" placeholder=\"请输入内容\" />\n            </el-form-item>\n        </el-col>\n      </el-form>\n      <div slot=\"footer\" class=\"dialog-footer\">\n        <el-button type=\"primary\" @click=\"submitForm\" :loading=\"saveLoading\" >保存</el-button>\n        <el-button @click=\"cancel\">取 消</el-button>\n      </div>\n    </el-dialog>\n</template>\n\n<script>\nimport { listDatabase } from \"@/api/apportionment/database\";\nimport { searchForSQL, extractForProject, beforeExtractProject} from \"@/api/project/num\";\nimport { extractForProjectInCome,beforeExtract} from \"@/api/revenue/revenuenum\";\n\nexport default {\n    name: 'extractForm',\n    props: {\n        open: {\n            type: Boolean,\n            default: false\n        },\n        id: {\n            type: [String, Number],\n            default: \"\"\n        },\n        queryForm:{\n            type: [Object,String],\n            default: \"\"\n        },\n        isInCome:{\n            type:Boolean,\n            default:false\n        }\n    },\n    watch:{\n        open: {\n            handler(val) {\n                this.openExtract = val;\n            },\n            deep: true\n        },\n    },\n    data() {\n        return {\n            title: this.isInCome?'成本提取':'收入提取',\n            openExtract: this.open,\n            saveLoading:false,\n            isRemote:true,\n            coonectOptions: [],//数据源\n            statusOptions:[],//sql数据类型\n            form: {},//表单参数\n            deptTypeOptions:[],\n            ratioTypeOptions:[],\n            rules:{\n                coonectCode: [\n                    { required: true, message: \"数据源不能为空\", trigger: \"change\" }\n                ],\n                 nowDate: [\n                    { required: true, message: \"当前年月不能为空\", trigger: \"blur\" }\n                ],\n                sqlType: [\n                    { required: true, message: \"请选择成本类型\", trigger: \"blur\" }\n                ],\n                numSql: [\n                    { required: true, message: \"请输入分摊sql内容\", trigger: \"blur\" }\n                ],\n            }\n        };\n    },\n    created(){\n        this.getBeforeList();\n        this.getList();\n        this.getDicts(\"cost_sql_type\").then(response => {\n            this.statusOptions = response.data;\n        });\n    },\n    mounted() {\n\n    },\n\n    methods: {\n        getBeforeList(){\n            let query={\n                comeCode:this.$store.state.user.accountInfo.deptId,\n            }\n            if(this.isInCome){\n               beforeExtractProject(query).then(response=>{\n                   if(response.code===200){\n                        this.form.sqlType=response.rows[0].sqlType\n                        this.form.numSql=response.rows[0].numSql\n                   }\n                })\n            }else{\n                beforeExtract(query).then(response=>{\n                    if(response.code===200){\n                        this.form.sqlType=response.rows[0].sqlType\n                        this.form.numSql=response.rows[0].numSql\n                    }\n                })\n            }\n\n        },\n        getList() {\n            //数据源获取\n            listDatabase(this.queryParams).then(response => {\n                this.coonectOptions = response.rows;\n            });\n        },\n        changeSqlType(e){\n            this.reset(1)\n            this.form.sqlType=e\n        },\n        changeNumSql(e){\n            this.reset(2)\n            this.form.numSql=e\n        },\n         cancel() {\n            this.$emit(\"cancel\", false);\n        },\n         // 弹框关闭\n        handleDialogClose() {\n            this.$emit(\"cancel\", false);\n            this.resetForm('form')\n        },\n        reset(type){\n            if(type==1){\n                this.form={\n                    sqlType: \"\",\n                    numSql:this.form.numSql\n                }\n            }else{\n                this.form={\n                    sqlType:this.form.sqlType,\n                    numSql: \"\",\n                }\n            }\n\n        },\n        submitForm(){\n             this.$refs[\"form\"].validate(valid => {\n                 if(valid){\n                     let costProjectNumSql={\n                        compCode:this.$store.state.user.userInfo.deptId,\n                        ...this.form\n                    }\n                    if (this.isInCome) {\n                        extractForProject(costProjectNumSql).then(response=>{\n                            if(response.code===200){\n                                this.msgSuccess('成本提取成功')\n                                this.$emit(\"cancel\", false);\n                            }\n                        })\n                    }else{\n                        extractForProjectInCome(costProjectNumSql).then(response=>{\n                            if(response.code===200){\n                                this.msgSuccess('收入提取成功')\n                                this.$emit(\"cancel\", false);\n                            }\n                        })\n                    }\n                 }\n             })\n        }\n    },\n};\n</script>\n\n<style lang=\"scss\" scoped>\n  ::v-deep .el-dialog {\n    min-height: 20%;\n    overflow: hidden;\n    .el-dialog__body {\n      height: calc(100% - 100px);\n      overflow: auto;\n    }\n    .el-input--mini{\n        width:300px\n    }\n  }\n</style>\n"]}]}