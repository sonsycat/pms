{"remainingRequest":"D:\\hrp\\zjry-pms-ui\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\hrp\\zjry-pms-ui\\src\\views\\revenue\\revenue\\index.vue?vue&type=style&index=0&id=3b27e8c2&lang=scss&scoped=true&","dependencies":[{"path":"D:\\hrp\\zjry-pms-ui\\src\\views\\revenue\\revenue\\index.vue","mtime":1682043106421},{"path":"D:\\hrp\\zjry-pms-ui\\node_modules\\css-loader\\dist\\cjs.js","mtime":1682058377861},{"path":"D:\\hrp\\zjry-pms-ui\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1682058382042},{"path":"D:\\hrp\\zjry-pms-ui\\node_modules\\postcss-loader\\src\\index.js","mtime":1682058378631},{"path":"D:\\hrp\\zjry-pms-ui\\node_modules\\sass-loader\\dist\\cjs.js","mtime":1682058378517},{"path":"D:\\hrp\\zjry-pms-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1682058377348},{"path":"D:\\hrp\\zjry-pms-ui\\node_modules\\vue-loader\\lib\\index.js","mtime":1682058381348}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKOjp2LWRlZXB7CiAgLmVsLXRhYmxlX19ib2R5LXdyYXBwZXIuaXMtc2Nyb2xsaW5nLWxlZnR7CiAgICAgIGhlaWdodDphdXRvICFpbXBvcnRhbnQ7CiAgICAgIG1heC1oZWlnaHQ6Y2FsYygxMDB2aCAtIDMyNnB4KSAhaW1wb3J0YW50OwogICAgfQogICAgLmVsLXRhYmxlX19ib2R5LXdyYXBwZXIuaXMtc2Nyb2xsaW5nLW1pZGRsZXsKICAgICAgbWF4LWhlaWdodDpjYWxjKDEwMHZoIC0gMzI2cHgpICFpbXBvcnRhbnQ7CiAgICAgIGhlaWdodDphdXRvICFpbXBvcnRhbnQ7CiAgICB9CiAgICAuZWwtdGFibGVfX2JvZHktd3JhcHBlci5pcy1zY3JvbGxpbmctcmlnaHR7CiAgICAgIGhlaWdodDphdXRvICFpbXBvcnRhbnQ7CiAgICAgIG1heC1oZWlnaHQ6Y2FsYygxMDB2aCAtIDMyNnB4KSAhaW1wb3J0YW50OwogICAgfQp9Cg=="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkcA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/revenue/revenue","sourcesContent":["<template>\n  <div class=\"app-container\">\n  <div ref=\"search\">\n    <el-form :model=\"queryParams\" ref=\"queryForm\" :inline=\"true\" v-show=\"showSearch\">\n      <el-form-item label=\"项目编码\" prop=\"revenueCode\">\n        <el-input\n          class=\"search_w220\"\n          v-model=\"queryParams.revenueCode\"\n          placeholder=\"请输入项目编码\"\n          clearable\n          @keyup.enter.native=\"handleQuery\"\n        />\n      </el-form-item>\n      <el-form-item label=\"项目名称\" prop=\"revenueName\">\n        <el-input\n          class=\"search_w220\"\n          v-model=\"queryParams.revenueName\"\n          placeholder=\"请输入项目名称\"\n          clearable\n          @keyup.enter.native=\"handleQuery\"\n        />\n      </el-form-item>\n      <el-form-item label=\"核算类型\" prop=\"accountType\">\n        <el-select class=\"search_w220\" v-model=\"queryParams.accountType\" placeholder=\"请选择核算类型\" clearable>\n          <el-option\n            v-for=\"dict in accountTypeOptions\"\n            :key=\"dict.dictValue\"\n            :label=\"dict.dictLabel\"\n            :value=\"dict.dictValue\"\n          />\n        </el-select>\n      </el-form-item>\n      <el-form-item label=\"成本对照\" prop=\"projectCode\">\n         <el-select class=\"search_w220\" v-model=\"queryParams.projectCode\" :filterable=\"true\" :remote=\"true\" clearable placeholder=\"请选择\">\n                <el-option\n                  v-for=\"dict in projectCodeOptions\"\n                  :key=\"dict.projectCode\"\n                  :label=\"dict.projectName\"\n                  :value=\"dict.projectCode\"\n                ></el-option>\n              </el-select>\n      </el-form-item>\n      <el-form-item label=\"收入类别\" prop=\"hisRevenumTypede\">\n        <el-select class=\"search_w220\" v-model=\"queryParams.hisRevenumTypede\" :filterable=\"true\" :remote=\"true\" clearable placeholder=\"请选择\">\n                <el-option\n                  v-for=\"dict in hisRevenumTypedeOptions\"\n                  :key=\"dict.revenueCode\"\n                  :label=\"dict.revenueName\"\n                  :value=\"dict.revenueCode\"\n                ></el-option>\n              </el-select>\n      </el-form-item>\n      <el-form-item>\n        <el-button type=\"primary\" icon=\"el-icon-search\" size=\"mini\" @click=\"handleQuery\">搜索</el-button>\n        <el-button icon=\"el-icon-refresh\" size=\"mini\" @click=\"resetQuery\">重置</el-button>\n      </el-form-item>\n    </el-form>\n\t</div>\n\t<div ref=\"btns\">\n    <el-row :gutter=\"10\" class=\"mb8\">\n      <el-col :span=\"1.5\">\n        <el-button\n          type=\"primary\"\n          icon=\"el-icon-plus\"\n          size=\"mini\"\n          @click=\"handleAdd\"\n          v-hasPermi=\"['revenue:revenue:add']\"\n        >新增</el-button>\n      </el-col>\n      <el-col :span=\"1.5\">\n        <el-button\n          type=\"success\"\n          icon=\"el-icon-edit\"\n          size=\"mini\"\n          :disabled=\"single\"\n          @click=\"handleUpdate\"\n          v-hasPermi=\"['revenue:revenue:edit']\"\n        >修改</el-button>\n      </el-col>\n      <el-col :span=\"1.5\">\n        <el-button\n          type=\"danger\"\n          icon=\"el-icon-delete\"\n          size=\"mini\"\n          :disabled=\"multiple\"\n          @click=\"handleDelete\"\n          v-hasPermi=\"['revenue:revenue:remove']\"\n        >删除</el-button>\n      </el-col>\n      <el-col :span=\"1.5\">\n        <el-button\n          type=\"primary\"\n          icon=\"el-icon-plus\"\n          :disabled=\"single\"\n          size=\"mini\"\n          @click=\"handleDept\"\n          v-hasPermi=\"['revenue:revenue:edit']\"\n        >第三方科室</el-button>\n      </el-col>\n      <right-toolbar :showSearch.sync=\"showSearch\" @queryTable=\"getList\"></right-toolbar>\n    </el-row>\n\t</div>\n\n    <el-table :height=\"tableHeight\" border stripe v-loading=\"loading\" :data=\"revenueList\" @selection-change=\"handleSelectionChange\" ref=\"multipleTable\" @row-click=\"rowClick\" :row-style=\"rowStyle\" :row-class-name=\"rowClassName\">\n      <el-table-column type=\"selection\" width=\"55\" align=\"center\" />\n      <el-table-column sortable label=\"项目编码\" width=\"160px\" align=\"center\" prop=\"revenueCode\" />\n      <el-table-column sortable label=\"项目名称\" align=\"left\" width=\"160px\" prop=\"revenueName\">\n        <template slot-scope=\"scope\">\n           <el-link type=\"primary\" :underline=\"false\" v-html=\"scope.row.revenueName\" @click.stop=\"handleClickTableName(scope.row)\" class=\"displayBlock text-ellipsis \"></el-link>\n        </template>\n      </el-table-column>\n      <el-table-column sortable label=\"拼音码\" align=\"center\" width=\"160px\" prop=\"spell\" />\n      <el-table-column sortable label=\"住院开单(%)\" width=\"140px\" align=\"right\" prop=\"inpBill\" />\n      <el-table-column sortable label=\"住院执行(%)\" width=\"140px\" align=\"right\" prop=\"inpExec\" />\n      <el-table-column sortable label=\"住院护理(%)\" width=\"140px\" align=\"right\" prop=\"inpCare\" />\n      <el-table-column sortable label=\"门诊开单(%)\" width=\"140px\" align=\"right\" prop=\"outpBill\" />\n      <el-table-column sortable label=\"门诊执行(%)\" width=\"140px\" align=\"right\" prop=\"outpExec\" />\n      <el-table-column sortable label=\"门诊护理(%)\" width=\"140px\" align=\"right\" prop=\"outpCare\" />\n      <el-table-column sortable label=\"合作医疗(%)\" width=\"140px\" align=\"right\" prop=\"coopMed\" />\n      <el-table-column sortable label=\"核算类型\" align=\"center\" width=\"160px\" prop=\"accountType\" :formatter=\"accountTypeFormat\" />\n      <el-table-column sortable label=\"折算比(%)\" width=\"140px\" align=\"right\" prop=\"fixConv\" />\n      <el-table-column sortable label=\"成本对照\" align=\"center\" width=\"160px\" prop=\"projectName\" />\n      <el-table-column sortable label=\"收入类别\" align=\"center\" width=\"160px\" prop=\"hisRevenumTypedeName\" />\n    </el-table>\n\n    <pagination\n      v-show=\"total>0\"\n      :total=\"total\"\n      :page.sync=\"queryParams.pageNum\"\n      :limit.sync=\"queryParams.pageSize\"\n      @pagination=\"getList\"\n    />\n\n\t<addEdit v-if=\"open\" :open=\"open\" :id=\"addEditId\" @cancel=\"cancel\" @success=\"successSubmit\"></addEdit>\n\t<revenueDept v-if=\"open1\" :open=\"open1\" @cancel=\"cancel1\" :queryParams=\"form\" @success=\"successSubmit1\" ></revenueDept>\n  </div>\n</template>\n\n<script>\nimport { listProject } from \"@/api/project/project\";\nimport { listIncome } from \"@/api/basic/income\";\nimport { listRevenue, getRevenue, delRevenue, addRevenue, updateRevenue, exportRevenue } from \"@/api/revenue/revenue\";\nimport addEdit from \"./addEdit\";\nimport revenueDept from './revenueDept'\n\nexport default {\n  name: \"Revenue\",\n  components: {\n    addEdit,\n    revenueDept\n  },\n  data() {\n    return {\n      tableHeight: \"auto\",\n      // 遮罩层\n      loading: true,\n      // 导出遮罩层\n      exportLoading: false,\n      // 选中数组\n      ids: [],\n      // 非单个禁用\n      single: true,\n      // 非多个禁用\n      multiple: true,\n      // 显示搜索条件\n      showSearch: true,\n      // 总条数\n      total: 0,\n      // 收入核算方案表格数据\n      revenueList: [],\n      selectionRow: [],\n      // 弹出层标题\n      title: \"\",\n      // 是否显示弹出层\n      open: false,\n      // 核算类型字典\n      accountTypeOptions: [],\n      hisRevenumTypedeOptions:[],\n      // 查询参数\n      queryParams: {\n        pageNum: 1,\n        pageSize: 30,\n        compCode:this.$store.state.user.userInfo.deptId,\n        accountCode: null,\n        revenueCode: null,\n        revenueName: null,\n        spell: null,\n        inpBill: null,\n        inpExec: null,\n        inpCare: null,\n        outpBill: null,\n        outpExec: null,\n        outpCare: null,\n        coopMed: null,\n        accountType: null,\n        convRatio: null,\n        fixConv: null,\n        projectCode: null,\n        hisRevenumTypede: null,\n      },\n      // 表单参数\n      form: {},\n      // 表单校验\n      rules: {\n      },\n      projectCodeOptions:[],//成本项目\n      open1:false,//科室设置弹框\n      revenueCode:\"\",//科室设置查询参数\n\n    };\n  },\n  created() {\n    this.getHisType()\n    this.getList();\n    this.getProjectList()\n    this.getDicts(\"pms_hs_type\").then(response => {\n      this.accountTypeOptions = response.data;\n    });\n    this.$nextTick(() => {\n      this.resizeHandler();\n      window.addEventListener(\"resize\", this.resizeHandler);\n    });\n  },\n  computed: {\n    listData() {\n      return this.$store.state.app.sidebar.opened;\n    }\n  },\n  watch: {\n    listData(val) {\n      var that = this;\n      setTimeout(function() {\n        that.resizeHandler();\n      }, 300);\n    }\n  },\n  methods: {\n    handleClickTableName(data) {\n        // 选中当前行\n        this.rowClick(data, false);\n        this.handleUpdate(data);\n    },\n    resizeHandler() {\n      let a = this.$refs.search.offsetHeight;\n      let b = this.$refs.btns.offsetHeight;\n      let h =  a + b + 18 + 45 + 84 + 40 + 20;\n      h = h + \"px\";\n      this.tableHeight = `calc(100vh - ${h})`;\n    },\n    /** 查询收入核算方案列表 */\n    getList() {\n      this.loading = true;\n      listRevenue(this.queryParams).then(response => {\n        this.revenueList = response.rows;\n        for (let i = 0; i < this.revenueList.length; i++) {\n          for (var j in this.revenueList[i]) {\n            if ((j==\"inpBill\" || j==\"inpExec\" || j==\"inpCare\" || j==\"outpBill\" || j==\"outpExec\" || j==\"outpCare\" || j==\"coopMed\" || j==\"fixConv\")&&j!=\"id\") {\n              this.revenueList[i][j] = this.moneyFormat(this.revenueList[i][j])\n            }\n          }\n        }\n        this.total = response.total;\n        this.loading = false;\n      });\n    },\n     //his收入类别\n    getHisType(){\n      listIncome(this.queryParams).then(res=>{\n        if(res.code==200){\n          this.hisRevenumTypedeOptions=res.rows\n        }\n      })\n    },\n    /** 查询分摊方案管理列表 */\n      getProjectList() {\n        let params=Object.assign({\n          ...this.queryParams,\n          isLast:0,\n        })\n        listProject(params).then(response => {\n          this.projectCodeOptions = response.rows;\n        });\n      },\n    // 核算类型字典翻译\n    accountTypeFormat(row, column) {\n      return this.selectDictLabel(this.accountTypeOptions, row.accountType);\n    },\n\t  successSubmit(flag) {\n      this.open = flag;\n      this.getList();\n    },\n    // 取消按钮\n    cancel() {\n      this.open = false;\n      this.reset();\n    },\n    // 表单重置\n    reset() {\n      this.form = {\n        id: null,\n        compCode: null,\n        accountCode: null,\n        revenueCode: null,\n        revenueName: null,\n        spell: null,\n        inpBill: null,\n        inpExec: null,\n        inpCare: null,\n        outpBill: null,\n        outpExec: null,\n        outpCare: null,\n        coopMed: null,\n        accountType: null,\n        convRatio: null,\n        fixConv: null,\n        projectCode: null,\n        projectName: null,\n        hisRevenumTypede: null,\n        delFlag: null,\n        createBy: null,\n        createTime: null,\n        updateBy: null,\n        updateTime: null,\n        remark: null\n      };\n      this.resetForm(\"form\");\n    },\n    /** 搜索按钮操作 */\n    handleQuery() {\n      this.queryParams.pageNum = 1;\n      this.getList();\n    },\n    /** 重置按钮操作 */\n    resetQuery() {\n      this.resetForm(\"queryForm\");\n      this.handleQuery();\n    },\n    // 多选框选中数据\n    handleSelectionChange(selection) {\n      this.ids = selection.map(item => item.id)\n      this.accountType = selection.map(item => item.accountType)[0]\n      this.single = selection.length!==1\n      this.multiple = !selection.length\n      this.selectionRow=selection\n    },\n    rowClick(row, column, event) {\n      let refsElTable = this.$refs.multipleTable;\n      let findRow = this.selectionRow.find(c => c.rowIndex == row.rowIndex);\n      if (findRow && this.selectionRow.length == 1) {\n        refsElTable.toggleRowSelection(row, false);\n        return;\n      }\n      refsElTable.clearSelection();\n      refsElTable.toggleRowSelection(row);\n    },\n    rowStyle({\n      row,\n      rowIndex\n    }) {\n      Object.defineProperty(row, 'rowIndex', {\n        value: rowIndex,\n        writable: true,\n        enumerable: false\n      })\n    },\n    rowClassName({\n      row,\n      rowIndex\n    }) {\n      let rowName = \"\",\n        findRow = this.selectionRow.find(c => c.rowIndex === row.rowIndex);\n      if (findRow) {\n        rowName = \"current-row \";\n      }\n      return rowName;\n    },\n    /** 新增按钮操作\n    handleAdd() {\n      this.reset();\n      this.open = true;\n      this.title = \"添加收入核算方案\";\n    },\n     */\n    /** 新增按钮操作 */\n    handleAdd() {\n      this.open = true; // 弹框点开\n      this.addEditId = \"\"; // addEditId 是新增  去子组件方便区分新增编辑\n    },\n    handleUpdate(row) {\n      this.reset();\n      const id = row.id || this.ids[0];\n      this.open = true;\n      this.addEditId = id; // id赋值\n      console.log(\"addEditId---\" + addEdit);\n    },\n    cancel1() {\n        this.open1 = false;\n        this.reset();\n    },\n     successSubmit1(flag) {\n      this.open1 = flag;\n      this.getList();\n    },\n    //科室设置\n    handleDept() {\n        this.reset();\n        this.open1 = true;\n        this.title = \"收入核算方案-科室设置\";\n        this.form.revenueCode=this.selectionRow[0].revenueCode\n        this.form.revenueName=this.selectionRow[0].revenueName\n        this.form.compCode=this.queryParams.compCode\n    },\n    /** 提交按钮 */\n    submitForm() {\n      this.$refs[\"form\"].validate(valid => {\n        if (valid) {\n          if (this.form.id != null) {\n            updateRevenue(this.form).then(response => {\n              this.msgSuccess(\"修改成功\");\n              this.open = false;\n              this.getList();\n            });\n          } else {\n            addRevenue(this.form).then(response => {\n              this.msgSuccess(\"新增成功\");\n              this.open = false;\n              this.getList();\n            });\n          }\n        }\n      });\n    },\n    /** 删除按钮操作 */\n    handleDelete(row) {\n      const ids = row.id || this.ids;\n      this.$confirm('是否确认删除收入核算方案编号为\"' + ids + '\"的数据项?', \"警告\", {\n          confirmButtonText: \"确定\",\n          cancelButtonText: \"取消\",\n          type: \"warning\"\n        }).then(function() {\n          return delRevenue(ids);\n        }).then(() => {\n          this.getList();\n          this.msgSuccess(\"删除成功\");\n        }).catch(() => {});\n    },\n  }\n};\n</script>\n<style lang=\"scss\" scoped>\n::v-deep{\n  .el-table__body-wrapper.is-scrolling-left{\n      height:auto !important;\n      max-height:calc(100vh - 326px) !important;\n    }\n    .el-table__body-wrapper.is-scrolling-middle{\n      max-height:calc(100vh - 326px) !important;\n      height:auto !important;\n    }\n    .el-table__body-wrapper.is-scrolling-right{\n      height:auto !important;\n      max-height:calc(100vh - 326px) !important;\n    }\n}\n</style>\n\n"]}]}