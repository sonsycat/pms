{"remainingRequest":"F:\\pms_UI\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\pms_UI\\src\\views\\evaluate\\set\\bonusEvaSelect.vue?vue&type=style&index=0&id=7f731034&lang=scss&scoped=true&","dependencies":[{"path":"F:\\pms_UI\\src\\views\\evaluate\\set\\bonusEvaSelect.vue","mtime":1693362205630},{"path":"F:\\pms_UI\\node_modules\\css-loader\\dist\\cjs.js","mtime":1693361949271},{"path":"F:\\pms_UI\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1693362179282},{"path":"F:\\pms_UI\\node_modules\\postcss-loader\\src\\index.js","mtime":1693362110683},{"path":"F:\\pms_UI\\node_modules\\sass-loader\\dist\\cjs.js","mtime":1693362152666},{"path":"F:\\pms_UI\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1693361924439},{"path":"F:\\pms_UI\\node_modules\\vue-loader\\lib\\index.js","mtime":1693362179279}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCjo6di1kZWVwIC5lbC1kaWFsb2cgewogIG1pbi1oZWlnaHQ6IDEwJTsKICBtYXgtaGVpZ2h0OiA4NSU7CiAgb3ZlcmZsb3c6IGhpZGRlbjsKICAuZWwtZGlhbG9nX19ib2R5IHsKICAgIGhlaWdodDogY2FsYygxMDAlIC0gMTAwcHgpOwogICAgb3ZlcmZsb3c6IGF1dG87CiAgICAuZWwtZm9ybS1pdGVtX19sYWJlbHsKICAgICAgd2lkdGg6IGF1dG8gIWltcG9ydGFudDsKICAgIH0KICAgIC5lbC1mb3JtLWl0ZW1fX2NvbnRlbnR7CiAgICAgIG1hcmdpbi1sZWZ0OiAwICFpbXBvcnRhbnQKICAgIH0KICAgIC5tYjl7CiAgICAgIC5lbC10YWJsZXsKICAgICAgICBoZWlnaHQ6IDUwOHB4OwogICAgICAgIG1hcmdpbi10b3A6MTBweAogICAgICB9CiAgICB9CiAgICAubWIxMHsKICAgICAgLmVsLXRhYmxlewogICAgICAgIGhlaWdodDogNTAwcHg7CiAgICAgICAgbWFyZ2luLXRvcDoxMHB4CiAgICAgIH0KICAgIH0KICB9Cn0KCg=="},{"version":3,"sources":["bonusEvaSelect.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2aA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"bonusEvaSelect.vue","sourceRoot":"src/views/evaluate/set","sourcesContent":["<template>\n  <el-dialog :title=\"title\" :visible.sync=\"openDialog\" width=\"62%\" custom-class=\"el-button--primary\" append-to-body :close-on-click-modal=\"false\" @close=\"handleDialogClose\">\n    <div ref=\"search\">\n      <el-form :model=\"queryParams\" ref=\"queryForm\" :inline=\"true\" v-show=\"showSearch\">\n        <el-form-item label=\"指标集名称\" prop=\"setName\">\n          <el-input\n            class=\"w100\"\n            v-model=\"queryParams.setName\"\n            placeholder=\"请输入指标集名称\"\n            disabled\n          />\n        </el-form-item>\n        <el-form-item label=\"科室类别\" prop=\"deptTypeForBonuse\" >\n          <el-select class=\"w100\" v-model=\"queryParams.deptTypeForBonuse\" @change=\"filterDeptType($event)\"  placeholder=\"请选择科室类别\" clearable  >\n            <el-option\n              v-for=\"dict in deptTypeForBonuses\"\n              :key=\"dict.dictValue\"\n              :label=\"dict.dictLabel\"\n              :value=\"dict.dictValue\"\n            />\n          </el-select>\n        </el-form-item>\n        <el-form-item label=\"部门\" prop=\"deptType\">\n          <el-select class=\"w100\" v-model=\"queryParams.deptType\" placeholder=\"请选择部门分类\" clearable >\n            <el-option\n              v-for=\"dict in deptOptions\"\n              :key=\"dict.dictValue\"\n              :label=\"dict.dictLabel\"\n              :value=\"dict.dictValue\"\n            />\n          </el-select>\n        </el-form-item>\n        <el-form-item label=\"指标代码\" prop=\"indexCode\">\n          <el-input\n            class=\"w100\"\n            v-model=\"queryParams.indexCode\"\n            placeholder=\"请输入指标代码\"\n            clearable\n          />\n        </el-form-item>\n        <el-form-item label=\"指标名称\" prop=\"indexName\">\n          <el-input\n            class=\"w100\"\n            v-model=\"queryParams.indexName\"\n            placeholder=\"请输入指标名称\"\n            clearable\n          />\n        </el-form-item>\n        <el-form-item>\n          <el-button type=\"primary\" icon=\"el-icon-search\" size=\"mini\" @click=\"handleQuery\">搜索</el-button>\n          <el-button icon=\"el-icon-refresh\" size=\"mini\" @click=\"resetQuery\">重置</el-button>\n        </el-form-item>\n      </el-form>\n    </div>\n    <el-row :gutter=\"20\">\n<!--      <el-col :span=\"7\" class=\"mb9\">-->\n<!--        <el-card>-->\n<!--          <el-table-->\n<!--            ref=\"menmberTable\"-->\n<!--            v-loading=\"evaTreeListLoading\"-->\n<!--            :data=\"evaTreeList\"-->\n<!--            :row-class-name=\"tableRowClassName\"-->\n<!--            row-key=\"id\"-->\n<!--            :tree-props=\"{children: 'children', hasChildren: 'hasChildren'}\"-->\n<!--            @row-click=\"rowMemberClick\"-->\n<!--            @selection-change=\"handleSelectionMemberChange\"-->\n<!--          >-->\n<!--            <el-table-column type=\"selection\" :selectable=\"selectableTota\" width=\"55\" align=\"center\" />-->\n<!--            <el-table-column label=\"指标分类树\" align=\"left\" prop=\"bscName\" show-overflow-tooltip/>-->\n<!--          </el-table>-->\n<!--        </el-card>-->\n<!--      </el-col>-->\n      <el-col :span=\"10\" class=\"mb10\">\n        <el-card>\n          <el-col :span=\"12\">\n            <span style=\"font-size:16px\">待选指标</span>\n          </el-col>\n          <el-table\n            v-loading=\"indexListLoading\"\n            :data=\"indexNoList\"\n            :row-class-name=\"tableRowClassName\"\n            @select=\"selectionIndex\"\n            @row-click=\"rowClickWaitClass\"\n          >\n            <el-table-column type=\"selection\" width=\"55\" align=\"center\" />\n            <el-table-column label=\"指标名称\" align=\"left\" prop=\"indexName\" show-overflow-tooltip/>\n          </el-table>\n        </el-card>\n      </el-col>\n      <el-col :span=\"14\" class=\"mb10\">\n        <el-card>\n          <el-col :span=\"10\">\n            <span style=\"font-size:16px\">已选指标</span>\n          </el-col>\n          <el-table\n            v-loading=\"indexSelectedLoading\"\n            :data=\"indexSelectedList\"\n            :row-class-name=\"tableRowClassName\"\n            @row-click=\"rowClickHasClass\"\n            @select=\"selectionedIndex\"\n          >\n            <el-table-column type=\"selection\" width=\"55\" align=\"center\" />\n            <el-table-column label=\"指标名称\" align=\"left\" prop=\"indexName\" show-overflow-tooltip/>\n            <el-table-column label=\"权重\" align=\"left\" prop=\"weight\" >\n              <template slot-scope=\"scope\">\n                <el-input-number v-model=\"scope.row.weight\" :min=\"0\" :precision=\"0\"  @click.native.stop/>\n              </template>\n            </el-table-column>\n          </el-table>\n        </el-card>\n      </el-col>\n    </el-row>\n    <div slot=\"footer\" class=\"dialog-footer\">\n      <el-button type=\"primary\" @click=\"submitForm\">保 存</el-button>\n      <el-button @click=\"handleDialogClose\">取 消</el-button>\n    </div>\n  </el-dialog>\n</template>\n\n<script>\n  import { getEvaTree, getEvaToSelTree, getEvaSeledTree, addEvaSet} from \"@/api/evaluate/set\";\n  import {listBonus, listBonusAll} from \"@/api/evaluate/index\";\n\n\n  export default {\n    name: 'evaSelect',\n    props: {\n      open: {\n        type: Boolean,\n        default: false\n      },\n      id: {\n        type: [String, Number],\n        default: \"\"\n      },\n      datas:{\n        type:Array,\n        default:[]\n      }\n    },\n    data() {\n      return {\n        title:\"奖金指标集管理-指标选择\",\n        openDialog:this.open,\n        evaTreeListLoading:false,\n        indexSelectedLoading:false,\n        indexListLoading:false,\n        form:{},\n        rules:{},\n        showSearch:true,\n        table1Height:'508px',\n        tableHeight:'500px',\n        // 查询参数\n        queryParams: {\n          pageNum: 1,\n          pageSize: 30,\n          compCode: null,\n          accountCode: null,\n          setCode: null,\n          setName: null,\n          indexCode:null,\n          indexName:null,\n          oneCode: null,\n          secondCode: null,\n          deptType: null,\n          deptTypeForBonuse:null,\n          orgType: null,\n          partYear: null,\n        },\n        //指标部门分类\n        deptOptions:[],\n        deptTypeForBonuses:[],\n        //待选角色\n        queryParamsIndex: {\n          pageNum: 1,\n          pageSize: this.$store.state.settings.pageSize,\n          compCode: this.$store.state.user.userInfo.deptId,\n          bscSecondCode:null,\n          weight: null,\n        },\n        //已选角色\n        queryParamsIndexSelected: {\n          pageNum: 1,\n          pageSize: this.$store.state.settings.pageSize,\n          compCode: this.$store.state.user.userInfo.deptId,\n          weight: null,\n          bscSecondCode:null,\n          setCode:null,\n        },\n        //指标分类树\n        evaTreeList:[],\n        // 待选角色数据\n        indexNoList: [],\n        dataLists:[],\n        // 已选角色数据\n        indexSelectedList: [],\n        selectionMemberRow:[],\n      };\n    },\n\n    created(){\n\n      if(this.datas.length!==0){\n        this.queryParams.setName=this.datas[0].setName;\n        this.queryParamsIndexSelected.setCode=this.datas[0].setCode;\n        this.getEvaSeledTree()\n      }\n      this.getToBeSelectedList();\n      // listBonus(this.queryParams).then(response => {\n      //   this.indexNoList = response.rows\n      // });\n      //指标部门分类字典\n      this.getDicts(\"pms_bm_fl\").then(response=>{\n        this.deptOptions=response.data;\n      })\n      this.getDicts(\"JXGL_JJ_KSLB\").then(response=>{\n        this.deptTypeForBonuses=response.data;\n      })\n      this.queryParams.deptTypeForBonuse = this.datas[0].deptType;\n    },\n\n    mounted() {\n\n    },\n\n    methods: {\n      handleDialogClose(){\n        this.$emit(\"cancel\", false);\n      },\n      /** 搜索按钮操作 */\n      handleQuery() {\n        this.queryParams.pageNum = 1;\n        // if(this.selectionMemberRow.length!==0){\n          this.getToBeSelectedList()\n        // }else{\n        //   this.msgError(\"请选择指标分类\")\n        // }\n      },\n      /** 重置按钮操作 */\n      resetQuery() {\n        this.resetForm(\"queryForm\");\n        this.indexSelectedList = this.indexSelectedList.filter(function(item){\n            return item.id;\n        })\n        this.handleQuery();\n      },\n      // 只能选择 末级节点\n      selectableTota(row){\n        if(row.isLast == 0){\n          // 末级\n          return  true\n        }else{\n          return false\n        }\n      },\n      // //待选角色列表\n      // getEvaToSelTree(){\n      //   this.indexListLoading=true;\n      //   let res=[]\n      //   getEvaToSelTree(this.queryParams).then(response=>{\n      //     this.indexNoList=response.rows;\n      //     for(let i in this.indexSelectedList){\n      //       for(let k in this.indexNoList){\n      //         if(this.indexSelectedList[i].indexName == this.indexNoList[k].indexName){\n      //           this.indexNoList.splice(k,1)\n      //         }\n      //       }\n      //     }\n      //     this.indexListLoading=false;\n      //   })\n      // },\n\n      //待选角色列表\n      getToBeSelectedList(){\n        this.indexListLoading=true;\n        let res=[]\n        this.queryParams.orgType = this.datas[0].orgType;\n        listBonusAll(this.queryParams).then(response=>{\n          this.indexNoList = response;\n          console.log(this.indexNoList)\n          console.log(this.indexSelectedList)\n          for(let i in this.indexSelectedList){\n            for(let k in this.indexNoList){\n              if(this.indexSelectedList[i].indexName == this.indexNoList[k].indexName){\n                this.indexNoList.splice(k,1)\n              }\n            }\n          }\n          this.indexListLoading=false;\n        })\n      },\n\n      /** 已选角色列表 */\n      getEvaSeledTree() {\n        this.indexSelectedLoading = true;\n        getEvaSeledTree(this.queryParamsIndexSelected).then(response => {\n          this.indexSelectedList = response.rows\n          this.indexSelectedLoading = false\n        });\n      },\n      tableRowClassName({ row, rowIndex }) {\n        row.index = rowIndex;\n      },\n      // 待选角色多选框选中数据\n      selectionIndex(selection, row) {\n        this.rowClickWaitClass(selection[0])\n      },\n      rowMemberClick(row, column, event) {\n        if(row.isLast == 0){\n          let refsElTable = this.$refs.menmberTable;\n          let findRow = this.selectionMemberRow.find(c => c.rowIndex == row.rowIndex);\n          refsElTable.clearSelection();\n          refsElTable.toggleRowSelection(row);\n        }\n      },\n      handleSelectionMemberChange(selection) {\n        let refsElTable = this.$refs.menmberTable;\n        if (selection.length > 1) {\n          refsElTable.clearSelection();\n          refsElTable.toggleRowSelection(\n            selection[selection.length - 1],\n            false\n          );\n          selection = Array(selection[selection.length - 1]);\n        } else if (selection.length === 1) {\n          selection = Array(selection[selection.length - 1]);\n        } else {\n          selection = [];\n        }\n       // this.selectionMemberRow=selection;\n       // if(this.selectionMemberRow.length!==0){\n          this.queryParams.bscSecondCode=this.selectionMemberRow[0].bscCode;\n          this.queryParams.orgType=this.datas[0].orgType;\n          this.queryParams.compCode=this.$store.state.user.userInfo.deptId;\n          this.getToBeSelectedList()\n       // }\n      },\n      //待选角色 点击行\n      rowClickWaitClass(selection){\n        let {\n          indexCode,\n          indexName,\n          weight\n        } = selection;\n        this.indexSelectedList.push({\n          indexCode,\n          indexName,\n          weight:weight?weight:0\n        });\n        this.indexNoList.splice(selection.index, 1);\n      },\n      // 已选角色多选框选中数据\n      selectionedIndex(selection, row) {\n        this.rowClickHasClass(selection[0])\n      },\n      // 已经选择点击行\n      rowClickHasClass(selection){\n        let {\n          indexCode,\n          indexName,\n          weight\n        } = selection;\n        this.indexNoList.push({\n          indexCode,\n          indexName,\n          weight\n        });\n        this.indexSelectedList.splice(selection.index, 1);\n      },\n      filterDeptType(all){\n        this.queryParams.deptType = null;\n        this.getDicts(\"pms_bm_fl\").then(response=>{\n          let depts = [];\n          depts = response.data;\n          if(all=='1'){\n            for(let k in depts){\n              if('机关科室' == depts[k].dictLabel){\n                depts.splice(k,1)\n                this.queryParams.deptType = depts[0].dictValue\n              }\n            }\n            this.deptOptions =depts\n          }else if(all=='2'){\n                let arr=[{\n                  dictLabel: \"机关科室\",\n                  dictValue: \"2\",\n                }]\n                this.deptOptions = arr\n            this.queryParams.deptType = arr[0].dictValue\n\n          }\n        })\n        console.log(this.deptOptions)\n      },\n\n      submitForm(){\n        if(!this.queryParams.deptTypeForBonuse){\n          this.msgError(\"未选择科室类别\");\n          return;\n        }\n        let datas={\n          compCode:this.$store.state.user.userInfo.deptId,\n          setCode:this.datas[0].setCode,\n          deptType:this.queryParams.deptTypeForBonuse,\n          pmsEvaluateSetIndexList:this.indexSelectedList.map(item=>{\n            this.dataLists.forEach(ite=>{\n              if(ite.indexName==item.indexName){\n                item.indexCode=ite.indexCode\n              }\n            })\n            return item\n          })\n        }\n        const saveLoading=this.saveLoading()\n        addEvaSet(datas).then(response=>{\n          if(response.code==200){\n            this.msgSuccess(\"编辑成功\");\n            this.$emit(\"success\", false);\n            saveLoading.close()\n          }\n        })\n      },\n    },\n  };\n</script>\n\n<style lang=\"scss\" scoped>\n  ::v-deep .el-dialog {\n    min-height: 10%;\n    max-height: 85%;\n    overflow: hidden;\n    .el-dialog__body {\n      height: calc(100% - 100px);\n      overflow: auto;\n      .el-form-item__label{\n        width: auto !important;\n      }\n      .el-form-item__content{\n        margin-left: 0 !important\n      }\n      .mb9{\n        .el-table{\n          height: 508px;\n          margin-top:10px\n        }\n      }\n      .mb10{\n        .el-table{\n          height: 500px;\n          margin-top:10px\n        }\n      }\n    }\n  }\n\n</style>\n"]}]}