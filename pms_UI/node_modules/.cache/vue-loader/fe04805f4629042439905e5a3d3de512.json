{"remainingRequest":"F:\\pms_UI\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\pms_UI\\src\\views\\apportionment\\project\\dept.vue?vue&type=style&index=0&id=85822364&lang=scss&scoped=true&","dependencies":[{"path":"F:\\pms_UI\\src\\views\\apportionment\\project\\dept.vue","mtime":1693362204153},{"path":"F:\\pms_UI\\node_modules\\css-loader\\dist\\cjs.js","mtime":1693361949271},{"path":"F:\\pms_UI\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1693362179282},{"path":"F:\\pms_UI\\node_modules\\postcss-loader\\src\\index.js","mtime":1693362110683},{"path":"F:\\pms_UI\\node_modules\\sass-loader\\dist\\cjs.js","mtime":1693362152666},{"path":"F:\\pms_UI\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1693361924439},{"path":"F:\\pms_UI\\node_modules\\vue-loader\\lib\\index.js","mtime":1693362179279}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCjo6di1kZWVwIC5lbC1kaWFsb2cgewogIGhlaWdodDogNzAlOwogIG92ZXJmbG93OiBoaWRkZW47CiAgLmVsLWRpYWxvZ19fYm9keSB7CiAgICBoZWlnaHQ6IGNhbGMoMTAwJSAtIDEwMHB4KTsKICAgIG92ZXJmbG93OiBhdXRvOwogIH0KfQo="},{"version":3,"sources":["dept.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyZA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"dept.vue","sourceRoot":"src/views/apportionment/project","sourcesContent":["<template>\n    <el-dialog :title=\"title\" :visible.sync=\"openDialog\" width=\"75%\"  custom-class=\"el-button--primary\" append-to-body :close-on-click-modal=\"false\" @close=\"handleDialogClose\">\n      <el-form ref=\"form\" :model=\"form\" :rules=\"rules\" label-width=\"80px\">\n        <el-row>\n          <el-form-item label=\"方案名称\" prop=\"projectName\">\n            <el-input v-model=\"form.projectName\" placeholder=\"请输入方案名称\"  maxlength=\"50\" show-word-limit @blur=\"getPym\" disabled />\n          </el-form-item>\n        </el-row>\n        <el-row>\n          <el-col :span=\"10\">\n            <el-card>\n              <el-form :model=\"queryParamsDept\" ref=\"queryParamsDept\" :inline=\"true\" v-show=\"showSearchProject\" label-width=\"100px\" class=\"bb0\">\n                <el-col :span=\"5\">\n                  <el-form-item  label=\"待选科室\" prop=\"\">\n                  </el-form-item>\n                </el-col>\n                <el-col :span=\"19\">\n                  <el-form-item  label=\"\" prop=\"queryCode\" style=\"float: right;\">\n                    <el-input\n                      v-model=\"queryParamsDept.queryCode\"\n                      placeholder=\"输入信息（编码、名称）\"\n                      clearable\n                      @keyup.enter.native=\"getListDept\"\n                      @input=\"getListDept\"\n                    />\n                  </el-form-item>\n                </el-col>\n              </el-form>\n\n              <el-table\n                v-loading=\"deptListLoading\"\n                :data=\"deptListNoProject\"\n                :height=\"stableHeight\"\n                :row-class-name=\"tableRowClassName\"\n                @select=\"selectionProject\"\n                @row-click=\"rowClickWaitClass\"\n              >\n                <el-table-column type=\"selection\" width=\"55\" align=\"center\" />\n                <el-table-column label=\"科室编码\" align=\"center\" prop=\"deptCode\" />\n                <el-table-column label=\"科室名称\" align=\"left\" prop=\"deptName\" show-overflow-tooltip/>\n              </el-table>\n              <pagination\n                :total=\"totalDept\"\n                :page.sync=\"queryParamsDept.pageNum\"\n                :limit.sync=\"queryParamsDept.pageSize\"\n                @pagination=\"getListDept\"\n              />\n            </el-card>\n          </el-col>\n          <el-col :span=\"14\" class=\"mb10\">\n            <el-card>\n              <div ref=\"ssearch\">\n                <el-form :model=\"queryParamsDeptProject\" ref=\"queryParamsDeptProject\" :inline=\"true\" v-show=\"showSearchProjectUser\" label-width=\"100px\" class=\"bb0\">\n                  <el-col :span=\"5\">\n                    <el-form-item  label=\"已选科室\" prop=\"\">\n                    </el-form-item>\n                  </el-col>\n                  <el-col :span=\"19\">\n                    <el-form-item  label=\"\" prop=\"queryCode\" style=\"float: right;\">\n                      <el-input\n                        v-model=\"queryParamsDeptProject.queryCode\"\n                        placeholder=\"输入信息（编码、名称）\"\n                        clearable\n                        @keyup.enter.native=\"getListDeptProject\"\n                        @input=\"getListDeptProject\"\n                      />\n                    </el-form-item>\n                  </el-col>\n                </el-form>\n              </div>\n              <el-table\n                v-loading=\"deptListProjectLoading\"\n                :data=\"deptListProject\"\n                :height=\"stableHeight\"\n                :row-class-name=\"tableRowClassName\"\n                @row-click=\"rowClickHasClass\"\n                @select=\"selectionProjectDept\"\n              >\n                <el-table-column type=\"selection\" width=\"55\" align=\"center\" />\n                <el-table-column label=\"科室编码\" align=\"center\" prop=\"deptCode\" />\n                <el-table-column label=\"科室名称\" align=\"left\" prop=\"deptName\" show-overflow-tooltip/>\n                <el-table-column label=\"一级分摊比例\" align=\"center\" prop=\"firstRatio\" >\n                  <template slot-scope=\"scope\">\n                    <el-input-number v-model=\"scope.row.firstRatio\" precision=\"2\" :disabled=\"false\" controls-position=\"right\" :min=\"0\" :max=\"1\" :step=\"0.1\" @click.native.stop />\n                  </template>\n                </el-table-column>\n                <el-table-column label=\"二级分摊比例\" align=\"center\" prop=\"secondRatio\" >\n                  <template slot-scope=\"scope\">\n                    <el-input-number v-model=\"scope.row.secondRatio\" precision=\"2\" :disabled=\"scope.row.type == '2'\" controls-position=\"right\" :min=\"0\" :max=\"1\" :step=\"0.1\"  @click.native.stop />\n                  </template>\n                </el-table-column>\n                <el-table-column label=\"三级分摊比例\" align=\"center\" prop=\"thirdRatio\" >\n                  <template slot-scope=\"scope\">\n                    <el-input-number v-model=\"scope.row.thirdRatio\" precision=\"2\" :disabled=\"scope.row.type != '4'\" controls-position=\"right\" :min=\"0\" :max=\"1\" :step=\"0.1\"  @click.native.stop />\n                  </template>\n                </el-table-column>\n              </el-table>\n              <pagination\n                :total=\"totalDeptProject\"\n                :page.sync=\"queryParamsDeptProject.pageNum\"\n                :limit.sync=\"queryParamsDeptProject.pageSize\"\n                @pagination=\"getListDeptProject\"\n              />\n            </el-card>\n          </el-col>\n        </el-row>\n      </el-form>\n      <div slot=\"footer\" class=\"dialog-footer\">\n        <el-button type=\"primary\" @click=\"submitForm\">确 定</el-button>\n        <el-button @click=\"cancel\">取 消</el-button>\n      </div>\n    </el-dialog>\n</template>\n\n<script>\nimport { validEmail } from'@/utils/validate'\nimport { listProject, getProject, delProject, addProjectDept, updateProject, listProjectDept } from \"@/api/apportionment/project\";\nimport pinyin from \"js-pinyin\";\n\nexport default {\n  name: \"addEdit\",\n  props: {\n    open: {\n      type: Boolean,\n      default: false\n    },\n    id: {\n      type: [String, Number],\n      default: \"\"\n    }\n  },\n  watch: {\n    id: {\n      handler(val) {\n        this.reset();\n        if (val) {\n          this.id = val;\n          this.title = \"分摊方案管理-科室设置\";\n          this.getDetailInfo();\n        }\n      },\n      deep: true,\n      immediate: true\n    },\n    open: {\n      handler(val) {\n        this.openDialog = val;\n      },\n      deep: true\n    },\n    listData(val) {\n      var that = this;\n      setTimeout(function() {\n        that.resizeHandler();\n      }, 300);\n    }\n  },\n  components: {\n  },\n  data() {\n    return {\n      tableHeight: \"auto\",\n      stableHeight: \"auto\",\n      title: \"分摊方案管理-新增\",\n      openDialog: this.open,\n      deptListProjectLoading:false,\n      deptListLoading:false,\n      pym: \"\",\n      // 显示已选科室搜索条件\n      showSearchProjectUser: true,\n      // 显示待选科室搜索条件\n      showSearchProject: true,\n      // 表单参数\n      form: {},\n      projectTypeOptions: [],\n\t  \t// 表单校验\n      rules: {\n        projectCode: [\n          { required: true, message: \"方案编码不能为空\", trigger: \"blur\" }\n        ],\n        projectName: [\n          { required: true, message: \"方案名称不能为空\", trigger: \"blur\" }\n        ],\n        nowDate: [\n          { required: true, message: \"当前年月不能为空\", trigger: \"blur\" }\n        ],\n        projectType:[\n          { required: true, message: \"方案类型不能为空\", trigger: \"blur\" }\n        ],\n      },\n      //待选科室\n      queryParamsDept: {\n        pageNum: 1,\n        pageSize: this.$store.state.settings.pageSize,\n        compCode: this.$store.state.user.userInfo.deptId,\n        isProject: null,\n        deptCode: null,\n        deptName: null,\n        deposit: null,\n        delivery: null,\n        projectCode: null,\n        ratio: null,\n        firstRatio: null,\n        secondRatio: null,\n        thirdRatio: null,\n        type: null,\n      },\n      //已选科室\n      queryParamsDeptProject: {\n        pageNum: 1,\n        pageSize: this.$store.state.settings.pageSize,\n        compCode: this.$store.state.user.userInfo.deptId,\n        isProject: null,\n        deptCode: null,\n        deptName: null,\n        deposit: null,\n        delivery: null,\n        projectCode: null,\n        ratio: null,\n        firstRatio: null,\n        secondRatio: null,\n        thirdRatio: null,\n        type: null,\n      },\n      // 待选科室数据\n      deptListNoProject: [],\n      // 已选科室数据\n      deptListProject: [],\n      // 待选科室总条数\n      totalDept: 0,\n      // 已选科室总条数\n      totalDeptProject: 0,\n    };\n  },\n  created() {\n    this.getDicts(\"cost_fa_type\").then(response => {\n      this.projectTypeOptions = response.data;\n    });\n  },\n  computed: {\n    listData() {\n      return this.$store.state.app.sidebar.opened;\n    }\n  },\n  mounted() {\n    this.$nextTick(() => {\n      this.resizeHandler();\n      window.addEventListener(\"resize\", this.resizeHandler);\n    });\n  },\n  methods: {\n    resizeHandler() {\n      let c = this.$refs.ssearch.offsetHeight;\n      let sh = this.$store.state.settings.tableHeight  + c*2 + 50\n      sh = sh + \"px\";\n      this.stableHeight = `calc((100vh - ${sh})/2)`;\n      console.log(\"height\",this.stableHeight)\n    },\n    tableRowClassName({ row, rowIndex }) {\n      row.index = rowIndex;\n    },\n    // 待选科室多选框选中数据\n    selectionProject(selection, row) {\n      this.rowClickWaitClass(selection[0])\n    },\n    //待选物资类型 点击行\n    rowClickWaitClass(selection){\n      console.log(\"selection\",selection)\n      let {\n        deptCode,\n        deptName,\n        type,\n      } = selection;\n      this.deptListProject.push({\n        deptCode,\n        deptName,\n        type,\n      });\n      this.deptListNoProject.splice(selection.index, 1);\n    },\n    // 已选科室多选框选中数据\n    selectionProjectDept(selection, row) {\n      this.rowClickHasClass(selection[0])\n    },\n    // 已经选择点击行\n    rowClickHasClass(selection){\n      let {\n        deptCode,\n        deptName,\n      } = selection;\n      this.deptListNoProject.push({\n        deptCode,\n        deptName,\n      });\n      this.deptListProject.splice(selection.index, 1);\n    },\n  \tgetDetailInfo() {\n      getProject(this.id).then(response => {\n        this.form = response.data;\n        this.queryParamsDept.projectCode = this.form.projectInCode;\n        this.queryParamsDeptProject.projectCode = this.form.projectInCode;\n        this.getListDeptProject();\n        this.getListDept();\n      });\n    },\n    // 获取拼音码\n    getPym() {\n      // 全是字母的情况下,拼音码等于所有字母\n      if (/^[a-zA-Z]*$/.test(this.form.projectName)) {\n        this.form.spell = this.form.projectName;\n        return;\n      }\n      // 有汉字的情况下,转为首字母\n      let fullName = pinyin.getCamelChars(this.form.projectName).toUpperCase();\n      let pym = \"\";\n      for (var i = 0; i < fullName.length; i++) {\n        var c = fullName.charAt(i);\n        if (/^[A-Z]+$/.test(c)) {\n          pym += c;\n        }\n      }\n      this.form.spell = pym;\n    },\n    /** 查询分摊方案管理列表 */\n    getList() {\n      this.loading = true;\n      listProject(this.queryParams).then(response => {\n        this.projectList = response.rows;\n        this.total = response.total;\n        this.loading = false;\n      });\n    },\n    /** 查询非用户关联仓库列表 */\n    getListDept() {\n      this.queryParamsDept.isProject = \"2\";\n      if (this.queryParamsDept.projectCode != null) {\n        this.deptListLoading = true\n        listProjectDept(this.queryParamsDept).then(response => {\n          this.deptListNoProject = response.rows;\n          console.log(this.deptListNoProject, \"store\");\n          this.totalDept = response.total;\n          this.deptListLoading = false\n        });\n      }\n    },\n    /** 查询用户关联仓库列表 */\n    getListDeptProject() {\n      this.queryParamsDeptProject.isProject = \"1\";\n      if (this.queryParamsDeptProject.projectCode != null) {\n        this.deptListProjectLoading = true;\n        listProjectDept(this.queryParamsDeptProject).then(response => {\n          this.deptListProject = response.rows;\n          console.log(this.deptListProject, \"deptProject\");\n          this.totalDeptProject = response.total;\n          this.deptListProjectLoading = false\n        });\n      }\n    },\n    // 方案类型字典翻译\n    projectTypeFormat(row, column) {\n      return this.selectDictLabel(this.projectTypeOptions, row.projectType);\n    },\n    // 弹框关闭\n    handleDialogClose() {\n      this.$emit(\"cancel\", false);\n    },\n    // 取消\n    cancel() {\n      this.$emit(\"cancel\", false);\n    },\n    // 表单重置\n    reset() {\n      this.form = {\n        id: null,\n        compCode: this.$store.state.user.accountInfo.deptId,\n        accountCode: null,\n        projectCode: null,\n        projectName: null,\n        nowDate: null,\n        spell: null,\n        projectType: null\n      };\n      this.resetForm(\"form\");\n    },\n    /** 提交按钮 */\n    submitForm() {\n      console.log(\"11111111111\")\n          let data = {\n            projectCode: this.form.projectInCode,\n            deptList: this.deptListProject\n          };\n          let saveLoading = this.saveLoading()\n          addProjectDept(data).then(response => {\n            if (response.code == 200) {\n              saveLoading.close()\n              this.msgSuccess(\"保存成功\");\n              this.$emit(\"cancel\", false);\n            } else {\n              saveLoading.close()\n              this.msgError(response.msg);\n              this.$emit(\"cancel\", false);\n            }\n          }).catch(()=>{\n            saveLoading.close();\n          });\n    },\n}};\n</script>\n<style lang=\"scss\" scoped>\n  ::v-deep .el-dialog {\n    height: 70%;\n    overflow: hidden;\n    .el-dialog__body {\n      height: calc(100% - 100px);\n      overflow: auto;\n    }\n  }\n</style>\n"]}]}