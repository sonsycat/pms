{"remainingRequest":"D:\\hrp\\zjry-pms-ui\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\hrp\\zjry-pms-ui\\src\\views\\quality\\quality\\detailEdit.vue?vue&type=style&index=0&id=51bc8c35&lang=scss&scoped=true&","dependencies":[{"path":"D:\\hrp\\zjry-pms-ui\\src\\views\\quality\\quality\\detailEdit.vue","mtime":1682043107658},{"path":"D:\\hrp\\zjry-pms-ui\\node_modules\\css-loader\\dist\\cjs.js","mtime":1682058377861},{"path":"D:\\hrp\\zjry-pms-ui\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1682058382042},{"path":"D:\\hrp\\zjry-pms-ui\\node_modules\\postcss-loader\\src\\index.js","mtime":1682058378631},{"path":"D:\\hrp\\zjry-pms-ui\\node_modules\\sass-loader\\dist\\cjs.js","mtime":1682058378517},{"path":"D:\\hrp\\zjry-pms-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1682058377348},{"path":"D:\\hrp\\zjry-pms-ui\\node_modules\\vue-loader\\lib\\index.js","mtime":1682058381348}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgo6OnYtZGVlcCAuZWwtZGlhbG9nIHsKICBoZWlnaHQ6IDgwJTsKICBvdmVyZmxvdzogaGlkZGVuOwogIC5lbC1kaWFsb2dfX2JvZHkgewogICAgaGVpZ2h0OiBjYWxjKDEwMCUgLSAxMDBweCk7CiAgICBvdmVyZmxvdzogYXV0bzsKICB9Cn0K"},{"version":3,"sources":["detailEdit.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiZA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"detailEdit.vue","sourceRoot":"src/views/quality/quality","sourcesContent":["<template>\r\n    <div>\r\n      <el-dialog :title=\"title\" :visible.sync=\"openDialog\" width=\"50%\" custom-class=\"el-button--primary\" append-to-body :close-on-click-modal=\"false\" @close=\"handleDialogClose\">\r\n        <div ref=\"btns\">\r\n          <el-row :gutter=\"10\" class=\"mb8\">\r\n            <el-col :span=\"1.5\">\r\n              <el-button\r\n                type=\"primary\"\r\n                icon=\"el-icon-search\"\r\n                size=\"mini\"\r\n                :disabled=\"single\"\r\n                @click=\"handleDetail\"\r\n                v-hasPermi=\"['quality:quality:edit']\"\r\n              >查看</el-button>\r\n            </el-col>\r\n            </el-col>\r\n            <right-toolbar :showSearch.sync=\"showSearch\" @queryTable=\"getDetailInfo\"></right-toolbar>\r\n          </el-row>\r\n        </div>\r\n        <el-table border stripe v-loading=\"loading\" height=\"93%\" :data=\"qualityList\" @selection-change=\"handleSelectionChange\" ref=\"multipleTable\" @row-click=\"rowClick\" :row-style=\"rowStyle\">\r\n          <el-table-column type=\"selection\" width=\"55\" align=\"center\" />\r\n          <el-table-column label=\"质量名称(模板名称)\" align=\"center\" prop=\"tempName\">\r\n            <template slot-scope=\"scope\">\r\n              <el-link type=\"primary\" :underline=\"false\" v-html=\"scope.row.tempName\" @click.stop=\"handleClickTableName(scope.row)\" class=\"displayBlock text-ellipsis \"></el-link>\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column label=\"项目分值\" align=\"center\" prop=\"indexScore\" />\r\n          <el-table-column label=\"本月得分\" align=\"center\" prop=\"actualScore\" />\r\n        </el-table>\r\n        <div slot=\"footer\" class=\"dialog-footer\">\r\n          <el-button @click=\"cancel\">关 闭</el-button>\r\n        </div>\r\n      </el-dialog>\r\n\r\n      <!-- 得分明细 -->\r\n      <el-dialog :title=\"detailTitle\" :visible.sync=\"openDetailDialog\" width=\"50%\" custom-class=\"el-button--primary\" append-to-body :close-on-click-modal=\"false\" @close=\"handleDetailDialogClose\">\r\n        <div ref=\"btns\">\r\n          <el-row :gutter=\"10\" class=\"mb8\">\r\n            <el-col :span=\"1.5\">\r\n              <el-button\r\n                type=\"success\"\r\n                icon=\"el-icon-search\"\r\n                size=\"mini\"\r\n                :disabled=\"singleItem\"\r\n                @click=\"handleDetailItem\"\r\n                v-hasPermi=\"['quality:quality:edit']\"\r\n              >详情</el-button>\r\n            </el-col>\r\n            </el-col>\r\n            <right-toolbar :showSearch.sync=\"showSearch\" @queryTable=\"getQualityDetail\"></right-toolbar>\r\n          </el-row>\r\n        </div>\r\n        <el-table border stripe v-loading=\"loading1\" height=\"86%\" :data=\"qualityList1\" @selection-change=\"handleSelectionChange1\" ref=\"multipleTable1\" @row-click=\"rowClick1\" :row-style=\"rowStyle\">\r\n          <el-table-column type=\"selection\" width=\"55\" align=\"center\" />\r\n          <template v-for=\"item in cols\">\r\n      \t\t<template v-if=\"item.isList=='1'\">\r\n      \t\t\t<template v-if=\"item.fieldType=='select'\">\r\n      \t\t\t\t<el-table-column show-overflow-tooltip :align=\"item.align\" :label=\"item.label\" :prop=\"item.prop\" :formatter=\"stateFormat\" />\r\n      \t\t\t</template>\r\n      \t\t\t<template v-else>\r\n\t\t\t\t\t\t\t<el-table-column v-if=\"item.prop=='cs_date'\" show-overflow-tooltip :align=\"item.align\" :label=\"item.label\" :prop=\"item.prop\" width=\"150px\">\r\n\t\t\t\t\t\t\t\t<template slot-scope=\"scope\">\r\n\t\t\t\t\t\t\t\t\t<el-link type=\"primary\" :underline=\"false\" v-html=\"scope.row.cs_date\" @click.stop=\"handleClickTableNameDetail(scope.row)\" class=\"displayBlock text-ellipsis \"></el-link>\r\n\t\t\t\t\t\t\t\t</template>\r\n\t\t\t\t\t\t\t</el-table-column>\r\n\t\t\t\t\t\t\t<el-table-column v-else-if=\"item.prop=='cs_score'\" show-overflow-tooltip :align=\"item.align\" :label=\"item.label\" :prop=\"item.prop\" width=\"150px\">\r\n\t\t\t\t\t\t\t\t<template slot-scope=\"scope\">\r\n\t\t\t\t\t\t\t\t\t<span>{{(scope.row.cs_score * 1).toFixed(item.decimlDigit * 1)}}</span>\r\n\t\t\t\t\t\t\t\t</template>\r\n\t\t\t\t\t\t\t</el-table-column>\r\n      \t\t\t\t<el-table-column v-else show-overflow-tooltip :align=\"item.align\" :label=\"item.label\" :prop=\"item.prop\">\r\n      \t\t\t\t</el-table-column>\r\n      \t\t\t</template>\r\n      \t\t</template>\r\n      \t</template>\r\n        </el-table>\r\n        <pagination\r\n          v-show=\"total1>0\"\r\n          :total=\"total1\"\r\n          :page.sync=\"queryParams.pageNum\"\r\n          :limit.sync=\"queryParams.pageSize\"\r\n          @pagination=\"getQualityDetail\"\r\n        />\r\n        <div slot=\"footer\" class=\"dialog-footer\">\r\n          <el-button @click=\"detailCancel\">关 闭</el-button>\r\n        </div>\r\n      </el-dialog>\r\n      \r\n      <detailInfo v-if=\"openInfo\" :open=\"openInfo\" :id=\"formDesignId\" :ids=\"idsInfo\" @cancel=\"cancelDetailInfo\"></detailInfo>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport { validEmail } from'@/utils/validate'\r\nimport { getQuality,getQualityDetail } from \"@/api/quality/quality\";\r\nimport { deployList} from '@/api/utils';\r\nimport { listDetail } from \"@/api/quality/detail\";\r\nimport {getDeptInfoForPms} from \"@/api/formDesign/formDesign\";\r\nimport detailInfo from './detailInfo';\r\n\r\nexport default {\r\n  name: \"addEdit\",\r\n  props: {\r\n    open: {\r\n      type: Boolean,\r\n      default: false\r\n    },\r\n    datas: {\r\n      type: Object,\r\n      default: null,\r\n    }\r\n  },\r\n  watch: {\r\n    datas: {\r\n      handler(val) {\r\n        this.reset();\r\n        if (val) {\r\n          this.paramsData = val;\r\n          this.title = \"查看详情 / 质量得分\";\r\n          this.getDetailInfo();\r\n        } \r\n      },\r\n      deep: true,\r\n      immediate: true\r\n    },\r\n    open: {\r\n      handler(val) {\r\n        this.openDialog = val;\r\n      },\r\n      deep: true\r\n    }\r\n  },\r\n  components: {\r\n    detailInfo\r\n  },\r\n  created() {\r\n    this.getDetailInfo();\r\n  },\r\n  data() {\r\n    return {\r\n      title: \"查看详情 / 质量得分\",\r\n      openDialog: this.open,\r\n      paramsData:null,\r\n      detailTitle:\"查看详情 / 质量得分 / 得分明细\",\r\n      openDetailDialog:false,\r\n      saveLoading: false,\r\n      openInfo:false,\r\n      single:true,\r\n      singleItem:true,\r\n      // 显示搜索条件\r\n      showSearch: true,\r\n      // 表单参数\r\n      form: {},\r\n      // 表单校验\r\n      rules: {\r\n      },\r\n      queryParams:{\r\n        pageNum:1,\r\n        pageSize:30,\r\n      },\r\n      qualityList:[],\r\n      total:0,\r\n      qualityList1:[],\r\n      total1:0,\r\n      loading:false,\r\n      loading1:false,\r\n      selectionRow:[],\r\n      selectionRowItem:[],\r\n      cols:[],\r\n      lists:[],\r\n      formDesignId:'',\r\n      ids:'',\r\n      idsInfo:'',\r\n    };\r\n  },\r\n\r\n  methods: {\r\n    handleClickTableName(data){\r\n      // 选中当前行\r\n        this.rowClick(data, false);\r\n        this.handleDetail();\r\n    },\r\n    handleClickTableNameDetail(data){\r\n      this.rowClick1(data, false);\r\n      this.handleDetailItem(data)\r\n    },\r\n  \tgetDetailInfo() {\r\n      if(this.datas){\r\n        let params={\r\n        deptCode:this.datas.deptCode,\r\n        compCode:this.$store.state.user.userInfo.deptId,\r\n        qTime:this.datas.occTime + '-01'\r\n      }\r\n      // console.log(params)\r\n      this.loading=true;\r\n      getQuality(params).then(response => {\r\n        if(response.code==200){\r\n          this.qualityList=response.rows;\r\n          // console.log(this.qualityList)\r\n          this.total=response.total;\r\n          this.loading=false;\r\n        }\r\n      });\r\n      }\r\n      \r\n    },\r\n    stateFormat(row, column, cellValue) {\r\n\t\t\t\tlet arr = this.lists;\r\n    \t\tfor(let i=0;i<arr.length;i++){\r\n    \t\t\tif(arr[i].fieldName==column.property){\r\n\t\t\t\t\t\tif(arr[i].fieldName==\"cs_target\"){\r\n\t\t\t\t\t\t\treturn this.selectDictIndexLabel(arr[i].options,cellValue)\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\treturn this.selectDictLabel(arr[i].options,cellValue);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n    getQualityDetail(data){\r\n      this.formDesignId=data.tempCode\r\n      let obj={\r\n        formDesignId:data.tempCode,\r\n      }\r\n      deployList(obj).then(res=>{\r\n        this.lists = res.data;\r\n        for(let i=0;i<this.lists.length;i++){\r\n\t        \t\tthis.$set( this.lists[i], this.lists[i].fieldName, null )\r\n\t\t\t\t\t\t\tthis.$set( this.lists[i], \"val\", null )\r\n\t\t\t\t\t\t\tif(this.lists[i].fieldType==\"select\"){\r\n\t\t\t\t\t\t\t\tif(this.lists[i].fieldName==\"cs_target\"){\r\n\t\t\t\t\t\t\t\t\t\tlet params={\r\n\t\t\t\t\t\t\t\t\t\t\t\tindexCode:this.lists[i].indexCode,\r\n\t\t\t\t\t\t\t\t\t\t\t\tcompCode:this.$store.state.user.userInfo.deptId  // 必传\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\tlistDetail(params).then(response=>{\r\n\t\t\t\t\t\t\t\t\t\t\t\tif(response.code===200){\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tthis.$set( this.lists[i], \"options\",response.rows );\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tthis.targetValue=JSON.parse(JSON.stringify(response.rows))\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t}else if(this.lists[i].fieldName==\"cs_dept\"){\r\n\t\t\t\t\t\t\t\t\tlet params= {\r\n\t\t\t\t\t\t\t\t\t\tcompCode:this.$store.state.user.userInfo.deptId\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tgetDeptInfoForPms(params).then(res=>{\r\n\t\t\t\t\t\t\t\t\t\t\tif(res.code===200){\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tthis.$set( this.lists[i], \"options\",res.data )\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\t\tthis.getDicts(this.lists[i].dictType).then(response => {\r\n\t\t\t\t\t\t\t\t\t\tthis.$set( this.lists[i], \"options\", response.data )\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t        \t\tif(this.lists[i].fieldType==\"radio\"){\r\n\t        \t\t\tthis.lists[i].options = JSON.parse(this.lists[i].options)\r\n\t        \t\t}\r\n\t        \t\tif(this.lists[i].fieldType==\"checkbox\"){\r\n\t        \t\t\tthis.lists[i].options = JSON.parse(this.lists[i].options)\r\n\t        \t\t\tthis.$set( this.lists[i], \"val\", [])\r\n\t        \t\t}\r\n\t\t\t\t\t\t}\r\n         let list = res.data;\r\n\t\t\t\t\t\t// console.log(list,'list')\r\n\t        \tlet arr = [];\r\n\t        \tfor(let i=0;i<list.length;i++){\r\n\t\t\t\t\t\t\tlet obj = {};\r\n\t\t\t\t\t\t\tif(list[i].fieldName!=\"pms_state\"){\r\n\t\t\t\t\t\t\t\tif(list[i].fieldName!=\"dept_track\"){\r\n\t\t\t\t\t\t\t\t\tobj.label = list[i].fieldDesc;\r\n\t\t\t\t\t\t\t\t\tobj.prop = list[i].fieldName;\r\n\t\t\t\t\t\t\t\t\tobj.isList = list[i].isList;\r\n\t\t\t\t\t\t\t\t\tobj.fieldType = list[i].fieldType;\r\n\t\t\t\t\t\t\t\t\tif(list[i].fieldName=='cs_score'){\r\n\t\t\t\t\t\t\t\t\t\tobj.decimlDigit = list[i].decimlDigit\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tif(obj.prop=='cs_date'){\r\n\t\t\t\t\t\t\t\t\t\tobj.align='center';\r\n\t\t\t\t\t\t\t\t\t}else if(obj.prop=='cs_score'){\r\n\t\t\t\t\t\t\t\t\t\tobj.align='right';\r\n\t\t\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\t\t\tobj.align='left';\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tarr.push(obj)\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n            this.cols = arr;\r\n            this.getTable(data)\r\n      })\r\n    },\r\n    //表格数据\r\n    getTable(data){\r\n      let params={\r\n        formDesignId:data.tempCode, \r\n        deptCode:data.deptCode, \r\n        qDate:this.datas.occTime + '-01',\r\n      };\r\n      getQualityDetail(params).then(response=>{\r\n        this.qualityList1=response.rows;\r\n        this.total1=response.total;\r\n      })\r\n    },\r\n   \r\n    //查看详情\r\n    handleDetail(){ \r\n      this.getQualityDetail(this.selectionRow[0]);        \r\n      this.openDetailDialog=true;\r\n    },\r\n    //查看详细信息\r\n    handleDetailItem(data){\r\n      this.idsInfo=this.selectionRowItem[0].id;\r\n      this.openInfo=true;\r\n    },\r\n    cancelDetailInfo(){\r\n      this.openInfo=false;\r\n    },\r\n    // 多选框选中数据\r\n    handleSelectionChange(selection) {\r\n      this.ids = selection.map(item => item.id)\r\n      this.single = selection.length!==1\r\n      this.selectionRow=selection;\r\n    },\r\n    rowClick(row, column, event) {\r\n      let refsElTable = this.$refs.multipleTable;\r\n      let findRow = this.selectionRow.find(c => c.rowIndex == row.rowIndex);\r\n      // if (findRow && this.selectionRow.length == 1) {\r\n      //   refsElTable.toggleRowSelection(row, false);\r\n      //   return;\r\n      // }\r\n      refsElTable.clearSelection();\r\n      refsElTable.toggleRowSelection(row);\r\n    },\r\n    // 多选框选中数据\r\n    handleSelectionChange1(selection) {\r\n      // this.ids = selection.map(item => item.id)\r\n      this.singleItem = selection.length!==1\r\n      this.selectionRowItem=selection\r\n    },\r\n    rowClick1(row, column, event) {\r\n      let refsElTable = this.$refs.multipleTable1;\r\n      let findRow = this.selectionRowItem.find(c => c.rowIndex == row.rowIndex);\r\n      // if (findRow && this.selectionRowItem.length == 1) {\r\n      //   refsElTable.toggleRowSelection(row, false);\r\n      //   return;\r\n      // }\r\n      refsElTable.clearSelection();\r\n      refsElTable.toggleRowSelection(row);\r\n    },\r\n    rowStyle({\r\n      row,\r\n      rowIndex\r\n    }) {\r\n      Object.defineProperty(row, 'rowIndex', {\r\n        value: rowIndex,\r\n        writable: true,\r\n        enumerable: false\r\n      })\r\n    },\r\n    //详情弹框关闭\r\n    handleDetailDialogClose(){\r\n      this.openDetailDialog=false;\r\n    },\r\n    detailCancel(){\r\n      this.openDetailDialog=false;\r\n    },\r\n    // 弹框关闭\r\n    handleDialogClose() {\r\n      this.$emit(\"cancel\", false);\r\n    },\r\n    // 取消\r\n    cancel() {\r\n      this.$emit(\"cancel\", false);\r\n    },\r\n    // 表单重置\r\n    reset() {\r\n      this.form = {\r\n        id: null,\r\n        compCode: null,\r\n        accountCode: null,\r\n        deptCode: null,\r\n        indexCode: null,\r\n        tempCode: null,\r\n        indexScore: null,\r\n        occureTime: null,\r\n        actualScore: null,\r\n        delFlag: null,\r\n        createBy: null,\r\n        createTime: null,\r\n        updateBy: null,\r\n        updateTime: null,\r\n        remark: null\r\n      };\r\n      this.resetForm(\"form\");\r\n    },\r\n  }\r\n};\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n  ::v-deep .el-dialog {\r\n    height: 80%;\r\n    overflow: hidden;\r\n    .el-dialog__body {\r\n      height: calc(100% - 100px);\r\n      overflow: auto;\r\n    }\r\n  }\r\n</style>"]}]}