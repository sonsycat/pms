{"remainingRequest":"F:\\pms_UI\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\pms_UI\\src\\views\\evaluate\\setdeptdetail\\index.vue?vue&type=style&index=0&id=cabe8642&lang=scss&scoped=true&","dependencies":[{"path":"F:\\pms_UI\\src\\views\\evaluate\\setdeptdetail\\index.vue","mtime":1727074195995},{"path":"F:\\pms_UI\\node_modules\\css-loader\\dist\\cjs.js","mtime":1693361949271},{"path":"F:\\pms_UI\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1693362179282},{"path":"F:\\pms_UI\\node_modules\\postcss-loader\\src\\index.js","mtime":1693362110683},{"path":"F:\\pms_UI\\node_modules\\sass-loader\\dist\\cjs.js","mtime":1693362152666},{"path":"F:\\pms_UI\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1693361924439},{"path":"F:\\pms_UI\\node_modules\\vue-loader\\lib\\index.js","mtime":1693362179279}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgo6OnYtZGVlcCAuZWwtZGlhbG9nIHsKICAgIGhlaWdodDogODAlOwogICAgb3ZlcmZsb3c6IGhpZGRlbjsKICAgIC5lbC1kaWFsb2dfX2JvZHkgewogICAgICBoZWlnaHQ6IGNhbGMoMTAwJSAtIDEwMHB4KTsKICAgICAgb3ZlcmZsb3c6IGhpZGRlbjsKICAgICAgLnRhYmxlLWJveHsKICAgICAgICBoZWlnaHQ6NTQwcHg7CiAgICAgICAgb3ZlcmZsb3c6IGF1dG87CiAgICAgICAgbWFyZ2luLXRvcDogNDZweDsKICAgICAgICAmOjotd2Via2l0LXNjcm9sbGJhciB7CiAgICAgICAgICB3aWR0aDogOHB4OwogICAgICAgICAgaGVpZ2h0OiA4cHgKICAgICAgICB9CiAgICAgICAgJjo6LXdlYmtpdC1zY3JvbGxiYXItdGh1bWIgIHsKICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICNjY2NjY2M7CiAgICAgICAgICBib3JkZXItcmFkaXVzOiA4cHg7CiAgICAgICAgfQogICAgICAgIC50YWJsZS1ib3gtYm9keXsKICAgICAgICAgIGhlaWdodDogNDAwcHg7CiAgICAgICAgICBwYWRkaW5nLXRvcDogMTZweDsKICAgICAgICAgIGJvcmRlcjogMXB4IHNvbGlkICNjY2NjY2MKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9Cgo="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4dA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/evaluate/setdeptdetail","sourcesContent":["<template>\n  <div class=\"app-container\">\n\t  <el-dialog :title=\"title\" :visible.sync=\"openDialog\" width=\"80%\" custom-class=\"el-button--primary\" append-to-body :close-on-click-modal=\"false\" @close=\"handleDialogClose\">\n      <el-form ref=\"queryForm\" :model=\"datas\">\n        <el-row>\n          <el-col :span=\"24\">\n            <el-col :span=\"6\">\n              <el-form-item label=\"科室名称\" prop=\"deptName\">\n                <el-input\n                  v-model=\"datas.deptName\"\n                  placeholder=\"请输入科室名称\"\n                  disabled\n                />\n              </el-form-item>\n            </el-col>\n          </el-col>\n          <div class=\"table-box\">\n            <div class=\"table-box-body\" v-for=\"(item,index) in bscList\" :key=\"index\">\n              <el-col :span=\"4\">\n                <el-form-item :label=\"item.bscName + '-总分'\" :prop=\"item.bscCode\">\n                  <el-input-number\n                    v-model=\"item.score\"\n                    placeholder=\"总分\"\n                    :precision=\"2\" controls-position=\"right\"\n                  />\n                </el-form-item>\n              </el-col>\n              <el-table border stripe v-loading=\"loading\" :data=\"item.setdeptdetailList\" height=\"88%\">\n                <el-table-column min-width=\"140px\" sortable label=\"指标名称\" align=\"center\" prop=\"indexName\" show-overflow-tooltip />\n                <el-table-column min-width=\"140px\" sortable label=\"降低量\" align=\"center\" prop=\"reduce\">\n                  <template slot-scope=\"scope\">\n                    <el-input-number :precision=\"2\" controls-position=\"right\" :min=\"0\" :max=\"100\" v-model=\"scope.row.reduce\" class=\"w100\"></el-input-number>\n                  </template>\n                </el-table-column>\n                <el-table-column min-width=\"140px\" sortable label=\"扣分\" align=\"center\" prop=\"deduct\">\n                  <template slot-scope=\"scope\">\n                    <el-input-number :precision=\"2\" controls-position=\"right\" :max=\"0\" v-model=\"scope.row.deduct\" class=\"w100\"></el-input-number>\n                  </template>\n                </el-table-column>\n                <el-table-column min-width=\"140px\" sortable label=\"增加量\" align=\"center\" prop=\"increase\">\n                  <template slot-scope=\"scope\">\n                    <el-input-number :precision=\"2\" controls-position=\"right\" :min=\"0\" v-model=\"scope.row.increase\" class=\"w100\"></el-input-number>\n                  </template>\n                </el-table-column>\n                <el-table-column min-width=\"140px\" sortable label=\"加分\" align=\"center\" prop=\"extra\" >\n                  <template slot-scope=\"scope\">\n                    <el-input-number :precision=\"2\" controls-position=\"right\" :min=\"0\" v-model=\"scope.row.extra\" class=\"w100\"></el-input-number>\n                  </template>\n                </el-table-column>\n                <el-table-column min-width=\"120px\" sortable label=\"单位(%)\" align=\"center\" prop=\"unit\">\n                  <template slot-scope=\"scope\">\n                    <el-select v-model=\"scope.row.unit\" filterable clearable placeholder=\"请选择\" >\n                      <el-option\n                        v-for=\"dict in isUnitOptions\"\n                        :key=\"dict.dictValue\"\n                        :label=\"dict.dictLabel\"\n                        :value=\"dict.dictValue\"\n                      ></el-option>\n                    </el-select>\n                  </template>\n                </el-table-column>\n                <el-table-column min-width=\"140px\" sortable label=\"目标值\" align=\"center\" prop=\"target\">\n                  <template slot-scope=\"scope\">\n                    <el-input-number :precision=\"2\" controls-position=\"right\" v-model=\"scope.row.target\" class=\"w100\"></el-input-number>\n                  </template>\n                </el-table-column>\n                <el-table-column min-width=\"140px\" sortable label=\"指标分数\" align=\"center\" prop=\"indexScore\">\n                  <template slot-scope=\"scope\">\n                    <el-input-number :precision=\"2\" controls-position=\"right\" :min=\"0\" v-model=\"scope.row.indexScore\" class=\"w100\" @change=\"changeIndexScore(scope.row,scope.$index)\"></el-input-number>\n                  </template>\n                </el-table-column>\n                <el-table-column min-width=\"120px\" sortable label=\"允许超分\" align=\"center\" prop=\"isHyper\">\n                  <template slot-scope=\"scope\">\n                    <el-select v-model=\"scope.row.isHyper\" filterable clearable placeholder=\"请选择\" >\n                      <el-option\n                        v-for=\"dict in isHyperOptions\"\n                        :key=\"dict.dictValue\"\n                        :label=\"dict.dictLabel\"\n                        :value=\"dict.dictValue\"\n                      ></el-option>\n                    </el-select>\n                  </template>\n                </el-table-column>\n                <el-table-column min-width=\"120px\" sortable label=\"允许负分\" align=\"center\" prop=\"isNegative\">\n                  <template slot-scope=\"scope\">\n                    <el-select v-model=\"scope.row.isNegative\" filterable clearable placeholder=\"请选择\" >\n                      <el-option\n                        v-for=\"dict in isNegativeOptions\"\n                        :key=\"dict.dictValue\"\n                        :label=\"dict.dictLabel\"\n                        :value=\"dict.dictValue\"\n                      ></el-option>\n                    </el-select>\n                  </template>\n                </el-table-column>\n                <el-table-column min-width=\"120px\" sortable label=\"固定分值\" align=\"center\" prop=\"isFixed\">\n                  <template slot-scope=\"scope\">\n                    <el-select v-model=\"scope.row.isFixed\" filterable clearable placeholder=\"请选择\" >\n                      <el-option\n                        v-for=\"dict in isFixedOptions\"\n                        :key=\"dict.dictValue\"\n                        :label=\"dict.dictLabel\"\n                        :value=\"dict.dictValue\"\n                      ></el-option>\n                    </el-select>\n                  </template>\n                </el-table-column>\n                <el-table-column min-width=\"140px\" sortable label=\"阀值\" align=\"center\" prop=\"threshold\">\n                  <template slot-scope=\"scope\">\n                    <el-input-number :precision=\"2\" controls-position=\"right\" :min=\"1\" v-model=\"scope.row.threshold\" class=\"w100\"></el-input-number>\n                  </template>\n                </el-table-column>\n                <el-table-column min-width=\"140px\" sortable label=\"超分限制\" align=\"center\" prop=\"overLimit\">\n                  <template slot-scope=\"scope\">\n                    <el-input-number :precision=\"2\" controls-position=\"right\" :min=\"0\" :max=\"100\" v-model=\"scope.row.overLimit\" class=\"w100\"></el-input-number>\n                  </template>\n                </el-table-column>\n                <el-table-column min-width=\"140px\" sortable label=\"减分限制\" align=\"center\" prop=\"deductionLimit\">\n                  <template slot-scope=\"scope\">\n                    <el-input-number :precision=\"2\" controls-position=\"right\" :min=\"0\" :max=\"100\" v-model=\"scope.row.deductionLimit\" class=\"w100\"></el-input-number>\n                  </template>\n                </el-table-column>\n              </el-table>\n            </div>\n          </div>\n        </el-row>\n      </el-form>\n      <div slot=\"footer\" class=\"dialog-footer\">\n            <el-button type=\"primary\" @click=\"submitForm\" :loading=\"btnLoading\">保 存</el-button>\n            <el-button @click=\"cancel\">取 消</el-button>\n          </div>\n\t  </el-dialog>\n  </div>\n</template>\n\n<script>\nimport {\n  listSetdeptdetail,\n  getSetdeptdetail,\n  updateSetdeptdetail,\n  getBscScoreById\n} from '@/api/evaluate/setdeptdetail'\nimport { getConfigKey } from '@/api/system/config'\nimport { updateSetdept } from '@/api/evaluate/setdept'\nimport Vue from 'vue'\n\nexport default {\n  name: \"Setdeptdetail\",\n  components: {\n  },\n  props: {\n    open: {\n        type: Boolean,\n        default: false\n    },\n    id: {\n        type: [String, Number],\n        default: \"\"\n    },\n    datas: {\n      type: [Object],\n      default: null\n    },\n  },\n  watch: {\n    id: {\n      handler(val) {\n          this.reset();\n        if (val) {\n          this.id = val;\n          this.title = \"单科室多指标管理-科室指标设置\";\n        }\n      },\n        deep: true,\n        immediate: true\n      },\n      open: {\n        handler(val) {\n          this.openDialog = val;\n        },\n        deep: true\n      },\n  },\n  data() {\n    return {\n      // 遮罩层\n      loading: false,\n      // 导出遮罩层\n      exportLoading: false,\n      // 选中数组\n      ids: [],\n      // 非单个禁用\n      single: true,\n      // 非多个禁用\n      multiple: true,\n      // 显示搜索条件\n      showSearch: true,\n      // 总条数\n      total: 0,\n      // 指标集与科室管理明细表格数据\n      setdeptdetailList: [],\n      selectionRow: [],\n      openDialog:this.open,\n      // 弹出层标题\n      title: \"单科室多指标管理-科室指标设置\",\n      // 查询参数\n      queryParams: {\n        pageNum: 1,\n        pageSize: 30,\n        compCode: null,\n        accountCode: null,\n        setDeptCode: null,\n        indexCode: null,\n        indexName: null,\n        reduce: null,\n        deduct: null,\n        increase: null,\n        extra: null,\n        unit: null,\n        target: null,\n        indexScore: null,\n        isHyper: null,\n        isNegative: null,\n        isFixed: null,\n        threshold: null,\n        overLimit: null,\n        deductionLimit: null,\n        nowDate: null,\n      },\n      // 表单参数\n      form: {},\n      // 表单校验\n      rules: {\n      },\n      isUnitOptions:[],\n      isHyperOptions:[],\n      isNegativeOptions:[],\n      isFixedOptions:[],\n      btnLoading:false,\n      bscList:{},\n      roleConfig:null,\n    };\n  },\n  created() {\n    this.getBscScoreById();\n    //是否字典类型\n    this.getDicts(\"hr_is_change\").then(response => {\n      this.isUnitOptions = response.data;\n      this.isHyperOptions = response.data;\n      this.isNegativeOptions = response.data;\n      this.isFixedOptions = response.data;\n    });\n    this.getConfigKey();\n  },\n  methods: {\n    /** 查询系统参数：是否允许超分 */\n    getConfigKey(){\n      getConfigKey(\"exceedScoreFlag\").then(response => {\n        this.roleConfig = response.msg;\n      })\n    },\n    /** 查询该科室对应BSC分类及总分 */\n    getBscScoreById(){\n      getBscScoreById(this.id).then(response => {\n        this.bscList = response.data\n        this.getList()\n      })\n    },\n    /** 查询指标集与科室管理明细列表 */\n    getList() {\n      this.loading = true;\n      let params={\n        compCode:this.datas.compCode,\n        setDeptCode:this.datas.setDeptCode,\n        nowDate:this.datas.nowDate,\n      }\n      this.setdeptdetailList=[]\n      listSetdeptdetail(params).then(response => {\n        this.loading = false;\n        if(response.data.length==0){\n          this.getDetailInfo();\n        }else{\n          response.data.forEach(item=>{\n            item.reduce=item.reduce?item.reduce:0;\n            item.deduct=item.deduct?item.deduct:0;\n            item.increase=item.increase?item.increase:0;\n            item.extra=item.extra?item.extra:0;\n            item.unit=item.unit?item.unit:'0';\n            item.target=item.target?item.target:0;\n            item.indexScore=item.indexScore?item.indexScore:0;\n            item.isHyper=item.isHyper?item.isHyper:'1';\n            item.isNegative=item.isNegative?item.isNegative:'1';\n            item.isFixed=item.isFixed?item.isFixed:'1';\n            item.threshold=item.threshold?item.threshold:0;\n            item.overLimit=item.overLimit?item.overLimit:0;\n            item.deductionLimit=item.deductionLimit?item.deductionLimit:0;\n            for (let bsc in this.bscList){\n              if (item.bscOneCode == this.bscList[bsc].bscCode){\n                this.setdeptdetailList.push(item)\n                this.bscList[bsc].setdeptdetailList = this.setdeptdetailList\n              }\n              this.setdeptdetailList = []\n            }\n          })\n        }\n      });\n    },\n    getDetailInfo() {\n      this.loading=true;\n      let params={\n        compCode:this.datas.compCode,\n        setCode:this.datas.setCode,\n      }\n      getSetdeptdetail(params).then(response => {\n        response.data.forEach(item=>{\n          item.reduce=item.reduce?item.reduce:0;\n          item.deduct=item.deduct?item.deduct:0;\n          item.increase=item.increase?item.increase:0;\n          item.extra=item.extra?item.extra:0;\n          item.unit=item.unit?item.unit:'0';\n          item.target=item.target?item.target:0;\n          item.indexScore=item.indexScore?item.indexScore:0;\n          item.isHyper=item.isHyper?item.isHyper:'1';\n          item.isNegative=item.isNegative?item.isNegative:'1';\n          item.isFixed=item.isFixed?item.isFixed:'1';\n          item.threshold=item.threshold?item.threshold:0;\n          item.overLimit=item.overLimit?item.overLimit:0;\n          item.deductionLimit=item.deductionLimit?item.deductionLimit:0;\n          for (let bsc in this.bscList){\n            if (item.bscOneCode == this.bscList[bsc].bscCode){\n              this.setdeptdetailList.push(item)\n              this.bscList[bsc].setdeptdetailList = this.setdeptdetailList\n            }\n            this.setdeptdetailList = []\n          }\n        })\n        this.loading=false\n      });\n    },\n    // 表单重置\n    reset() {\n      this.form = {\n        id: null,\n        compCode: null,\n        accountCode: null,\n        setDeptCode: null,\n        indexCode: null,\n        indexName: null,\n        reduce: null,\n        deduct: null,\n        increase: null,\n        extra: null,\n        unit: null,\n        target: null,\n        indexScore: null,\n        isHyper: null,\n        isNegative: null,\n        isFixed: null,\n        threshold: null,\n        overLimit: null,\n        deductionLimit: null,\n        nowDate: null,\n        delFlag: null,\n        createBy: null,\n        createTime: null,\n        updateBy: null,\n        updateTime: null,\n        remark: null\n      };\n      this.resetForm(\"form\");\n    },\n    changeIndexScore(row,index){\n      if(row.bscOneCode=='0004'){\n        this.four_sumGrade=0\n        this.setdeptdetailList3.forEach(item=>{\n          this.four_sumGrade+=item.indexScore * 1\n        })\n      }else if(row.bscOneCode=='0003'){\n        this.third_sumGrade=0\n        this.setdeptdetailList2.forEach(item=>{\n          this.third_sumGrade+=item.indexScore * 1\n        })\n      }else if(row.bscOneCode=='0002'){\n        this.seconde_sumGrade=0\n        this.setdeptdetailList1.forEach(item=>{\n          this.seconde_sumGrade+=item.indexScore * 1\n        })\n      }else if(row.bscOneCode=='0001'){\n        this.first_sumGrade=0\n        this.setdeptdetailList.forEach(item=>{\n          this.first_sumGrade+=item.indexScore * 1\n        })\n      }\n    },\n    // 弹框关闭\n    handleDialogClose() {\n      this.$emit(\"cancel\", false);\n    },\n    // 取消\n    cancel() {\n      this.$emit(\"cancel\", false);\n    },\n\n    /** 提交按钮 */\n    submitForm() {\n      this.btnLoading = true;\n      let arr1 = []\n      for (let i in this.bscList) {\n        arr1.push(...this.bscList[i].setdeptdetailList)\n      }\n      let arr = arr1.map(item => {\n        item.reduce = item.reduce ? item.reduce + '' : '0';\n        item.deduct = item.deduct ? item.deduct + '' : '0';\n        item.increase = item.increase ? item.increase + '' : '0';\n        item.extra = item.extra ? item.extra + '' : '0';\n        item.target = item.target ? item.target + '' : '0';\n        item.indexScore = item.indexScore ? item.indexScore + '' : '0';\n        item.threshold = item.threshold ? item.threshold + '' : '0';\n        item.overLimit = item.overLimit ? item.overLimit + '' : '0';\n        item.deductionLimit = item.deductionLimit ? item.deductionLimit + '' : '0';\n        return item\n      });\n      // 校验指标分和总分大小关系\n      let targetSum = 0;\n      for (let b in this.bscList) {\n        for (let a in arr) {\n          if (arr[a].bscOneCode == this.bscList[b].bscCode) {\n            targetSum = targetSum + (arr[a].target - 0)\n            arr[a].sumScore = this.bscList[b].score\n          }\n        }\n        if (this.roleConfig == '0') {\n          if (targetSum > this.bscList[b].score || targetSum != this.bscList[b].score) {\n            this.$message.error(\"不允许超分或同类型下指标目标值和不等于总分！\");\n            this.btnLoading = false;\n            return\n          }\n        } else if (this.roleConfig == '1') {\n          if (targetSum < this.bscList[b].score) {\n            this.$message.error(\"同类型下指标目标值和小于总分！\");\n            this.btnLoading = false;\n            return\n          }\n        }\n        targetSum = 0;\n      }\n      let params = {\n        setDeptCode: this.datas.setDeptCode,\n        nowDate: this.datas.nowDate,\n        listPms: arr,\n        compCode: this.datas.compCode\n      };\n      for (let i in this.bscList){\n        Vue.delete(this.bscList[i],\"setdeptdetailList\")\n      }\n      let paramsBsc = {\n        id:this.id,\n        compCode: this.datas.compCode,\n        deptCode: this.datas.deptCode,\n        internalScore: JSON.stringify(this.bscList)\n      };\n      let saveLoading = this.saveLoading()\n      // 保存总分\n      updateSetdept(paramsBsc).then(response => {});\n      // 保存明细\n      updateSetdeptdetail(params).then(response => {\n        this.msgSuccess(\"保存成功\");\n        this.$emit(\"success\", false);\n        this.btnLoading = false;\n        saveLoading.close()\n      });\n    }\n  }\n};\n</script>\n<style lang=\"scss\" scoped>\n::v-deep .el-dialog {\n    height: 80%;\n    overflow: hidden;\n    .el-dialog__body {\n      height: calc(100% - 100px);\n      overflow: hidden;\n      .table-box{\n        height:540px;\n        overflow: auto;\n        margin-top: 46px;\n        &::-webkit-scrollbar {\n          width: 8px;\n          height: 8px\n        }\n        &::-webkit-scrollbar-thumb  {\n          background-color: #cccccc;\n          border-radius: 8px;\n        }\n        .table-box-body{\n          height: 400px;\n          padding-top: 16px;\n          border: 1px solid #cccccc\n        }\n      }\n    }\n  }\n\n</style>\n\n"]}]}