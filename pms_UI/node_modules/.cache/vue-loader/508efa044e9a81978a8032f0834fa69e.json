{"remainingRequest":"D:\\hrp\\zjry-pms-ui\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\hrp\\zjry-pms-ui\\src\\views\\quality\\index\\addEdit.vue?vue&type=style&index=0&id=97182758&lang=scss&scoped=true&","dependencies":[{"path":"D:\\hrp\\zjry-pms-ui\\src\\views\\quality\\index\\addEdit.vue","mtime":1682043107627},{"path":"D:\\hrp\\zjry-pms-ui\\node_modules\\css-loader\\dist\\cjs.js","mtime":1682058377861},{"path":"D:\\hrp\\zjry-pms-ui\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1682058382042},{"path":"D:\\hrp\\zjry-pms-ui\\node_modules\\postcss-loader\\src\\index.js","mtime":1682058378631},{"path":"D:\\hrp\\zjry-pms-ui\\node_modules\\sass-loader\\dist\\cjs.js","mtime":1682058378517},{"path":"D:\\hrp\\zjry-pms-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1682058377348},{"path":"D:\\hrp\\zjry-pms-ui\\node_modules\\vue-loader\\lib\\index.js","mtime":1682058381348}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKOjp2LWRlZXAgLmVsLWRpYWxvZyB7CiAgbWluLWhlaWdodDogMjAlOwogIG92ZXJmbG93OiBoaWRkZW47CgogIC5lbC1kaWFsb2dfX2JvZHkgewogICAgaGVpZ2h0OiBjYWxjKDEwMCUgLSAxMDBweCk7CiAgICBvdmVyZmxvdzogYXV0bzsKCiAgICAuZWwtc2VsZWN0IHsKICAgICAgd2lkdGg6IDEwMCU7CiAgICB9CgogICAgLmVsLWlucHV0LW51bWJlci0tbWluaSB7CiAgICAgIHdpZHRoOiAxMDAlOwogICAgfQogIH0KfQo="},{"version":3,"sources":["addEdit.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6RA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"addEdit.vue","sourceRoot":"src/views/quality/index","sourcesContent":["<template>\n  <el-dialog :title=\"title\" :visible.sync=\"openDialog\" width=\"50%\" custom-class=\"el-button--primary\" append-to-body\n             :close-on-click-modal=\"false\" @close=\"handleDialogClose\"\n  >\n    <el-form ref=\"form\" :model=\"form\" :rules=\"rules\" label-width=\"80px\">\n      <el-row :gutter=\"24\">\n        <el-col :span=\"12\">\n          <el-form-item label=\"指标名称\" prop=\"indexName\">\n            <el-input v-model=\"form.indexName\" placeholder=\"请输入指标名称\" maxlength=\"100\" show-word-limit/>\n          </el-form-item>\n        </el-col>\n        <el-col :span=\"12\">\n          <el-form-item label=\"主管部门\" prop=\"deptCode\">\n            <el-select clearable remote v-model=\"form.deptCode\" placeholder=\"请选择主管部门\" class=\"w100\" filterable>\n              <el-option\n                v-for=\"dict in deptList\"\n                :key=\"dict.dictValue\"\n                :label=\"dict.dictLabel\"\n                :value=\"dict.dictValue\"\n              ></el-option>\n            </el-select>\n          </el-form-item>\n        </el-col>\n        <el-col :span=\"12\">\n          <el-form-item label=\"指标分值\" prop=\"indexScore\">\n            <el-input-number controls-position=\"right\" :min=\"0\" :max=\"100\" :precision=\"2\" v-model=\"form.indexScore\"\n                             placeholder=\"请输入指标分值\"\n            />\n          </el-form-item>\n        </el-col>\n        <el-col :span=\"12\">\n          <el-form-item label=\"模板编码\" prop=\"tempCode\">\n            <el-select clearable filterable remote v-model=\"form.tempCode\" placeholder=\"请选择模板编码\" @change=\"getTempList\">\n              <el-option\n                v-for=\"dict in modelCodeOption\"\n                :key=\"dict.id\"\n                :label=\"dict.formName\"\n                :value=\"dict.id\"\n              ></el-option>\n            </el-select>\n          </el-form-item>\n        </el-col>\n        <el-col :span=\"12\">\n          <el-form-item label=\"时间列\" prop=\"dateColName\">\n            <el-input v-model=\"form.dateColName\" placeholder=\"请输入时间列\" disabled/>\n          </el-form-item>\n        </el-col>\n        <el-col :span=\"12\">\n          <el-form-item label=\"部门列\" prop=\"deptColName\">\n            <el-input v-model=\"form.deptColName\" placeholder=\"请输入部门列\" disabled/>\n          </el-form-item>\n        </el-col>\n        <el-col :span=\"12\">\n          <el-form-item label=\"数值列\" prop=\"numColName\">\n            <el-input v-model=\"form.numColName\" placeholder=\"请输入数值列\" disabled/>\n          </el-form-item>\n        </el-col>\n      </el-row>\n    </el-form>\n    <div slot=\"footer\" class=\"dialog-footer\">\n      <el-button type=\"primary\" @click=\"submitForm(true)\" :loading=\"addSaveLoading\">保存并继续添加</el-button>\n      <el-button type=\"primary\" @click=\"submitForm(false)\" :loading=\"saveLoading\">保 存</el-button>\n      <el-button @click=\"cancel\">取 消</el-button>\n    </div>\n  </el-dialog>\n</template>\n\n<script>\nimport { getDeptByComp } from '@/api/system/dict/data'\nimport { addIndex, getIndex, getTempCode, updateIndex } from '@/api/quality/index'\nimport { listFormDesign } from '@/api/formDesign/formDesign'\n\nexport default {\n  name: 'addEdit',\n  props: {\n    open: {\n      type: Boolean,\n      default: false\n    },\n    id: {\n      type: [String, Number],\n      default: ''\n    }\n  },\n  watch: {\n    id: {\n      handler(val) {\n        this.reset()\n        if (val) {\n          this.id = val\n          this.title = '质量考评指标管理-编辑'\n          this.getDetailInfo()\n        } else {\n          this.id = ''\n          this.title = '质量考评指标管理-新增'\n        }\n      },\n      deep: true,\n      immediate: true\n    },\n    open: {\n      handler(val) {\n        this.openDialog = val\n      },\n      deep: true\n    }\n  },\n  components: {},\n  data() {\n    return {\n      title: '质量考评指标管理-新增',\n      openDialog: this.open,\n      saveLoading: false,\n      addSaveLoading: false,\n      deptList: [],\n      //模板数据\n      modelCodeOption: [],\n      // 表单参数\n      form: {},\n      // 表单校验\n      rules: {\n        indexName: [\n          { required: true, message: '指标名称不能为空', trigger: 'blur' }\n        ],\n        deptName: [\n          { required: true, message: '主管部门不能为空', trigger: ['blur', 'change'] }\n        ],\n        indexScore: [\n          { required: true, message: '指标分值不能为空', trigger: 'blur' }\n        ]\n        // tempCode:[\n        //   { required: true, message: \"模板编码不能为空\", trigger: [\"blur\",\"change\"] }\n        // ],\n        // dateColName:[\n        //   { required: true, message: \"时间列不能为空\", trigger: [\"blur\",\"change\"] }\n        // ],\n        // deptColName:[\n        //   { required: true, message: \"部门列不能为空\", trigger: [\"blur\",\"change\"] }\n        // ],\n        // numColName:[\n        //   { required: true, message: \"数值列不能为空\", trigger: [\"blur\",\"change\"] }\n        // ],\n      },\n      dateColId: null,\n      deptColId: null,\n      numColId: null,\n      // 查询参数\n      queryParams: {\n        // pageNum: 1,\n        // pageSize: 30,\n        compCode: this.$store.state.user.userInfo.deptId\n      }\n    }\n  },\n  created() {\n    this.getDeptByComp()\n    this.getTempList()\n  },\n  methods: {\n    getDetailInfo() {\n      getIndex(this.id).then(response => {\n        this.form = response.data\n      })\n    },\n    // 获取当前登录用户单位下的科室\n    getDeptByComp(compCode) {\n      let data = {\n        compCode: this.$store.state.user.userInfo.deptId\n      }\n      getDeptByComp(data).then(res => {\n        this.deptList = res.data\n      })\n    },\n    //获取模板编码信息\n    getTempList(id) {\n      let obj = { formDesignId: id }\n      listFormDesign(this.queryParams).then(res => {\n        if (res.code == 200) {\n          this.modelCodeOption = res.rows\n        }\n      })\n      this.changeTempFun(obj)\n    },\n    //获取模板编码相关列信息\n    changeTempFun(id) {\n      getTempCode(id).then(res => {\n        if (res.code == 200) {\n          res.data.forEach(item => {\n            if (item.fieldName == 'cs_date') {\n              this.form.dateColName = item.fieldDesc\n              this.dateColId = item.id\n            } else if (item.fieldName == 'cs_dept') {\n              this.form.deptColName = item.fieldDesc\n              this.deptColId = item.id\n            } else {\n              this.form.numColName = item.fieldDesc\n              this.numColId = item.id\n            }\n          })\n        }\n      })\n\n    },\n    // 弹框关闭\n    handleDialogClose() {\n      this.$emit('cancel', false)\n    },\n    // 取消\n    cancel() {\n      this.$emit('cancel', false)\n    },\n    // 表单重置\n    reset() {\n      this.form = {\n        id: null,\n        compCode: null,\n        accountCode: null,\n        deptCode: null,\n        deptName: null,\n        indexCode: null,\n        indexName: null,\n        indexScore: null,\n        tempCode: null,\n        dateColName: null,\n        deptColName: null,\n        numColName: null,\n        delFlag: null,\n        createBy: null,\n        createTime: null,\n        updateBy: null,\n        updateTime: null,\n        remark: null\n      }\n      this.resetForm('form')\n    },\n    /** 提交按钮 */\n    submitForm(type) {\n      this.$refs['form'].validate(valid => {\n        if (valid) {\n          this.form.dateColName = this.dateColId\n          this.form.deptColName = this.deptColId\n          this.form.numColName = this.numColId\n          this.form.compCode = this.$store.state.user.userInfo.deptId\n          if (this.form.id != null) {\n            if (type) {\n              this.addSaveLoading = true\n              updateIndex(this.form).then(response => {\n                this.msgSuccess('修改成功')\n                this.reset()\n                this.addSaveLoading = false\n                this.$emit('success', true)\n              })\n            } else {\n              this.saveLoading = true\n              updateIndex(this.form).then(response => {\n                this.msgSuccess('修改成功')\n                this.$emit('success', false)\n                this.saveLoading = false\n              })\n            }\n          } else {\n            if (type) {\n              this.addSaveLoading = true\n              addIndex(this.form).then(response => {\n                this.msgSuccess('新增成功')\n                this.addSaveLoading = false\n                this.reset()\n                this.$emit('success', true)\n              })\n            } else {\n              this.saveLoading = true\n              addIndex(this.form).then(response => {\n                this.msgSuccess('新增成功')\n                this.$emit('success', false)\n                this.saveLoading = false\n              })\n            }\n          }\n        }\n      })\n    }\n  }\n}\n</script>\n<style lang=\"scss\" scoped>\n::v-deep .el-dialog {\n  min-height: 20%;\n  overflow: hidden;\n\n  .el-dialog__body {\n    height: calc(100% - 100px);\n    overflow: auto;\n\n    .el-select {\n      width: 100%;\n    }\n\n    .el-input-number--mini {\n      width: 100%;\n    }\n  }\n}\n</style>\n"]}]}