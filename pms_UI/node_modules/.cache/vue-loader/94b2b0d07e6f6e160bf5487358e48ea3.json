{"remainingRequest":"F:\\pms_UI\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\pms_UI\\src\\views\\project\\project\\addEdit.vue?vue&type=style&index=0&id=47b061b5&lang=scss&scoped=true&","dependencies":[{"path":"F:\\pms_UI\\src\\views\\project\\project\\addEdit.vue","mtime":1693362205739},{"path":"F:\\pms_UI\\node_modules\\css-loader\\dist\\cjs.js","mtime":1693361949271},{"path":"F:\\pms_UI\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1693362179282},{"path":"F:\\pms_UI\\node_modules\\postcss-loader\\src\\index.js","mtime":1693362110683},{"path":"F:\\pms_UI\\node_modules\\sass-loader\\dist\\cjs.js","mtime":1693362152666},{"path":"F:\\pms_UI\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1693361924439},{"path":"F:\\pms_UI\\node_modules\\vue-loader\\lib\\index.js","mtime":1693362179279}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKOjp2LWRlZXAgLmVsLWRpYWxvZyB7CiAgbWluLWhlaWdodDogMjAlOwogIG92ZXJmbG93OiBoaWRkZW47CiAgLmVsLWRpYWxvZ19fYm9keSB7CiAgICBoZWlnaHQ6IGNhbGMoMTAwJSAtIDEwMHB4KTsKICAgIG92ZXJmbG93OiBhdXRvOwogIH0KfQo="},{"version":3,"sources":["addEdit.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"addEdit.vue","sourceRoot":"src/views/project/project","sourcesContent":["<template>\n  <el-dialog :title=\"title\" :visible.sync=\"openDialog\" width=\"50%\" custom-class=\"el-button--primary\" append-to-body\n             :close-on-click-modal=\"false\" @close=\"handleDialogClose\">\n    <el-form ref=\"form\" :model=\"form\" :rules=\"rules\" label-width=\"80px\">\n      <el-row :gutter=\"24\">\n        <el-col :span=\"12\">\n          <el-form-item label=\"项目编码:\" prop=\"projectCode\"   >\n            <el-input v-model=\"form.projectCode\" @blur=\"checkCode()\"  placeholder=\"请输入项目编码\" maxlength=\"50\" :disabled = \"idflag\"\n                      show-word-limit/>\n          </el-form-item>\n        </el-col>\n        <el-col :span=\"12\">\n          <el-form-item label=\"项目名称:\" prop=\"projectName\">\n            <el-input v-model=\"form.projectName\" placeholder=\"请输入项目名称\" maxlength=\"100\" show-word-limit/>\n          </el-form-item>\n        </el-col>\n        <el-col :span=\"12\">\n          <el-form-item label=\"上级项目:\" prop=\"parentProject\">\n            <el-input v-model=\"form.parentProject\" maxlength=\"50\" disabled show-word-limit/>\n          </el-form-item>\n        </el-col>\n        <el-col :span=\"12\">\n          <el-form-item label=\"项目级别:\" prop=\"projectLevel\">\n            <el-select v-model=\"form.projectLevel\" placeholder=\"\" disabled class=\"w100\">\n              <el-option\n                v-for=\"dict in projectLevelOptions\"\n                :key=\"dict.dictValue\"\n                :label=\"dict.dictLabel\"\n                :value=\"dict.dictValue\"\n              ></el-option>\n            </el-select>\n          </el-form-item>\n        </el-col>\n        <el-col :span=\"12\">\n          <el-form-item label=\"项目类型:\" prop=\"projectType\">\n            <el-select v-model=\"form.projectType\" placeholder=\"请选择项目类型\" class=\"w100\">\n              <el-option\n                v-for=\"dict in projectTypeOptions\"\n                :key=\"dict.dictValue\"\n                :label=\"dict.dictLabel\"\n                :value=\"dict.dictValue\"\n              ></el-option>\n            </el-select>\n          </el-form-item>\n        </el-col>\n        <el-col :span=\"12\">\n          <el-form-item label=\"成本属性:\" prop=\"costProperty\">\n            <el-select v-model=\"form.costProperty\" placeholder=\"请选择成本属性\" class=\"w100\">\n              <el-option\n                v-for=\"dict in costPropertyOptions\"\n                :key=\"dict.dictValue\"\n                :label=\"dict.dictLabel\"\n                :value=\"dict.dictValue\"\n              ></el-option>\n            </el-select>\n          </el-form-item>\n        </el-col>\n        <el-col :span=\"12\">\n          <el-form-item label=\"是否可控:\" prop=\"isControl\">\n            <el-select v-model=\"form.isControl\" placeholder=\"请选择是否可控\" class=\"w100\">\n              <el-option\n                v-for=\"dict in isControlOptions\"\n                :key=\"dict.dictValue\"\n                :label=\"dict.dictLabel\"\n                :value=\"dict.dictValue\"\n              ></el-option>\n            </el-select>\n          </el-form-item>\n        </el-col>\n        <el-col :span=\"12\">\n          <el-form-item label=\"是否核算:\" prop=\"isAccount\">\n            <el-select v-model=\"form.isAccount\" placeholder=\"请选择是否核算\" class=\"w100\">\n              <el-option\n                v-for=\"dict in isAccountOptions\"\n                :key=\"dict.dictValue\"\n                :label=\"dict.dictLabel\"\n                :value=\"dict.dictValue\"\n              ></el-option>\n            </el-select>\n          </el-form-item>\n        </el-col>\n        <el-col :span=\"12\">\n          <el-form-item label=\"资本性成本:\" prop=\"isCostCapital\">\n            <el-select v-model=\"form.isCostCapital\" placeholder=\"请选择是否资本性成本\" class=\"w100\">\n              <el-option\n                v-for=\"dict in isCostCapitalOptions\"\n                :key=\"dict.dictValue\"\n                :label=\"dict.dictLabel\"\n                :value=\"dict.dictValue\"\n              ></el-option>\n            </el-select>\n          </el-form-item>\n        </el-col>\n        <el-col :span=\"12\">\n          <el-form-item label=\"是否医疗成本:\" prop=\"isCostHealth\">\n            <el-select v-model=\"form.isCostHealth\" placeholder=\"请选择是否医疗成本\" class=\"w100\">\n              <el-option\n                v-for=\"dict in isCostHealthOptions\"\n                :key=\"dict.dictValue\"\n                :label=\"dict.dictLabel\"\n                :value=\"dict.dictValue\"\n              ></el-option>\n            </el-select>\n          </el-form-item>\n        </el-col>\n        <el-col :span=\"12\">\n          <el-form-item label=\"计算计入成本:\" prop=\"isCostCalculate\">\n            <el-select v-model=\"form.isCostCalculate\" placeholder=\"请选择计算计入成本\" class=\"w100\" disabled>\n              <el-option\n                v-for=\"dict in isCostCalculateOptions\"\n                :key=\"dict.dictValue\"\n                :label=\"dict.dictLabel\"\n                :value=\"dict.dictValue\"\n              ></el-option>\n            </el-select>\n          </el-form-item>\n        </el-col>\n        <el-col :span=\"24\" v-if=\"form.isCostCalculate==0\">\n          <projectPop label=\"计算计入成本分摊方案\" :formProp=\"form.costScheme\" prop=\"costScheme\" :projectType='2' :queryParams=\"form\" @click=\"handleClickProjectPop\"/>\n        </el-col>\n      </el-row>\n    </el-form>\n    <div slot=\"footer\" class=\"dialog-footer\">\n      <el-button type=\"primary\" @click=\"submitForm(true)\" v-show=\"!idflag\">保存并继续添加</el-button>\n      <el-button type=\"primary\" @click=\"submitForm(false)\" >确 定</el-button>\n      <el-button @click=\"cancel\">取 消</el-button>\n    </div>\n  </el-dialog>\n</template>\n\n<script>\n  import {validEmail} from '@/utils/validate';\n  import {\n    listProject,\n    getProject,\n    delProject,\n    addProject,\n    updateProject,\n    exportProject,\n    checkCode\n  } from \"@/api/project/project\";\n  import { getProject1,getProject2 } from \"@/api/system/dict/data\";\n  import projectPop from \"@/views/components/projectPop\";\n  export default {\n    name: \"addEdit\",\n    props: {\n      open: {\n        type: Boolean,\n        default: false\n      },\n      id: {\n        type: [String, Number],\n        default: \"\"\n      },\n      levelOptions:{\n        type:[Array],\n        default:[]\n      }\n    },\n    watch: {\n      id: {\n        handler(val) {\n          this.reset();\n          if (val) {\n            this.id = val;\n            this.idflag = true;\n            this.title = \"成本项目管理-编辑\";\n            this.getDetailInfo();\n          } else {\n            this.id = \"\";\n            this.idflag = false;\n            this.title = \"成本项目管理-新增\";\n          }\n        },\n        deep: true,\n        immediate: true\n      },\n      open: {\n        handler(val) {\n          this.openDialog = val;\n        },\n        deep: true\n      }\n    },\n    components: {getProject1,getProject2,projectPop},\n    data() {\n      return {\n        title: \"成本项目管理-新增\",\n        openDialog: this.open,\n        idflag:'',\n        // 表单参数\n        form: {\n        },\n        projectLevelOptions: [],\n        projectTypeOptions: [],\n        costPropertyOptions: [],\n        isControlOptions: [],\n        isAccountOptions: [],\n        isCostCapitalOptions: [],\n        isCostHealthOptions: [],\n        isCostCalculateOptions: [],\n        costSchemeOptions: [],\n        costDeptOptions: [],\n        // 表单校验\n        rules: {\n          projectCode: [\n            { required: true, message: \"项目编码不能为空\", trigger: \"blur\" }\n          ],\n          projectName: [\n            { required: true, message: \"项目名称不能为空\", trigger: \"blur\" }\n          ],\n          projectType: [\n            { required: true, message: \"项目类型不能为空\", trigger: \"blur\" }\n          ],\n          costProperty:[\n            { required: true, message: \"成本属性不能为空\", trigger: \"blur\" }\n          ],\n        }\n      };\n    },\n    created() {\n      this.getDicts(\"cost_xm_jb\").then(response => {\n        this.projectLevelOptions = response.data;\n      });\n      this.getDicts(\"cost_xm_lx\").then(response => {\n        this.projectTypeOptions = response.data;\n      });\n      this.getDicts(\"cost_cb_sx\").then(response => {\n        this.costPropertyOptions = response.data;\n      });\n      this.getDicts(\"hr_is_change\").then(response => {\n        this.isCostHealthOptions = response.data;\n        this.isCostCalculateOptions = response.data;\n        this.isCostCapitalOptions = response.data;\n        this.isAccountOptions = response.data;\n        this.isControlOptions = response.data;\n      });\n      getProject1({\"compCode\": this.$store.state.user.accountInfo.deptId}).then(response => {\n        this.costDeptOptions= response.data;\n      });\n      getProject2({\"compCode\": this.$store.state.user.accountInfo.deptId}).then(response => {\n        this.costSchemeOptions = response.data;\n      });\n    },\n    methods: {\n      handleClickProjectPop(data){\n        this.form.costScheme=data.projectCode\n      },\n      getDetailInfo() {\n        getProject(this.id).then(response => {\n          this.levelOptions.forEach(item=>{\n            if(response.data.costScheme==item.dictValue){\n              response.data.costScheme=item.dictLabel\n            }\n\n          })\n          this.form = response.data;\n        });\n      },\n      checkCode() {\n        let data = {\n          projectCode: this.form.projectCode,\n        };\n        checkCode(data).then(response => {\n          if('0'== response.msg){\n            this.form.parentProject = '0';\n            this.form.projectLevel ='1';\n            this.form.isCostCalculate='0';\n          }else{\n            let parent = {projectCode: response.msg}\n            this.form.parentProject = response.msg;\n            listProject(parent).then(response => {\n              this.form.projectLevel =Number(response.rows[0].projectLevel)+1+'';\n            })\n          }\n        })\n      },\n      // 项目级别字典翻译\n      projectLevelFormat(row, column) {\n        return this.selectDictLabel(this.projectLevelOptions, row.projectLevel);\n      },\n      // 项目类型字典翻译\n      projectTypeFormat(row, column) {\n        return this.selectDictLabel(this.projectTypeOptions, row.projectType);\n      },\n      // 成本属性字典翻译\n      costPropertyFormat(row, column) {\n        return this.selectDictLabel(this.costPropertyOptions, row.costProperty);\n      },\n      // 是否可控字典翻译\n      isControlFormat(row, column) {\n        return this.selectDictLabel(this.isControlOptions, row.isControl);\n      },\n      // 是否核算字典翻译\n      isAccountFormat(row, column) {\n        return this.selectDictLabel(this.isAccountOptions, row.isAccount);\n      },\n      // 是否资本性成本字典翻译\n      isCostCapitalFormat(row, column) {\n        return this.selectDictLabel(this.isCostCapitalOptions, row.isCostCapital);\n      },\n      // 是否医疗成本字典翻译\n      isCostHealthFormat(row, column) {\n        return this.selectDictLabel(this.isCostHealthOptions, row.isCostHealth);\n      },\n      // 是否计算计入成本字典翻译\n      isCostCalculateFormat(row, column) {\n        return this.selectDictLabel(this.isCostCalculateOptions, row.isCostCalculate);\n      },\n      // 弹框关闭\n      handleDialogClose() {\n        this.$emit(\"cancel\", false);\n      },\n      // 取消\n      cancel() {\n        this.$emit(\"cancel\", false);\n      },\n      // 表单重置\n      reset() {\n        this.form = {\n          id: null,\n          compCode: this.$store.state.user.accountInfo.deptId,\n          accountCode: null,\n          projectCode: \"\",\n          projectName: null,\n          parentProject: null,\n          projectLevel: null,\n          projectType: null,\n          costProperty: null,\n          isControl: '0',\n          isAccount:  '0',\n          isCostCapital:  '0',\n          isCostHealth:  '0',\n          isCostCalculate:  '0',\n          costScheme: null\n\n        };\n        this.resetForm(\"form\");\n      },\n      /** 提交按钮 */\n      submitForm(type) {\n        this.$refs[\"form\"].validate(valid => {\n          if (valid) {\n            let saveLoading = this.saveLoading();\n            if (this.form.id != null) {\n              updateProject(this.form).then(response => {\n                this.msgSuccess(\"修改成功\");\n                this.$emit(\"success\", false);\n                saveLoading.close();\n              });\n            } else {\n              addProject(this.form).then(response => {\n                if(type){\n                  this.msgSuccess(\"保存成功\");\n                  this.reset()\n                }else{\n                  this.msgSuccess(\"新增成功\");\n                  this.$emit(\"success\", false);\n                }\n                saveLoading.close();\n              });\n            }\n          }\n        });\n      },\n    }\n  };\n</script>\n<style lang=\"scss\" scoped>\n  ::v-deep .el-dialog {\n    min-height: 20%;\n    overflow: hidden;\n    .el-dialog__body {\n      height: calc(100% - 100px);\n      overflow: auto;\n    }\n  }\n</style>\n"]}]}