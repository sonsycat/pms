{"code":"(window[\"webpackJsonp\"]=window[\"webpackJsonp\"]||[]).push([[\"chunk-2d0ab325\"],{\"13f3\":function(t,e,a){\"use strict\";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a(\"div\",{staticClass:\"app-container\",staticStyle:{padding:\"2px 0 0 0\"}},[a(\"div\",{ref:\"search\"},[a(\"el-form\",{directives:[{name:\"show\",rawName:\"v-show\",value:t.showSearch,expression:\"showSearch\"}],ref:\"queryForm\",attrs:{model:t.queryParams,inline:!0,\"label-width\":\"68px\",hidden:\"\"}},[a(\"el-form-item\",{attrs:{label:\"年月\",prop:\"actDate\"}},[a(\"el-date-picker\",{attrs:{clearable:\"\",size:\"small\",type:\"month\",\"value-format\":\"yyyy-MM-dd\",placeholder:\"选择年月\"},model:{value:t.queryParams.actDate,callback:function(e){t.$set(t.queryParams,\"actDate\",e)},expression:\"queryParams.actDate\"}})],1),a(\"el-form-item\",[a(\"el-button\",{attrs:{type:\"primary\",icon:\"el-icon-search\",size:\"mini\"},on:{click:t.handleQuery}},[t._v(\"搜索\")])],1)],1)],1),a(\"div\",{ref:\"btns\"},[a(\"el-row\",{staticClass:\"mb8\",attrs:{gutter:10}},[a(\"el-col\",{attrs:{span:1.5}},[a(\"el-button\",{attrs:{type:\"info\",icon:\"el-icon-back\",size:\"mini\",loading:t.exportLoading},on:{click:t.goBack}},[t._v(\"返回 \")])],1),a(\"el-col\",{attrs:{span:1.5}},[a(\"el-button\",{attrs:{type:\"primary\",icon:\"el-icon-plus\",size:\"mini\"},on:{click:t.handleAdd}},[t._v(\"添加人员 \")])],1),a(\"el-col\",{attrs:{span:1.5}},[a(\"el-button\",{attrs:{type:\"danger\",icon:\"el-icon-delete\",size:\"mini\",disabled:t.multiple},on:{click:t.handleDelete}},[t._v(\"删除人员 \")])],1),a(\"el-col\",{attrs:{span:1.5}},[\"\"===t.auditState||\"0\"===t.auditState?a(\"el-button\",{attrs:{type:\"success\",icon:\"el-icon-edit-outline\",size:\"mini\",loading:t.saveLoading},on:{click:t.handleSave}},[t._v(\"保存 \")]):t._e()],1),a(\"el-col\",{attrs:{span:1.5}},[\"0\"===t.auditState?a(\"el-button\",{attrs:{type:\"success\",icon:\"el-icon-edit-outline\",size:\"mini\",loading:t.saveLoading},on:{click:t.handleCommit}},[t._v(\"提交 \")]):t._e()],1),a(\"el-col\",{attrs:{span:1.5}},[a(\"el-button\",{directives:[{name:\"hasPermi\",rawName:\"v-hasPermi\",value:[\"bonus:calculation:list\"],expression:\"['bonus:calculation:list']\"}],attrs:{type:\"primary\",icon:\"el-icon-notebook-2\",size:\"mini\"},on:{click:t.processExamine}},[t._v(\"流转历史 \")])],1),a(\"el-col\",{attrs:{span:1.5}},[[a(\"download-excel\",{staticClass:\"export-excel-wrapper\",attrs:{data:t.sumDataList,fields:t.jsonFields,header:t.title,name:t.excelName}},[a(\"el-button\",{attrs:{type:\"warning\",icon:\"el-icon-document-copy\",size:\"mini\"},on:{click:function(t){}}},[t._v(\"导出EXCEL \")])],1)]],2),a(\"right-toolbar\",{attrs:{showSearch:t.showSearch},on:{\"update:showSearch\":function(e){t.showSearch=e},\"update:show-search\":function(e){t.showSearch=e},queryTable:t.getList}})],1)],1),a(\"el-table\",{directives:[{name:\"loading\",rawName:\"v-loading\",value:t.loading,expression:\"loading\"}],ref:\"multipleTable\",attrs:{border:\"\",stripe:\"\",data:t.EvaluateDataList,height:\"calc(100vh - 180px)\",\"row-style\":t.rowStyle,\"row-class-name\":t.rowClassName,\"show-summary\":!0,\"summary-method\":t.getSummaries},on:{\"selection-change\":t.handleSelectionChange,\"row-click\":t.rowClick}},[a(\"el-table-column\",{attrs:{type:\"selection\",width:\"55\",align:\"center\"}}),a(\"el-table-column\",{attrs:{sortable:\"\",label:\"科室名称\",align:\"left\",prop:\"deptRoomName\"}}),a(\"el-table-column\",{attrs:{sortable:\"\",label:\"人员姓名\",align:\"left\",prop:\"docName\"}}),t._l(t.indexList,(function(e,i){return a(\"el-table-column\",{key:i,attrs:{label:e.indexName,prop:e.guideCode,align:\"center\"},scopedSlots:t._u([{key:\"default\",fn:function(i){return[a(\"div\",{staticStyle:{display:\"inline\"},on:{click:function(t){t.stopPropagation(),t.preventDefault()}}},[a(\"el-input-number\",{attrs:{precision:2,step:.01,min:0,\"controls-position\":\"right\"},model:{value:i.row[e.guideCode],callback:function(a){t.$set(i.row,e.guideCode,a)},expression:\"scope.row[item.guideCode]\"}})],1)]}}],null,!0)})})),a(\"el-table-column\",{attrs:{sortable:\"\",label:\"合计\",align:\"right\",prop:\"total\"},scopedSlots:t._u([{key:\"default\",fn:function(e){return[a(\"span\",[t._v(t._s(t.computedStatus(e.row)))])]}}])})],2),a(\"el-form\",{ref:\"form\",attrs:{model:t.form,\"label-width\":\"80px\"}},[a(\"formItem\",{attrs:{showDialog:t.showDialog,showBaseInfo:t.btn3,open:t.btn4,open2:t.btn5,comment:t.form,userOptions:t.userOptions},on:{\"update:showDialog\":function(e){t.showDialog=e},\"update:show-dialog\":function(e){t.showDialog=e},success:t.formItemSuccess}})],1),t.openSelect?a(\"selectList\",{attrs:{deptCode:this.queryParams.deptCode,actDate:this.queryParams.actDate,openSelect:t.openSelect,doctorList:this.doctorList},on:{docCodeList:function(e){return t.docCodeList(arguments)},cancelSelect:t.cancelSelect}}):t._e(),a(\"el-dialog\",{attrs:{title:\"流转历史\",visible:t.processOpen,width:\"1200px\",\"append-to-body\":\"\",\"close-on-click-modal\":!1,\"custom-class\":\"el-button--primary\"},on:{\"update:visible\":function(e){t.processOpen=e}}},[a(\"div\",{directives:[{name:\"loading\",rawName:\"v-loading\",value:t.loading,expression:\"loading\"}],style:\"height:\"+t.height},[a(\"iframe\",{staticStyle:{width:\"100%\",height:\"100%\"},attrs:{src:t.src,frameborder:\"no\",scrolling:\"auto\"}})])])],1)},o=[],n=a(\"b85c\"),s=(a(\"b680\"),a(\"99af\"),a(\"d81d\"),a(\"7db0\"),a(\"d3b7\"),a(\"a434\"),a(\"159b\"),a(\"b0c0\"),a(\"a9e3\"),a(\"13d5\"),a(\"c466\")),l=a(\"e472\"),r=a(\"3b86\"),c=a(\"0e67\"),u=a(\"986b\"),d=a(\"0b70\"),h=a(\"f2d9\"),m=a(\"2b0e\"),p=a(\"d623\");m[\"default\"].component(\"downloadExcel\",h[\"a\"]);var f={name:\"EvaluateData\",deptCode:{type:[String,String],default:\"\"},components:{formItem:c[\"default\"],btns:u[\"default\"],selectList:p[\"default\"]},filters:{transToValue:function(t,e){return t[e]}},computed:{computedStatus:function(){return function(t){var e,a=0,i=Object(n[\"a\"])(this.indexList);try{for(i.s();!(e=i.n()).done;){var o=e.value;a+=parseFloat(t[o.guideCode])}}catch(s){i.e(s)}finally{i.f()}return t.total=a.toFixed(2),a.toFixed(2)}},sumDataList:function(){return this.sumDataList_.push({}),this.sumDataList_.push(this.bottomTotal),this.sumDataList_},excelName:function(){return\"人员奖金\"+Object(s[\"c\"])()+\".xls\"}},mounted:function(){},watch:{},data:function(){return{processOpen:!1,height:\"500px;\",src:\"\",showAudit:!1,id:\"\",showDialog:!1,userOptions:[],auditState:\"0\",saveLoading:!1,loading:!1,exportLoading:!1,ids:[],single:!0,multiple:!0,showSearch:!0,total:0,EvaluateDataList:[],sumDataList_:[],selectionRow:[],title:\"\",open:!1,queryParams:{pageNum:1,pageSize:30,compCode:null,deptCode:null,deptName:null,accountCode:null,guideCode:null,guideValue:null,delFlag:null,actDate:Object(s[\"c\"])()+\"-01\",createBy:null,createTime:null,updateBy:null,updateTime:null,remark:null,deptType:null},form:{procedureId:null,assignee:null},indexList:[],nextAssignee:[],btn1:!1,btn2:!1,btn3:!1,btn4:!1,btn5:!1,comment:\"\",proclnsIds:\"\",datas:{},openSelect:!1,doctorOpen:!1,docParams:{pageNum:1,pageSize:20},doctorList:[],docTotal:0,tableTitle:\"人员奖金数据\",jsonFields:{\"科室名称\":\"deptRoomName\",\"人员姓名\":\"docName\"},bottomTotal:{deptRoomName:\"合计\",docName:\"\",total:0}}},created:function(){this.getDept(),this.getDetailInfo()},methods:{getDept:function(){var t=this;this.loading=!0,this.queryParams.actDate=this.$route.params.actDate,this.queryParams.nowDate=this.$route.params.actDate,this.queryParams.deptCode=this.$route.params.deptCode,Object(r[\"a\"])(this.queryParams).then((function(e){t.indexList=e.data,t.getList(),t.loading=!1}))},getList:function(){var t=this;for(var e in this.loading=!0,this.queryParams.actDate||(this.queryParams.actDate=Object(s[\"c\"])()+\"-01\"),this.queryParams.deptCode=this.$route.params.deptCode,Object(r[\"d\"])(this.queryParams).then((function(e){for(var a in t.EvaluateDataList=e.data,t.tableDoLayout(),t.sumDataList_=[].concat(e.data),t.EvaluateDataList)\"\"!=t.EvaluateDataList[a][\"remark\"]&&null!=t.EvaluateDataList[a][\"remark\"]||(t.EvaluateDataList[a][\"remark\"]=\"0\");t.loading=!1})),this.indexList)this.jsonFields[this.indexList[e].indexName]=this.indexList[e].guideCode;this.jsonFields[\"合计\"]=\"total\"},successSubmit:function(t){this.open=t,this.getList()},cancel:function(){this.open=!1},cancelSelect:function(){this.openSelect=!1},reset:function(){this.form={id:null,compCode:null,deptName:null,accountCode:null,guideCode:null,guideValue:null,delFlag:null,actDate:null,createBy:null,createTime:null,updateBy:null,updateTime:null,remark:null},this.resetForm(\"form\")},handleQuery:function(){this.queryParams.pageNum=1,this.getList()},resetQuery:function(){this.resetForm(\"queryForm\"),this.handleQuery()},handleSelectionChange:function(t){this.ids=t.map((function(t){return t.docCode})),this.single=1!==t.length,this.multiple=!t.length,this.selectionRow=t},rowClick:function(t,e,a){var i=this.$refs.multipleTable,o=this.selectionRow.find((function(e){return e.rowIndex==t.rowIndex}));o&&1==this.selectionRow.length?i.toggleRowSelection(t,!1):(i.clearSelection(),i.toggleRowSelection(t))},rowStyle:function(t){var e=t.row,a=t.rowIndex;Object.defineProperty(e,\"rowIndex\",{value:a,writable:!0,enumerable:!1})},rowClassName:function(t){var e=t.row,a=(t.rowIndex,\"\"),i=this.selectionRow.find((function(t){return t.rowIndex===e.rowIndex}));return i&&(a=\"current-row \"),a},handleAdd:function(){this.doctorList=this.EvaluateDataList,this.openSelect=!0},tableRowClassName:function(t){var e=t.row,a=t.rowIndex;e.row_index=a},handleSelectionDocChange:function(t,e){this.singleTable(e)},handleDocRowClick:function(t){this.singleTable(t)},singleTable:function(t){var e=this.$refs.itsmDataTable;e.clearSelection(),this.currentRowIndex==t.row_index?(e.toggleRowSelection(t,!1),this.currentRowIndex=null,this.docSelectData=null):(e.toggleRowSelection(t),this.currentRowIndex=t.row_index,this.docSelectData=t)},sexFormat:function(t,e){return this.selectDictLabel(this.sexOptions,t.gender)},handleDelete:function(){for(var t=this.ids,e=this.EvaluateDataList.length-1;e>=0;e--)if(t.indexOf(this.EvaluateDataList[e].docCode)>-1&&\"0\"==this.EvaluateDataList[e].remark)return void this.msgError(\"姓名为：\"+this.EvaluateDataList[e].docName+\"的人员数据不允许删除！\");for(var a=this.EvaluateDataList.length-1;a>=0;a--)t.indexOf(this.EvaluateDataList[a].docCode)>-1&&\"1\"==this.EvaluateDataList[a].remark&&this.EvaluateDataList.splice(a,1)},handleExport:function(){var t=this;this.queryParams;this.$confirm(\"是否确认导出科室奖金数据项?\",\"警告\",{confirmButtonText:\"确定\",cancelButtonText:\"取消\",type:\"warning\"}).then((function(){for(var e in t.indexList)t.jsonFields.push(t.indexList[e].guideCode,t.indexList[e].guideCode);t.exportLoading=!0})).catch((function(){}))},goBack:function(){this.$store.dispatch(\"tagsView/delView\",this.$route),this.$router.go(-1)},packageData:function(){var t=this;this.$refs.multipleTable.data.forEach((function(e){e.unitCode=e.docCode,e.deptCode=e.deptRoomCode,e.actDate=t.queryParams.actDate}));var e={data:this.$refs.multipleTable.data,audit:{deptCode:this.$route.params.deptCode,nowDate:this.queryParams.actDate,comment:this.form.comment,assignee:this.form.assignee}};return e},handleSave:function(){var t=this,e=this.packageData();if(!e.data||e.data.length<1)return this.msgError(\"缺少数据,无法保存\"),!1;e.isCommit=!1,this.saveLoading=!0,Object(l[\"a\"])(e).then((function(e){t.msgSuccess(\"保存成功\"),t.saveLoading=!1,t.auditState=\"0\",t.getDetailInfo(),t.showDialog=!0}))},handleCommit:function(){null===this.proclnsIds||\"\"===this.proclnsIds?this.handleSave():this.showDialog=!0},formItemSuccess:function(){var t=this,e=this.packageData();e.isCommit=!0,this.saveLoading=!0,Object(l[\"a\"])(e).then((function(e){t.msgSuccess(\"提交成功\"),t.saveLoading=!1,t.auditState=\"1\"}))},getDetailInfo:function(){var t=this;Object(l[\"f\"])({deptCode:this.$route.params.deptCode,nowDate:this.queryParams.actDate}).then((function(e){if(e.rows.length>0){var a=e.rows[0],i=t,o=a.procedureId;t.proclnsIds=a.procedureId,t.form.procedureId=t.proclnsIds,t.id=a.id,t.auditState=a.auditState,Object(d[\"c\"])(i,t.$store.state.user.name,o,t.userOptions,t.btn1,t.btn2,t.btn3,t.btn4,t.btn5)}}))},processExamineForm2:function(){this.src=\"\".concat(this.processUrl,\"/api/wf/processHistoric?procInsId=\").concat(this.proclnsIds)},processExamine:function(){var t=this.proclnsIds;null!=t&&t?(this.processExamineForm2(),this.processOpen=!0):this.msgError(\"没有流转历史数据！\")},docCodeList:function(t){for(var e in t[0]){var a={deptRoomCode:this.EvaluateDataList[0].deptRoomCode,deptRoomName:this.EvaluateDataList[0].deptRoomName,docCode:t[0][e].docCode,docName:t[0][e].docName};for(var i in this.indexList)a[this.indexList[i].guideCode]=0,a[\"remark\"]=\"1\";this.EvaluateDataList.push(a)}},getSummaries:function(t){var e=this,a=t.columns,i=t.data,o=[];return a.forEach((function(t,a){if(0!==a){var n=i.map((function(e){return Number(e[t.property])}));n.every((function(t){return isNaN(t)}))?o[a]=\"N/A\":(o[a]=n.reduce((function(t,e){var a=Number(e);return isNaN(a)?t:t+e}),0),\"deptRoomName\"!=t.property&&\"docName\"!=t.property&&(e.bottomTotal[t.property]=parseFloat(o[a])),o[a]=o[a].toFixed(2))}else o[a]=\"合计\"})),o},tableDoLayout:function(){var t=this;this.$refs.multipleTable&&this.$nextTick((function(){t.$refs.multipleTable.doLayout()}))}}},g=f,b=a(\"2877\"),v=Object(b[\"a\"])(g,i,o,!1,null,null,null);e[\"default\"]=v.exports}}]);","extractedComments":[]}